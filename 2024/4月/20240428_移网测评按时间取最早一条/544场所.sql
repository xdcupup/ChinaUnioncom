set hive.mapred.mode = nonstrict;
set mapreduce.job.queuename = q_dc_dw;

drop table dc_dwd.ywcp_temp_1;
create table dc_dwd.ywcp_temp_1 as
select *, row_number() over (partition by user_number order by ordernum) as rn1
from (select distinct user_number,
                      scene_id, -- 场景id
                      notifyid, -- 任务id
                      id,
                      crttime,
                      entid,
                      callid,
                      callnumber,
                      keyno,
                      keyname,
                      ordernum,
                      sourceindication,
                      userid,
                      a.date_id
      from (select user_number, scene_id, date_id
            from dc_src_rt.eval_send_sms_log
            where date_id >= '20240320'
              and date_id <= '20240420'
              and scene_id in (
                               '28493936353952',
                               '28501621124256',
                               '28501661976736',
                               '28503885510816',
                               '28506387527328',
                               '14268300000000',
                               '14268300000002',
                               '14268300000001',
                               '28355620440224',
                -- 28号之前
                               '28731575546528',
                               '28730574017184',
                               '28731575605920',
                               '28731575659680',
                               '28731575707808',
                               '28731575762080',
                               '28731575814816',
                               '28731575883424',
                               '28731575961760',
                               '28731576015520',
                               '28731576086688',
                               '28731576167584',
                               '28731576243360',
                               '28731576308384',
                               '28731576383136',
                               '28731576453280',
                               '28731576507040',
                               '28731576558240',
                               '28731576618144',
                               '28731576667296',
                               '28731576717984',
                               '28731576769696',
                               '28731576823968',
                               '28731576876704',
                               '28731576932000',
                               '28731576989856',
                               '28732058761888',
                               '28732058817184',
                               '28732058872992',
                               '28732058924192',
                               '28732058981024',
                               '29018555604640',
                               '29026323751584',
                               '29026355042464',
                               '29026382751392',
                               '28732167641760',
                               '28732167696032',
                               '28732167749280',
                               '28732167799456',
                               '28732167854240',
                               '28732167911072',
                               '28732167986848',
                               '28732168039584',
                               '28732168094368',
                               '28732168144544',
                               '28732168199328',
                               '28732169163424',
                               '28732169212576',
                               '28732169264800',
                               '28732169326752',
                               '28732169395360',
                               '28732169447584',
                               '28732169501856',
                               '28732169560736',
                               '28732169611936',
                               '28732169660576',
                               '28732169712288',
                               '28732169795232',
                               '28732169845920',
                               '28732169899168',
                               '28732169955488',
                               '28732170008736',
                               '28978375289504',
                               '28979597683360',
                               '28732342637728',
                               '28979697065632',
                               '29018520668320',
                               '28732342692512',
                               '28732342890656',
                               '28732342943904',
                               '28732342998688',
                               '28732343055008',
                               '29018629209248',
                               '28732343126176',
                               '28732343175840',
                               '28732343227552',
                               '28732343278752',
                               '28732343344800',
                               '28732343400096',
                               '28732343451296',
                               '28732343502496',
                               '28732343750304',
                               '28732343801504',
                               '28732343852704',
                               '29210451803808',
                               '29155000512160',
                               '28732492667552',
                               '29155081558176',
                               '28732492812960',
                               '28732492870816',
                               '28732492933792',
                               '29035462253728',
                               '28732493004448',
                               '28732493069472',
                               '28732493126304',
                               '28732493183648',
                               '28732493244576',
                               '28732686607008',
                               '28732686669984',
                               '29035462294176',
                               '28732687691936',
                               '28732687741088',
                               '28732687789728',
                               '28732687835296',
                               '28732687893152',
                               '28732687944352',
                               '28732687997088',
                               '28732688049312',
                               '28732688103072',
                               '28732688159392',
                               '28732688214176',
                               '28732688272032',
                               '28732688322720',
                               '28732688370848',
                               '28732688430240',
                               '28732688485024',
                               '28732688546464',
                               '28732688599200',
                               '28732688648352',
                               '28732688694432',
                               '28732688746656',
                               '28732688796320',
                               '28732688847008',
                               '28732688894112',
                               '28732688942240',
                               '29035462335136',
                               '28732688995488',
                               '29035462373024',
                               '29035462419616',
                               '29035462456992',
                               '29035462493344',
                               '29035462532256',
                               '29035462577312',
                               '29035462617760',
                               '29035462655136',
                               '29210388017312',
                               '28733138814112',
                               '29199581511840',
                               '28733138904224',
                               '28733138948768',
                               '28733138998944',
                               '29035462696096',
                               '29035462733984',
                               '29338001778848',
                               '29020668339872',
                               '29024854688416',
                               '29026480394912',
                               '29035462770336',
                               '28733139092128',
                               '28733139140768',
                               '29035462809248',
                               '29035462842016',
                               '28733139188384',
                               '28733139250336',
                               '28733139304096',
                               '28733139376800',
                               '29035462879392',
                               '29018682337952',
                               '28733139428512',
                               '28733139475616',
                               '28733139531424',
                               '29035462917280',
                               '28733139592352',
                               '28733139642016',
                               '29035462954656',
                               '29035462993056',
                               '28733139688608',
                               '28733139734176',
                               '28733388905120',
                               '28733388956832',
                               '28733389009056',
                               '28733389061280',
                               '28979795360928',
                               '28979830317728',
                               '28733389105824',
                               '28733389152416',
                               '28733389194400',
                               '28733389236896',
                               '28733389277344',
                               '28733389318816',
                               '28733389360800',
                               '28733389425312',
                               '28733389465760',
                               '28733389501600',
                               '29035463035552',
                               '28733389540512',
                               '28733389579424',
                               '28733389617824',
                               '29035463082656',
                               '28733389655200',
                               '28733468599456',
                               '28733468647072',
                               '28733468698272',
                               '28979867992224',
                               '28733468745376',
                               '28733468788896',
                               '28733468838048',
                               '28733468894368',
                               '29026514652320',
                               '29035463126176',
                               '29035463169696',
                               '29026541380256',
                               '28733469921952',
                               '29026634371744',
                               '29026663333024',
                               '29026691725472',
                               '29035463212192',
                               '29035463254688',
                               '29035463313056',
                               '29035463351968',
                               '28733469977248',
                               '28733470021280',
                               '29035463399584',
                               '29035463444128',
                               '29035463484576',
                               '29035463523488',
                               '29035463562400',
                               '29035463597216',
                               '29035463634592',
                               '29035463668896',
                               '28733470063776',
                               '28735516709024',
                               '28979910373024',
                               '28735516791968',
                               '28733583312544',
                               '29035463721632',
                               '28733583363744',
                               '28733583399584',
                               '28981663470240',
                               '28733583450272',
                               '28981701289120',
                               '28733583491232',
                               '29035463757984',
                               '29035463793824',
                               '29035463828640',
                               '28733583531168',
                               '28733583569568',
                               '28733583606944',
                               '28733583659168',
                               '28733583702688',
                               '28733583746720',
                               '28733583784608',
                               '29035463871136',
                               '29035463908000',
                               '29035463943840',
                               '29035463985312',
                               '29035464022176',
                               '29035464058016',
                               '29035464101536',
                               '28733583827104',
                               '28733583867040',
                               '29035464140960',
                               '28733583910560',
                               '29035464174752',
                               '29035464209568',
                               '29035464260256',
                               '28733583945376',
                               '29035464298656',
                               '29035464337568',
                               '29035464375968',
                               '28733583983776',
                               '28733584023712',
                               '29035464421536',
                               '29035464457888',
                               '29035464504992',
                               '29035464545440',
                               '29035464582816',
                               '28733584062624',
                               '28733584100512',
                               '28733584139424',
                               '29035464622240',
                               '29035464670880',
                               '28981772562080',
                               '28986883880096',
                               '28986911004320',
                               '28993933770400',
                               '29035464761504',
                               '29035464800416',
                               '29035464838304',
                               '28994034643104',
                               '28994065887904',
                               '29026767686304',
                               '28733737996448',
                               '29035464877216',
                               '28733738051232',
                               '28733738098336',
                               '28733738173088',
                               '28733738216096',
                               '29035464925344',
                               '29035464968352',
                               '29035465013408',
                               '29035465050784',
                               '29035465090208',
                               '29035465137824',
                               '29035465185440',
                               '29035465391776',
                               '29035465449120',
                               '29035465493152',
                               '29035465542816',
                               '29210431748768',
                               '29035465637024',
                               '29035465683616',
                               '29035465734816',
                               '29035465808544',
                               '29035465919136',
                               '29035465971872',
                               '29035466119840',
                               '28733738288800',
                               '29035466180256',
                               '29035466234528',
                               '28733738329248',
                               '28733738372768',
                               '29035466296480',
                               '28733738433696',
                               '28733738485408',
                               '28733738529440',
                               '28733738588832',
                               '29035466362016',
                               '29035466409632',
                               '29035466506400',
                               '29035466589344',
                               '28733738791584',
                               '28733738843296',
                               '29035466650784',
                               '29035466696864',
                               '29035466756256',
                               '28733738919584',
                               '29035466839200',
                               '29035466880160',
                               '28733738960544',
                               '29035466923168',
                               '29035466968224',
                               '29035467019424',
                               '29035467075744',
                               '29035467111072',
                               '29035467155104',
                               '29035467202208',
                               '29035467243680',
                               '29035467347104',
                               '29035467387552',
                               '29035467428512',
                               '29035467480736',
                               '29035467539616',
                               '29035467596448',
                               '29035467637408',
                               '29035467679392',
                               '29035467715232',
                               '29035467754144'
                )) a
               left join
           (select a.*, notifyid
            from (select *
                  from dc_src_rt.rpt_ivr_click_record
                  where date_id >= '20240320'
                    and date_id <= '20240420') a
                     join
                 (select distinct id,
                                  notifyid,
                                  date_id
                  from dc_src_rt.cti_cdr
                  where date_id >= '20240320'
                    and date_id <= '20240420'
                    and notifyid in (
                                     'e9c4d636d09d44ec980d8ee759569ea0',
                                     '95c7cb9d6c7140e4b9ad8b6f8c3e0531',
                                     '75f08d9768c2436e8120e3e900c3a4c2',
                                     'e1d0292d670a466082e97cda521d0a29',
                                     'e33afef6a500433b9ab6708500d37f4b',
                                     'f8d13a2c08a54d8bb3c5f0e00141fdb6',
                                     'e29704e4860940889a32031df9dd0f31',
                                     '51a410832a8a49f7afeff17dfb0692cf',
                                     '14906103e3254924b4dd75153b906289',
                      -- 28号之前。
                                     'a273b5fbb52c4074995b6677bc269679',
                                     'b365680e04634dff93201d3324c3cbc8',
                                     '1a16de6f02e54ef0adaa51a924dbff4e',
                                     'bd80601f40a345a79a4600c590d1a3fc',
                                     '0326f69d3b6049e985c2da67bd188848',
                                     '3d4985f95d0340ed8f1037e34c6df67b',
                                     '0869e60846d1452e80f620d14c57a58f',
                                     '44da9ac254ee4066916484ee6f6606dd',
                                     'f23ff4c6a2ba4c269b00955b3b02ef3b',
                                     '60d40651f2124cdbb07e8124e1cbb5cf',
                                     '5faa7eb02a4046c4a12f57b0733cc258',
                                     '6a2d7cca8e964282b8297822e8c659d6',
                                     '1a4ba1154fe64490a5bc884835c5e849',
                                     '1e3a0612a977488eac0b408a858c20c6',
                                     'b051a06639d64b54885b4425aa9a5d33',
                                     '2b4f04709f754a32ba4ca3f3121b80bb',
                                     '756f0cc20b754ac7982272276ba5735c',
                                     'e914720e862745069cf4db4f12de41a9',
                                     'bf2b62d945214ffaac08c7827e3817cd',
                                     '68d9b26110bd477c8aaaa3d9cdb41b38',
                                     '7fcb127f9be74e84a15ef4c217c0d624',
                                     '9ef22392a79040ca854deb53e8c2ea9d',
                                     'bbc9e62d2d654ff88c638dd571ea0283',
                                     'ce087d49abd044c9b823e214458adecc',
                                     '26e70505e79249868dfe6cbc5d62e096',
                                     '47534d0d7b424d22bd088a25116fcc19',
                                     '404da47ae8584bac912b5a95a8a2323b',
                                     '4d06ae1eba3a43d09a084e18511c3e12',
                                     '1f0bba67c5ce4208bc829bcebaa2fa55',
                                     '1f2f95ae00c44fea8d8f5e8558da2175',
                                     '1c239e77a97545c580c2156332b87ab8',
                                     'f1b420dc89b24d52b8fd69deb9cc28b8',
                                     'cae948fa56f546f49375af6b79ae8f8a',
                                     '7686d66e844846ae99189f48b04fb783',
                                     '3b74ffb42f0348909fe9860249958835',
                                     '69933d598caf4146abfc0a8dc25a8903',
                                     'c526ef5aead64d4c8c98fe417ef6a48f',
                                     '1dd66059c14a414eaa44d3b137e5653e',
                                     '9e36c3ae6df64c148746b7e4aab0a127',
                                     '1c8b9da20d194e568052a3e40424ab6f',
                                     '10125b54753d49e8856f4b2a3e0a6178',
                                     '91f935bf98a74d7ba3310ee47f1de1da',
                                     '7e756ad5b4284991a8b2c2563dad265d',
                                     '78b8a567c14842038d5ce54083b8d320',
                                     'c1e5c449d5f44157b8e8afc9387a88de',
                                     '9f6ea49d08224ec887e2f48427d27e1f',
                                     'b891e41aedf643c1941fd7998f496fd1',
                                     '1992732b426b4b868fe8cd814145594b',
                                     '7d2009a108074a12b2f4d583c2b28e21',
                                     '714eb1128fb54248bf5ff0432163b6cc',
                                     '3992dfe7bef548bd9dd6dbaa055706a1',
                                     '7dd618ef3d7046baaed658e50bf3d7c3',
                                     '6c7e885a124f45a7935be29997d3547b',
                                     '8ce45011fc5f42bb97efc8b233bda4b1',
                                     '4b26f04e4968492f88be7360a5933478',
                                     'a34624c8ca824304bf0b1a9467d13be6',
                                     '5c628fa5b05d4d2db070ada09cf7abb5',
                                     'ab0fca3682a84368a6a13367d4381b4f',
                                     '4db7b3e656204b8ea8c23fe53a00329c',
                                     '78d99c590d2d479b9e62939ee456675a',
                                     '08d792f4c493499d8d55822a0405eba8',
                                     'fd2cab4bb5994a8ea76023b64a2d089c',
                                     'c1e6379d20eb44bab2877c536ea96e79',
                                     '7dc50f9832a94c23add597b9e81f71f5',
                                     'a4446da869ad46ab833b519983e7abca',
                                     '6651c01eeb8645b6972912d4c047f664',
                                     '708905ce529c4f0b8bec3b55c8182789',
                                     '58b36e1a05af422c82402d855c6213b5',
                                     '1a17a1ea18844d7b8dda9ce59f8033eb',
                                     '676ee8ea7b5349519c55a8a8ab34e5ca',
                                     '1d86b1893a0d46da856d9c41093614b8',
                                     '07b6277397144636a5a9f09daabde5c2',
                                     '7bca1391eb6347b2b9d5d5378029f022',
                                     'e2412af3a60d4a3c841ad16116c5780a',
                                     '17ee21e243594eb78b206049d97ea6a6',
                                     'b7b5dda1a44b42fd87e01fe267af2c4b',
                                     '966087417e5042ef86d6b1b8b18cdbc1',
                                     '81f33a6b538e4085a072a2aaa19842ec',
                                     '5dae37f824744aa79544dd6130482f4b',
                                     'f1aac2c04c6742b486930fe58f3bbf1f',
                                     '904e8570cec64dea8adb27279cc53643',
                                     '8ef16e10fab249c287ca1ef700e7b64a',
                                     '6c468badcee74a05a0140238edbea9c5',
                                     '4f75c64b7164423bbe0334cbbbad1570',
                                     '6d66513350db424da51dcb69785eb099',
                                     '209bae37207f4e7389db3af7ea6ad77a',
                                     '6c093c90ae9749759e21e15019766265',
                                     '13c0dc40ab944268b455cc916d144984',
                                     '667b8cb51e464dc6ab8090dc67770ecb',
                                     '83ffd602e4c440749cc6bbad224451e5',
                                     '713592180cee4ede8c54b3370019867f',
                                     'a4d6989edc0747d589b5bc6be51129b9',
                                     'f10a2bbdc2224792b1c4a6806670858f',
                                     '4b4c08d0c4504132b33751648aacf1ad',
                                     '85ba8edba4dd490ba43f53a375c7e66e',
                                     '9b311dd79e834e908ebd808b1be80cc8',
                                     'b297656d5e9443f0adc52bd9c1a1ce90',
                                     '11b27306ca1942f896449b1065e4adcd',
                                     '00922b23f8e64d9eb69b462375cf4666',
                                     '5decffe6c4e54749b6bf411c887b5bca',
                                     '9891a4ff9daa4941bf7115dbb8c3c7d0',
                                     'baaa43d66b1f473aba0425b641d512e7',
                                     '7f23aa64aaa740c393d75bb7e6c0204c',
                                     'c55f19a7667449428b09fe495fa6275e',
                                     'eaa6e529ecca4858b5b962e287125042',
                                     'e903e61e49aa4e86bd32b96304a5e453',
                                     '03dec298f9484a1ea3bdaa163994eee1',
                                     '5807353c65784289a24ee18566dee04e',
                                     '38d65b61889a4e7eac53b550f91efc91',
                                     '1a1e44f0853744da9a2e7d21c3b9eac1',
                                     'b3323197a9ac432e878fa96ab2d422d9',
                                     '4134a3314280409fac55d723f7163dce',
                                     '015a5f51235a4261be47a0022a2fa014',
                                     '1973f2dacdde43a4ba98788fd9e3fa6b',
                                     'fb0d5f68e7d54caca72e12ea0b5ed01a',
                                     '1a32281d3d1d4cd5920918eb9924bf26',
                                     '052d60c4d3c44374a6f9b3453e1df1c6',
                                     '60d4f6108ad1439c8b7e22610d7e00de',
                                     'ae1d017c04154395b3fdb63d1e482d37',
                                     'bb42b31df6ce4a719936f027adab81ef',
                                     '8c1a1546ab4444b2a73c69d89a58b0ea',
                                     '963c3f89e59d43f4ab981f614fe356fd',
                                     'a36a29a8374540a78e74d7680991076e',
                                     '6d64c285a1d848ba8e0e35418f4760cb',
                                     'e580d7aee6fc4012a88737fe297367a3',
                                     '445e2b59ebc34fe6a5be5992c944bfcd',
                                     '6aa2930a049648c192b699b5f898a7f8',
                                     'f546e740788542fdacd040f347518a23',
                                     '50ea33ebe75c4a499507fcfc2bf4903c',
                                     '6e649e019fb745c6b787db24e9725c53',
                                     '8642c1b5537943dda48c20c70735e17a',
                                     '4f7090b1bfd9400296908ee43a8ae27a',
                                     '166dd8092e81429ca94b3922c1299bcb',
                                     '760c0a9e567c43a38af9379c800a61b9',
                                     '51e23b08fabf46159a85535a8986269d',
                                     '0da0b62bb0dc43ba93545c1dba90fff7',
                                     '1270d6df80874f87b348598311982f7b',
                                     '57e0594d483d46478907442f2bc1e2b1',
                                     '052d989a00a54d24a5725299d1d729ce',
                                     '4ffb33aa6c994169a646b1b9c576440b',
                                     '8feffa89349a4c598285b4bbc0636d06',
                                     'c15f11c8246f478e92844cd5314fd038',
                                     'e002e27bbf6340b893666d15594f9f86',
                                     'ad7c7e103f4d4349ae4355cc08c7672d',
                                     '2427727c5ae347438a48ff9af4c690a0',
                                     '87753e884e264a28b025b74288ec0365',
                                     '39f89fa8860045bd85501eeee08f0819',
                                     'b714c288d512414180ed68d83d9bb202',
                                     '67a3b386431b4fc5bd5f1a5c27509c0b',
                                     '4feb7633f3b24d95a61e99fb681d09d5',
                                     '53a00ad8b428432f8a5e0f2b995ef573',
                                     '2fa343bc67ed410c98afaacf45170306',
                                     '3c1c170cc3a5420b9fd481ebef23b9ea',
                                     'eb00af0dd92544128a3a0f5b590c73dd',
                                     '3a1102cd26f5488cbdee7428b38596ed',
                                     'e9980942c6994bd3b921fe0060531d5e',
                                     '0f8ced8a60494b8c92fe4f2b9ef77917',
                                     'ad2d34d6507c40c39ff06e4a8bfb401c',
                                     '4dbebe6b2aa44ee98817999f2300c12d',
                                     'ad7c7e103f4d4349ae4355cc08c7672d',
                                     '1c10a5813ed74eb5be1574506315af43',
                                     '627c4ec1d9e747ee83b335b2562416b8',
                                     '0dcaa82ed50945c2939ae37507a80590',
                                     '93143fa4f98e453fbf71c6ac6a1cad81',
                                     'b82b67a26ba2432f973dd33287d66afc',
                                     '2b73f9a194a145dbb9783adf25a05c5e',
                                     'f00b0b76ed6445c796d7ced89697aa22',
                                     '8e44d9d5d16f495e9387bc86f0d3e450',
                                     '07f7ff93d8c24c978db622bcbf8e6c58',
                                     '10f6ed9137f148c5a4ca22e684ff5008',
                                     '974c00b98b9f4ff3992ccd35a5f603f8',
                                     '843d77c9f6594778902b06a0bdeaada6',
                                     'e1229f3429e749dd9348382936699434',
                                     'ae151f5578bb45ea80687964f0c37004',
                                     '078203796c0443e88f70b0e66d90e0e5',
                                     'dbf6979478404bff9866a38b6e760361',
                                     '046f99def4544c9992b168fe276f9b92',
                                     'fe86e1003fb14e38bc5a469f510c0d33',
                                     '55c39f56009546c8aa9b1239c7e844d3',
                                     'c7ea227da34346a6b79dd8c9845310ea',
                                     'f2ea3a9122d940bbbd12eeaddd1252cd',
                                     'b60c56ce9dd447bb919df1628c77b912',
                                     '6ec2d36f50324a2c87435ccaee7cac60',
                                     '4ed7c1f633674386a6b2640e69e118ef',
                                     'e8b07560ac8a4015ba5a7fbf1b440a7b',
                                     '191bf93b370b4844a741632816d8a0c8',
                                     '1cf80d6db4e64a5f923d4fc519b02768',
                                     'e4fe6d67549443be8ef7a1ae205a7895',
                                     '4f6a3f849e7e41cab6f28e4dab996798',
                                     'dd7b76df87394e1ab138067f6810c3f0',
                                     '1ba2b313bfbb40d8b23bc0da29ce2d2f',
                                     '11bf2f2939df462c8af0b1bf5995615c',
                                     '37f6c2c7f6ca472b8df8a1cf95a4d6a1',
                                     '3776593e8e834026aa135600ff891051',
                                     'e8ca287d4b4c4f92ace30de52b48c0b0',
                                     'cfd43cc1e95847fa9cb39469936128e1',
                                     '1cd615170bf641b39b9f9a2c99fc3de2',
                                     'ccec8ce7f80f427d9f8e095c35c1fc70',
                                     '49e57b3a17ef4dd58c8aff430b57ef49',
                                     '2a0eda2518b94d208b604358c5dd9763',
                                     'beaf6bc056b349149f08f44bb3d4c746',
                                     '0e2a788753e0474da2a8438be0d8db33',
                                     '09cb8eb9ebe342488f5607d033412a99',
                                     'b44f5ad7aa5847da852470af3c76f811',
                                     '231cca1fed2746f29948bd77be789ac5',
                                     '3ad79ec7304d47bba1a8377deaeb793d',
                                     'f0b378b29d7f4da291422ef55987738a',
                                     '2b970f10b6aa43489c757c56de6baa58',
                                     '109ae525f55d4220abf81346517bb157',
                                     '81d1001f8325484ebf7e95dbce6fc4a5',
                                     'b06f939ec55d4023802593843751040d',
                                     'c3825514c12043f28ff18aae61f3ff77',
                                     '4de1c7dfc39a429f8fa4eb9b6f748783',
                                     '93d216f0a91440c7a18c323254161590',
                                     'b08d7c7764ea47d1af56bc334ac4c09d',
                                     '85c68fdf981146c7a623c914bae8ea7c',
                                     '26496ddcfc5c42ff923b0b37095ddb3d',
                                     '77e62458a4b5466ba91b7550cd8d4902',
                                     '23b5451c924a44cf9e9c24333edc522a',
                                     '9a3eebb982b14c24860e8bc108da8517',
                                     '4a187d53f10e4364b84c43e01a9c8988',
                                     '1ca4d76d0fb44f919eb537acbb08f463',
                                     '025fe12a94e2433faf2e6365e818ca36',
                                     'c453a143bdc7434d92fa80c375017ff3',
                                     'd7ba707f88b446abbea5bdb96dde12a8',
                                     '5cbe63df72ab4027b164f709ba4d2cdd',
                                     '44368b431d1a40248eccaaf8e9b20ace',
                                     'df1c85c2c5a34e63b371975761143adf',
                                     '681cb35f46c4443ba8130861b77a5e23',
                                     'fc32d648c4b44b099a9cf5f9df3e49e3',
                                     '096a9d3fd8734cdbad7d07ecdd12f3f7',
                                     '4fb9777dd06e4fe7b3764ad12033c645',
                                     '89c19445936c472586d338a130009eb5',
                                     '913993154f5545ef97ae419ba47164b3',
                                     'c7aa2a4181c24e6ab44f7e693575c8e6',
                                     '9a00a2633f4b4bd28eed0ab6d6b3b410',
                                     '8e2d783f02c441f78d84f4d70e26c882',
                                     'a48155e8be574d69afdcb41c48b509ea',
                                     'ae97f9e4207348ae8d5f9bb4045e2c7c',
                                     '1677a67b83fb4e4ca437d295fd45b032',
                                     '2d86b294f1d34f69bc42b333f5264aa5',
                                     '9ec5fea599c6452680a5321afe01cabd',
                                     'b2baf774b1d14c06a8fa53a8ff15a584',
                                     '36ab35a1d3bb4a0c82de9514775dcee8',
                                     '6adac5e883f84342b8b1eb638694a606',
                                     '15a4dda4f95f4d7eaf38323c99d002cd',
                                     '1996a935169941c792bddf08399614d2',
                                     'ebcb256e79aa440b9782a379a18d6237',
                                     '7b118b658bc94433844513340ecddeb2',
                                     '72426fb46acb4d6daa4673885825d4c9',
                                     'dfbb6e5345284ede92c6ef5b5908e69c',
                                     '3405adee595646238b731eadc117b35e',
                                     'b36beb3e57504258ab47ffbee27b78ec',
                                     '5889d10a318246de9bab23fcd73f7b7b',
                                     '1ecabd1dd673483db0042d2b66170268',
                                     '1b7c56d1c21a44af82a07873d816ade4',
                                     'c0ad81b6e99d4fbab2d185e73edb3587',
                                     '0ea6cd2eaa7c417985b721bd462f85f4',
                                     '7b0d4315f20a4b229f3eee115fafe170',
                                     'd2da9d7495664b51a3a5afbbdb9fefe6',
                                     '173e29d4710a4317a0130b5f1db28796',
                                     '4482f628069544b7935dcafe02ea29d9',
                                     'd36d112a7fa242478744d0593d6cdd13',
                                     'c8f39a8c8b87430189e5e1326c8fe2ba',
                                     'd92bf13036b04fe59954cd2e4e22dd59',
                                     'd8ecf29e8b3f417f83dc00a72ad96eff',
                                     'baffe669c2e34fd7a675c316e59617be',
                                     '021398b0210644b79df7f8416999f135',
                                     '29dd6c04e52f482aa1e7b428f935a167',
                                     '84d85891e7d64fa5895415e7bd0e5300',
                                     '93b2fcdf71864c9dbf37c1ffa55eff37',
                                     'fc61c7e421864de690d48055c396bc17',
                                     '0527609e941c4f88a340e9082b5ffde9',
                                     '0733435d270c453880056c13910615e6',
                                     '37f13e23866b41eb91b517ce2b11759e',
                                     '0da92afb97ca4bd1891e4d6d325a2b99',
                                     '925f7b3ce79843f4b0e77696c5b8feff',
                                     '41e234c2d9ae4b1091b3e64a70b7a54d',
                                     '800f495573cf4374a2fd835ede82f9d2',
                                     'eec2b0db214e4261a2e3828b5e00dc67',
                                     'b628cc700f7546aeb159192ed6cd826d',
                                     '7e734e654efa433c81bf3bf43b7a5a6c',
                                     'c6f0796a21a24bf794e1c42e2d56a715',
                                     'd2879236e48a4976b2cba66d7e1f2197',
                                     '0907e7c3185e4533929ae951e5ac1dec',
                                     '3e09d83a8b26459a9db8ca35d139f8fb',
                                     '47429a23380d45b087f1e3eb14e8e9e2',
                                     '07cf5db897474e619fae11102eeb96ce',
                                     '46c2fa766c074fc1a65be1485db4b548',
                                     '5483ae3d7d8942b4a167a689623d2876',
                                     '5e4599bec0ce4e419c8640ba5af4b28b',
                                     '373a31914c724da2b92bcd12320740a9',
                                     '6412424e6b834b2ea01b0980749be37b',
                                     '25661592aba344a29692e3d94a0c21ca',
                                     '00f0b2840d8d4590a34957a625562518',
                                     '04b8324b10f14b558e021eb415aef5dd',
                                     '2d28f6d801a449e5be4ea6100537bc7b',
                                     '70407030200c457b8808e42f1f9a8635',
                                     'b2502f9e81564cdb9614a11930e6c5fd',
                                     '71b8746eac1e49a88298602cc6ab2b5a',
                                     'cbb79e5b18f7461cae18de2d949c5b00',
                                     'e2e70850d14742568517ae63f228d524',
                                     '339fbddb1f3943e6b46ae3181e3b5965',
                                     '500c771ff8f2487787e71e19f7ded460',
                                     '612afd7f630b4f88b28ff3f4828491c6',
                                     'c44b23098d594b698302c15123a5141a',
                                     '7d3068eeb92e4b24b6370452921913f1',
                                     'b6b035d6d00b41739624fa79cafcb2ff',
                                     '98b10932fc2943bfa37f9c8c729d4536',
                                     'dbd8794d261646fda42d9f67d6cd3fca',
                                     '90145656be234cd3bd5885713f41e571',
                                     '92285a67e77b4a7f9e05e5b8e5f849f3',
                                     'c70b72859fe841c1a781c90dcab8fd80',
                                     'd961f4f54452400689d30ef03bba33a6',
                                     'dfff778a89f247b99bea0c0ab54b5cf3',
                                     'c334555484ca421281b710b87f13899d',
                                     'b733108659f84a4391db4e160624d00b',
                                     '407c3276ebcd4b6ea191c3e35830264f',
                                     '4c9fb2fadb2b4ebcb01912459f4a53e8',
                                     'ffeb5c5f7d814adca1c6c61f0b7019ca',
                                     '50a8880be492440396bce505d1c92f93',
                                     '2dc21d27dd4d45d0983f37493ce6a3a4',
                                     'b3e18a2af9f34be59a9e7d00eac3cf49',
                                     'ee83c3055cac4c8aa3c2d26b19952ba1',
                                     'd0d92f0405554b45b99b5c06df2a5deb',
                                     '4a048f81afb34c298b6491a204fcf86d',
                                     '577ac7ffb6f04066ab74b4e9977c90af',
                                     '3711e61d47a34ba3add0ddef05adabb8',
                                     '0d9cb52d99f74e6dab15f0dcbb2add48',
                                     'b9876217291741edbff8483418bc34e2',
                                     '527564dd37a14a6fb9d23e3c0ad0e090',
                                     '037b24d44ff04e21a5bfa463f3da5158',
                                     'a60358cec2e144f4ac61cef4aa45deb3',
                                     '57daa116581c4f418177cf1f70c9f65e',
                                     '7efe030d43464ea5835646656fca951e',
                                     'e0367465c6b34aeab823a5335ba13c56',
                                     '9bd4551b060f4b838eb8f8bd3940d27e',
                                     '168c9e2972df46869e11afcdacd05e80',
                                     '9368eccbadde4b3d8604acbba96664ae',
                                     'ac9b31c182a64a5e89997f9dba3ac341',
                                     'f9ff6b0e05754ccf8ae50fed51e98fbb',
                                     'f850910a25dc45609efa0e24213ea9da',
                                     '14a7cec8788840eb906c7acc3f0b4504',
                                     'dc42a8a8bdd645ca880a84d6bf12db2e',
                                     'ec7362de9cee4738ac8a241e7857ddbf',
                                     '639d74668d4b41a5ab776f3ce43470c1',
                                     '70832271ea5c498a8d730105dbf3c696',
                                     '80667d3d0a2847c2b21b898284ae2ad2'
                      )) b
                 on a.callid = b.id) b
           on a.user_number = b.callnumber) aa
;


drop table dc_dwd.ywcp_temp_2;
create table dc_dwd.ywcp_temp_2 as
select user_number, collect_list(keyno) as source
from dc_dwd.ywcp_temp_1
group by user_number;


select *
from dc_dwd.ywcp_temp_2;


drop table dc_dwd.ywcp_temp_3;
create table dc_dwd.ywcp_temp_3 as
select a.user_number,
       crttime,
       scene_id,
       notifyid,
       date_id,
       split(concat_ws(',', source), ',')[0] as aj_1,
       split(concat_ws(',', source), ',')[1] as aj_2,
       split(concat_ws(',', source), ',')[2] as aj_3,
       split(concat_ws(',', source), ',')[3] as aj_4,
       split(concat_ws(',', source), ',')[4] as aj_5
from dc_dwd.ywcp_temp_2 a
         left join(select * from dc_dwd.ywcp_temp_1 where rn1 = 1) b on a.user_number = b.user_number;

select *
from (select user_number, count(*) as cnt from dc_dwd.ywcp_temp_3 where notifyid is not null group by user_number) a
where cnt > 1;

set hive.mapred.mode = nonstrict;
set mapreduce.job.queuename = q_dc_dw;
drop table dc_Dwd.ywcp_mx_temp;
--明细表
create table dc_Dwd.ywcp_mx_temp as
select sf_name,
       ds_name,
       if(scen_type in ('商务楼宇', '酒店'), '商务楼宇及酒店', scen_type) as scen_type,
       id,
       scenename,
       user_number,
       crttime,
       aj_1,
       aj_2,
       aj_3,
       aj_4,
       aj_5,
       case
           when aj_1 = '1' then '满意'
           when aj_1 = '2' then '一般'
           when aj_1 = '3' then '不满意'
           else null
           end                                                            as yymy,
       case
           when aj_1 in ('2', '3') and aj_2 = '1' then '电话无法打通、接通'
           when aj_1 in ('2', '3') and aj_2 = '2' then '通话经常中断'
           when aj_1 in ('2', '3') and aj_2 = '3' then '通话有杂音、听不清'
           when aj_1 in ('2', '3') and aj_2 = '4' then '其他'
           else null end                                                  as yywt,
       case
           when scen_type not in ('文旅景区', '医疗机构', '政务中心', '交通枢纽', '重点商超') then
               case
                   when aj_1 = '1' then case
                                            when aj_2 = '1' then '手机流量'
                                            when aj_2 = '2' then '宽带WIFI'
                                            when aj_2 = '3' then '不清楚'
                                            else null end
                   when aj_1 in ('2', '3') then case
                                                    when aj_3 = '1' then '手机流量'
                                                    when aj_3 = '2' then '宽带WIFI'
                                                    when aj_3 = '3' then '不清楚'
                                                    else null end end
           when scen_type in ('文旅景区', '医疗机构', '政务中心', '交通枢纽', '重点商超') and aj_1 is not null
               then '手机流量'
           else null end
                                                                          as swfs,
       case
           when scen_type not in ('文旅景区', '医疗机构', '政务中心', '交通枢纽', '重点商超') then
               case
                   when aj_1 = '1' and aj_2 in ('1', '2') then case
                                                                   when aj_3 = '1' then '满意'
                                                                   when aj_3 = '2' then '一般'
                                                                   when aj_3 = '3' then '不满意'
                                                                   else null end
                   when aj_1 in ('2', '3') and aj_2 in ('1', '2', '3', '4') and aj_3 in ('1', '2') then case
                                                                                                            when aj_4 = '1'
                                                                                                                then '满意'
                                                                                                            when aj_4 = '2'
                                                                                                                then '一般'
                                                                                                            when aj_4 = '3'
                                                                                                                then '不满意'
                                                                                                            else null end end
           when scen_type in ('文旅景区', '医疗机构', '政务中心', '交通枢纽', '重点商超') then
               case
                   when aj_1 = '1' then
                       case
                           when aj_2 = '1' then '满意'
                           when aj_2 = '2' then '一般'
                           when aj_2 = '3' then '不满意' end
                   when aj_1 in ('2', '3') and aj_2 in ('1', '2', '3', '4') then case
                                                                                     when aj_3 = '1'
                                                                                         then '满意'
                                                                                     when aj_3 = '2'
                                                                                         then '一般'
                                                                                     when aj_3 = '3'
                                                                                         then '不满意' end end
           end
                                                                          as swmy,
       case
           when scen_type not in ('文旅景区', '医疗机构', '政务中心', '交通枢纽', '重点商超') then
               case
                   when aj_1 = '1' and aj_2 in ('1', '2') and aj_3 in ('2', '3') then case
                                                                                          when aj_4 = '1' then '无法上网'
                                                                                          when aj_4 = '2' then '网速慢'
                                                                                          when aj_4 = '3'
                                                                                              then '上网卡顿、不稳定'
                                                                                          when aj_4 = '4' then '其他'
                                                                                          else null end
                   when aj_1 in ('2', '3') and aj_2 in ('1', '2', '3', '4') and aj_3 in ('1', '2') and
                        aj_4 in ('2', '3')
                       then case
                                when aj_5 = '1'
                                    then '无法上网'
                                when aj_5 = '2'
                                    then '网速慢'
                                when aj_5 = '3'
                                    then '上网卡顿、不稳定'
                                when aj_5 = '4' then '其他'
                                else null end end
           when scen_type in ('文旅景区', '医疗机构', '政务中心', '交通枢纽', '重点商超') then
               case
                   when aj_1 = '1' and aj_2 in ('2', '3') then
                       case
                           when aj_3 = '1' then '无法上网'
                           when aj_3 = '2' then '网速慢'
                           when aj_3 = '3' then '上网卡顿、不稳定'
                           when aj_3 = '4' then '其他'
                           end
                   when aj_1 in ('2', '3') and aj_2 in ('1', '2', '3', '4') and aj_3 in ('2', '3') then case
                                                                                                            when aj_4 = '1'
                                                                                                                then '无法上网'
                                                                                                            when aj_4 = '2'
                                                                                                                then '网速慢'
                                                                                                            when aj_4 = '3'
                                                                                                                then '上网卡顿、不稳定'
                                                                                                            when aj_4 = '4'
                                                                                                                then '其他' end
                   end end                                                as swwt
from (select sf_name,
             ds_name,
             ptext as scen_type,
             id,
             scenename,
             user_number,
             crttime,
             aj_1,
             aj_2,
             aj_3,
             aj_4,
             aj_5
      from dc_dwd.ywcp_temp_3 aa
               left join (select serial_number,
                                 province_code,
                                 eparchy_code,
                                 scenename,
                                 a.id,
                                 b.scen_type as ptext,
                                 text,
                                 usertype,
                                 month_id,
                                 prov_id,
                                 update_time
                          from dc_dwd.group_source_all_1 a
                                   left join dc_dwd.xdc_scen_type b on a.id = b.id) bb
                         on aa.user_number = bb.serial_number
               left join dc_dwd.scence_prov_code cc
                         on bb.province_code = cc.sf_code and bb.eparchy_code = cc.ds_code) dd;

drop table dc_Dwd.ywcp_mx_temp_final;
create table dc_Dwd.ywcp_mx_temp_final as
select *
from (select *, row_number() over (partition by user_number) as rn from dc_Dwd.ywcp_mx_temp) aa
where rn = 1;
select *
from dc_Dwd.ywcp_mx_temp_final;




