set hive.mapred.mode = nonstrict;
set mapreduce.job.queuename=q_dc_dw;
-- todo 1 故障联系不及时投诉率  39  完成
select 'FWBZ097'                                                                             index_code,
       'ZY_'                                                                                 index_type,
       'GZ'                                                                                  index_level_1_id,
       '公众客户'                                                                            index_level_1_name,
       '03'                                                                                  index_level_2_id,
       '渠道服务'                                                                            index_level_2_name,
       '13'                                                                                  index_level_3_id,
       '智家工程师'                                                                          index_level_3_name,
       '12'                                                                                  index_level_4_id,
       '上门预约'                                                                            index_level_4_name,
       '故障联系不及时投诉率'                                                                index_name,
       a.prov_code                                                                           pro_id,
       a.prov_name                                                                           pro_name,
       '00'                                                                                  city_id,
       '全省'                                                                                city_name,
       substr("202212", 1, 6)                                                                month_id,
       ''                                                                                    day_id,
       '2'                                                                                   date_type,
       '<0.047件/万户'                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ''                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ''                                                                                    day_relative_ratio,
       ''                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.047, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ''                                                                                    refer_count_10,
       ''                                                                                    refer_count_9,
       ''                                                                                    refer_count_8,
       ''                                                                                    refer_count_7,
       ''                                                                                    refer_count_6,
       ''                                                                                    refer_count_5,
       ''                                                                                    refer_count_4,
       ''                                                                                    refer_count_3,
       ''                                                                                    refer_count_2,
       ''                                                                                    refer_count_1,
       '关键'                                                                                index_level,
       'GJ'                                                                                  index_level_code
from (select b.prov_code as prov_code, b.prov_name prov_name, count(1) n
      from (select sheet_id, compl_area
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202207")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>尚未与用户联系",
                                     "投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>尚未与用户联系")
              and sheet_status not in ("8", "11")) a
               left join dc_dim.dim_pro_city_regoin b on a.compl_area = b.code_value
      group by b.prov_code, b.prov_name) a
         left join (select substr(prov_id, 2, 3) pro_id, prov_name, cast(sum(kpi_value) as bigint) n
                    from dc_dwd_cbss.dwd_m_user_info
                    where month_id in
                          ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                           "202303", "202304", "202305", "202306")
                      and kpi_code in ("CKP_67269", "-")
                      and prov_id != "-1"
                    group by prov_id, prov_name) b on a.prov_code = b.pro_id and a.prov_name = b.prov_name
where a.prov_name is not null
  and b.prov_name is not null;
-- union all
select 'FWBZ097'                                                                             index_code,
       'ZY_'                                                                                 index_type,
       'GZ'                                                                                  index_level_1_id,
       '公众客户'                                                                            index_level_1_name,
       '03'                                                                                  index_level_2_id,
       '渠道服务'                                                                            index_level_2_name,
       '13'                                                                                  index_level_3_id,
       '智家工程师'                                                                          index_level_3_name,
       '12'                                                                                  index_level_4_id,
       '上门预约'                                                                            index_level_4_name,
       '故障联系不及时投诉率'                                                                index_name,
       '00'                                                                                  pro_id,
       '全国'                                                                                pro_name,
       '00'                                                                                  city_id,
       '全省'                                                                                city_name,
       substr("202210", 1, 6)                                                                month_id,
       ''                                                                                    day_id,
       '2'                                                                                   date_type,
       '<0.047件/万户'                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ''                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ''                                                                                    day_relative_ratio,
       ''                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.047, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ''                                                                                    refer_count_10,
       ''                                                                                    refer_count_9,
       ''                                                                                    refer_count_8,
       ''                                                                                    refer_count_7,
       ''                                                                                    refer_count_6,
       ''                                                                                    refer_count_5,
       ''                                                                                    refer_count_4,
       ''                                                                                    refer_count_3,
       ''                                                                                    refer_count_2,
       ''                                                                                    refer_count_1,
       '关键'                                                                                index_value,
       'GJ'                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202210")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>尚未与用户联系",
                                     "投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>尚未与用户联系")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202210")
                 and kpi_code in ("CKP_67269", "-")
                 and prov_id = "111") b
union all
select 'FWBZ097'                                                                             index_code,
       'ZY_'                                                                                 index_type,
       'GZ'                                                                                  index_level_1_id,
       '公众客户'                                                                            index_level_1_name,
       '03'                                                                                  index_level_2_id,
       '渠道服务'                                                                            index_level_2_name,
       '13'                                                                                  index_level_3_id,
       '智家工程师'                                                                          index_level_3_name,
       '12'                                                                                  index_level_4_id,
       '上门预约'                                                                            index_level_4_name,
       '故障联系不及时投诉率'                                                                index_name,
       '00'                                                                                  pro_id,
       '全国'                                                                                pro_name,
       '00'                                                                                  city_id,
       '全省'                                                                                city_name,
       substr("202211", 1, 6)                                                                month_id,
       ''                                                                                    day_id,
       '2'                                                                                   date_type,
       '<0.047件/万户'                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ''                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ''                                                                                    day_relative_ratio,
       ''                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.047, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ''                                                                                    refer_count_10,
       ''                                                                                    refer_count_9,
       ''                                                                                    refer_count_8,
       ''                                                                                    refer_count_7,
       ''                                                                                    refer_count_6,
       ''                                                                                    refer_count_5,
       ''                                                                                    refer_count_4,
       ''                                                                                    refer_count_3,
       ''                                                                                    refer_count_2,
       ''                                                                                    refer_count_1,
       '关键'                                                                                index_value,
       'GJ'                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202211")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>尚未与用户联系",
                                     "投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>尚未与用户联系")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202211")
                 and kpi_code in ("CKP_67269", "-")
                 and prov_id = "111") b
union all
select 'FWBZ097'                                                                             index_code,
       'ZY_'                                                                                 index_type,
       'GZ'                                                                                  index_level_1_id,
       '公众客户'                                                                            index_level_1_name,
       '03'                                                                                  index_level_2_id,
       '渠道服务'                                                                            index_level_2_name,
       '13'                                                                                  index_level_3_id,
       '智家工程师'                                                                          index_level_3_name,
       '12'                                                                                  index_level_4_id,
       '上门预约'                                                                            index_level_4_name,
       '故障联系不及时投诉率'                                                                index_name,
       '00'                                                                                  pro_id,
       '全国'                                                                                pro_name,
       '00'                                                                                  city_id,
       '全省'                                                                                city_name,
       substr("202212", 1, 6)                                                                month_id,
       ''                                                                                    day_id,
       '2'                                                                                   date_type,
       '<0.047件/万户'                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ''                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ''                                                                                    day_relative_ratio,
       ''                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.047, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ''                                                                                    refer_count_10,
       ''                                                                                    refer_count_9,
       ''                                                                                    refer_count_8,
       ''                                                                                    refer_count_7,
       ''                                                                                    refer_count_6,
       ''                                                                                    refer_count_5,
       ''                                                                                    refer_count_4,
       ''                                                                                    refer_count_3,
       ''                                                                                    refer_count_2,
       ''                                                                                    refer_count_1,
       '关键'                                                                                index_value,
       'GJ'                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202212")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>尚未与用户联系",
                                     "投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>尚未与用户联系")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202212")
                 and kpi_code in ("CKP_67269", "-")
                 and prov_id = "111") b
union all
select 'FWBZ097'                                                                             index_code,
       'ZY_'                                                                                 index_type,
       'GZ'                                                                                  index_level_1_id,
       '公众客户'                                                                            index_level_1_name,
       '03'                                                                                  index_level_2_id,
       '渠道服务'                                                                            index_level_2_name,
       '13'                                                                                  index_level_3_id,
       '智家工程师'                                                                          index_level_3_name,
       '12'                                                                                  index_level_4_id,
       '上门预约'                                                                            index_level_4_name,
       '故障联系不及时投诉率'                                                                index_name,
       '00'                                                                                  pro_id,
       '全国'                                                                                pro_name,
       '00'                                                                                  city_id,
       '全省'                                                                                city_name,
       substr("202301", 1, 6)                                                                month_id,
       ''                                                                                    day_id,
       '2'                                                                                   date_type,
       '<0.047件/万户'                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ''                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ''                                                                                    day_relative_ratio,
       ''                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.047, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ''                                                                                    refer_count_10,
       ''                                                                                    refer_count_9,
       ''                                                                                    refer_count_8,
       ''                                                                                    refer_count_7,
       ''                                                                                    refer_count_6,
       ''                                                                                    refer_count_5,
       ''                                                                                    refer_count_4,
       ''                                                                                    refer_count_3,
       ''                                                                                    refer_count_2,
       ''                                                                                    refer_count_1,
       '关键'                                                                                index_value,
       'GJ'                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202301")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>尚未与用户联系",
                                     "投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>尚未与用户联系")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202301")
                 and kpi_code in ("CKP_67269", "-")
                 and prov_id = "111") b
union all
select 'FWBZ097'                                                                             index_code,
       'ZY_'                                                                                 index_type,
       'GZ'                                                                                  index_level_1_id,
       '公众客户'                                                                            index_level_1_name,
       '03'                                                                                  index_level_2_id,
       '渠道服务'                                                                            index_level_2_name,
       '13'                                                                                  index_level_3_id,
       '智家工程师'                                                                          index_level_3_name,
       '12'                                                                                  index_level_4_id,
       '上门预约'                                                                            index_level_4_name,
       '故障联系不及时投诉率'                                                                index_name,
       '00'                                                                                  pro_id,
       '全国'                                                                                pro_name,
       '00'                                                                                  city_id,
       '全省'                                                                                city_name,
       substr("202302", 1, 6)                                                                month_id,
       ''                                                                                    day_id,
       '2'                                                                                   date_type,
       '<0.047件/万户'                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ''                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ''                                                                                    day_relative_ratio,
       ''                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.047, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ''                                                                                    refer_count_10,
       ''                                                                                    refer_count_9,
       ''                                                                                    refer_count_8,
       ''                                                                                    refer_count_7,
       ''                                                                                    refer_count_6,
       ''                                                                                    refer_count_5,
       ''                                                                                    refer_count_4,
       ''                                                                                    refer_count_3,
       ''                                                                                    refer_count_2,
       ''                                                                                    refer_count_1,
       '关键'                                                                                index_value,
       'GJ'                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202302")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>尚未与用户联系",
                                     "投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>尚未与用户联系")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202302")
                 and kpi_code in ("CKP_67269", "-")
                 and prov_id = "111") b
union all
select 'FWBZ097'                                                                             index_code,
       'ZY_'                                                                                 index_type,
       'GZ'                                                                                  index_level_1_id,
       '公众客户'                                                                            index_level_1_name,
       '03'                                                                                  index_level_2_id,
       '渠道服务'                                                                            index_level_2_name,
       '13'                                                                                  index_level_3_id,
       '智家工程师'                                                                          index_level_3_name,
       '12'                                                                                  index_level_4_id,
       '上门预约'                                                                            index_level_4_name,
       '故障联系不及时投诉率'                                                                index_name,
       '00'                                                                                  pro_id,
       '全国'                                                                                pro_name,
       '00'                                                                                  city_id,
       '全省'                                                                                city_name,
       substr("202303", 1, 6)                                                                month_id,
       ''                                                                                    day_id,
       '2'                                                                                   date_type,
       '<0.047件/万户'                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ''                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ''                                                                                    day_relative_ratio,
       ''                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.047, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ''                                                                                    refer_count_10,
       ''                                                                                    refer_count_9,
       ''                                                                                    refer_count_8,
       ''                                                                                    refer_count_7,
       ''                                                                                    refer_count_6,
       ''                                                                                    refer_count_5,
       ''                                                                                    refer_count_4,
       ''                                                                                    refer_count_3,
       ''                                                                                    refer_count_2,
       ''                                                                                    refer_count_1,
       '关键'                                                                                index_value,
       'GJ'                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202303")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>尚未与用户联系",
                                     "投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>尚未与用户联系")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202303")
                 and kpi_code in ("CKP_67269", "-")
                 and prov_id = "111") b
union all
select 'FWBZ097'                                                                             index_code,
       'ZY_'                                                                                 index_type,
       'GZ'                                                                                  index_level_1_id,
       '公众客户'                                                                            index_level_1_name,
       '03'                                                                                  index_level_2_id,
       '渠道服务'                                                                            index_level_2_name,
       '13'                                                                                  index_level_3_id,
       '智家工程师'                                                                          index_level_3_name,
       '12'                                                                                  index_level_4_id,
       '上门预约'                                                                            index_level_4_name,
       '故障联系不及时投诉率'                                                                index_name,
       '00'                                                                                  pro_id,
       '全国'                                                                                pro_name,
       '00'                                                                                  city_id,
       '全省'                                                                                city_name,
       substr("202304", 1, 6)                                                                month_id,
       ''                                                                                    day_id,
       '2'                                                                                   date_type,
       '<0.047件/万户'                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ''                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ''                                                                                    day_relative_ratio,
       ''                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.047, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ''                                                                                    refer_count_10,
       ''                                                                                    refer_count_9,
       ''                                                                                    refer_count_8,
       ''                                                                                    refer_count_7,
       ''                                                                                    refer_count_6,
       ''                                                                                    refer_count_5,
       ''                                                                                    refer_count_4,
       ''                                                                                    refer_count_3,
       ''                                                                                    refer_count_2,
       ''                                                                                    refer_count_1,
       '关键'                                                                                index_value,
       'GJ'                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202304")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>尚未与用户联系",
                                     "投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>尚未与用户联系")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202304")
                 and kpi_code in ("CKP_67269", "-")
                 and prov_id = "111") b
union all
select 'FWBZ097'                                                                             index_code,
       'ZY_'                                                                                 index_type,
       'GZ'                                                                                  index_level_1_id,
       '公众客户'                                                                            index_level_1_name,
       '03'                                                                                  index_level_2_id,
       '渠道服务'                                                                            index_level_2_name,
       '13'                                                                                  index_level_3_id,
       '智家工程师'                                                                          index_level_3_name,
       '12'                                                                                  index_level_4_id,
       '上门预约'                                                                            index_level_4_name,
       '故障联系不及时投诉率'                                                                index_name,
       '00'                                                                                  pro_id,
       '全国'                                                                                pro_name,
       '00'                                                                                  city_id,
       '全省'                                                                                city_name,
       substr("202305", 1, 6)                                                                month_id,
       ''                                                                                    day_id,
       '2'                                                                                   date_type,
       '<0.047件/万户'                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ''                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ''                                                                                    day_relative_ratio,
       ''                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.047, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ''                                                                                    refer_count_10,
       ''                                                                                    refer_count_9,
       ''                                                                                    refer_count_8,
       ''                                                                                    refer_count_7,
       ''                                                                                    refer_count_6,
       ''                                                                                    refer_count_5,
       ''                                                                                    refer_count_4,
       ''                                                                                    refer_count_3,
       ''                                                                                    refer_count_2,
       ''                                                                                    refer_count_1,
       '关键'                                                                                index_value,
       'GJ'                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202305")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>尚未与用户联系",
                                     "投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>尚未与用户联系")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202305")
                 and kpi_code in ("CKP_67269", "-")
                 and prov_id = "111") b
union all
select 'FWBZ097'                                                                             index_code,
       'ZY_'                                                                                 index_type,
       'GZ'                                                                                  index_level_1_id,
       '公众客户'                                                                            index_level_1_name,
       '03'                                                                                  index_level_2_id,
       '渠道服务'                                                                            index_level_2_name,
       '13'                                                                                  index_level_3_id,
       '智家工程师'                                                                          index_level_3_name,
       '12'                                                                                  index_level_4_id,
       '上门预约'                                                                            index_level_4_name,
       '故障联系不及时投诉率'                                                                index_name,
       '00'                                                                                  pro_id,
       '全国'                                                                                pro_name,
       '00'                                                                                  city_id,
       '全省'                                                                                city_name,
       substr("202306", 1, 6)                                                                month_id,
       ''                                                                                    day_id,
       '2'                                                                                   date_type,
       '<0.047件/万户'                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ''                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ''                                                                                    day_relative_ratio,
       ''                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.047, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ''                                                                                    refer_count_10,
       ''                                                                                    refer_count_9,
       ''                                                                                    refer_count_8,
       ''                                                                                    refer_count_7,
       ''                                                                                    refer_count_6,
       ''                                                                                    refer_count_5,
       ''                                                                                    refer_count_4,
       ''                                                                                    refer_count_3,
       ''                                                                                    refer_count_2,
       ''                                                                                    refer_count_1,
       '关键'                                                                                index_value,
       'GJ'                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202306")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>尚未与用户联系",
                                     "投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>尚未与用户联系")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202306")
                 and kpi_code in ("CKP_67269", "-")
                 and prov_id = "111") b
union all
select 'FWBZ097'                                                                             index_code,
       'ZY_'                                                                                 index_type,
       'GZ'                                                                                  index_level_1_id,
       '公众客户'                                                                            index_level_1_name,
       '03'                                                                                  index_level_2_id,
       '渠道服务'                                                                            index_level_2_name,
       '13'                                                                                  index_level_3_id,
       '智家工程师'                                                                          index_level_3_name,
       '12'                                                                                  index_level_4_id,
       '上门预约'                                                                            index_level_4_name,
       '故障联系不及时投诉率'                                                                index_name,
       '00'                                                                                  pro_id,
       '全国'                                                                                pro_name,
       '00'                                                                                  city_id,
       '全省'                                                                                city_name,
       substr("202307", 1, 6)                                                                month_id,
       ''                                                                                    day_id,
       '2'                                                                                   date_type,
       '<0.047件/万户'                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ''                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ''                                                                                    day_relative_ratio,
       ''                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.047, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ''                                                                                    refer_count_10,
       ''                                                                                    refer_count_9,
       ''                                                                                    refer_count_8,
       ''                                                                                    refer_count_7,
       ''                                                                                    refer_count_6,
       ''                                                                                    refer_count_5,
       ''                                                                                    refer_count_4,
       ''                                                                                    refer_count_3,
       ''                                                                                    refer_count_2,
       ''                                                                                    refer_count_1,
       '关键'                                                                                index_value,
       'GJ'                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202307")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>尚未与用户联系",
                                     "投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>尚未与用户联系")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202307")
                 and kpi_code in ("CKP_67269", "-")
                 and prov_id = "111") b
union all
select 'FWBZ097'                                                                             index_code,
       'ZY_'                                                                                 index_type,
       'GZ'                                                                                  index_level_1_id,
       '公众客户'                                                                            index_level_1_name,
       '03'                                                                                  index_level_2_id,
       '渠道服务'                                                                            index_level_2_name,
       '13'                                                                                  index_level_3_id,
       '智家工程师'                                                                          index_level_3_name,
       '12'                                                                                  index_level_4_id,
       '上门预约'                                                                            index_level_4_name,
       '故障联系不及时投诉率'                                                                index_name,
       '00'                                                                                  pro_id,
       '全国'                                                                                pro_name,
       '00'                                                                                  city_id,
       '全省'                                                                                city_name,
       substr("202308", 1, 6)                                                                month_id,
       ''                                                                                    day_id,
       '2'                                                                                   date_type,
       '<0.047件/万户'                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ''                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ''                                                                                    day_relative_ratio,
       ''                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.047, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ''                                                                                    refer_count_10,
       ''                                                                                    refer_count_9,
       ''                                                                                    refer_count_8,
       ''                                                                                    refer_count_7,
       ''                                                                                    refer_count_6,
       ''                                                                                    refer_count_5,
       ''                                                                                    refer_count_4,
       ''                                                                                    refer_count_3,
       ''                                                                                    refer_count_2,
       ''                                                                                    refer_count_1,
       '关键'                                                                                index_value,
       'GJ'                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202308")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>尚未与用户联系",
                                     "投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>尚未与用户联系")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202308")
                 and kpi_code in ("CKP_67269", "-")
                 and prov_id = "111") b
union all
select 'FWBZ097'                                                                             index_code,
       'ZY_'                                                                                 index_type,
       'GZ'                                                                                  index_level_1_id,
       '公众客户'                                                                            index_level_1_name,
       '03'                                                                                  index_level_2_id,
       '渠道服务'                                                                            index_level_2_name,
       '13'                                                                                  index_level_3_id,
       '智家工程师'                                                                          index_level_3_name,
       '12'                                                                                  index_level_4_id,
       '上门预约'                                                                            index_level_4_name,
       '故障联系不及时投诉率'                                                                index_name,
       '00'                                                                                  pro_id,
       '全国'                                                                                pro_name,
       '00'                                                                                  city_id,
       '全省'                                                                                city_name,
       substr("202309", 1, 6)                                                                month_id,
       ''                                                                                    day_id,
       '2'                                                                                   date_type,
       '<0.047件/万户'                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ''                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ''                                                                                    day_relative_ratio,
       ''                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.047, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ''                                                                                    refer_count_10,
       ''                                                                                    refer_count_9,
       ''                                                                                    refer_count_8,
       ''                                                                                    refer_count_7,
       ''                                                                                    refer_count_6,
       ''                                                                                    refer_count_5,
       ''                                                                                    refer_count_4,
       ''                                                                                    refer_count_3,
       ''                                                                                    refer_count_2,
       ''                                                                                    refer_count_1,
       '关键'                                                                                index_value,
       'GJ'                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202309")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>尚未与用户联系",
                                     "投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>尚未与用户联系")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202309")
                 and kpi_code in ("CKP_67269", "-")
                 and prov_id = "111") b
;

-- todo 2 故障上门不准时投诉率 40   完成
select "FWBZ098"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "03"                                                                                  index_level_2_id,
       "渠道服务"                                                                            index_level_2_name,
       "13"                                                                                  index_level_3_id,
       "智家工程师"                                                                          index_level_3_name,
       "12"                                                                                  index_level_4_id,
       "上门预约"                                                                            index_level_4_name,
       "故障上门不准时投诉率"                                                                index_name,
       a.prov_code                                                                           pro_id,
       a.prov_name                                                                           pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202212", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.394件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.394, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_level,
       "GJ"                                                                                  index_level_code
from (select b.prov_code prov_code, b.prov_name prov_name, count(1) n
      from (select sheet_id, compl_area
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202207")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>没有按时上门/修障不及时",
                                     "投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>没有按时上门/修障不及时")
              and sheet_status not in ("8", "11")) a
               left join dc_dim.dim_pro_city_regoin b on a.compl_area = b.code_value
      group by b.prov_code, b.prov_name) a
         left join (select substr(prov_id, 2, 3) pro_id, prov_name, cast(sum(kpi_value) as bigint) n
                    from dc_dwd_cbss.dwd_m_user_info
                    where month_id in
                          ("202207")
                      and kpi_code in ("CKP_67269", "-")
                      and prov_id != "-1"
                    group by prov_id, prov_name) b on a.prov_code = b.pro_id and a.prov_name = b.prov_name
where a.prov_name is not null
  and b.prov_name is not null;
-- union all
select "FWBZ098"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "03"                                                                                  index_level_2_id,
       "渠道服务"                                                                            index_level_2_name,
       "13"                                                                                  index_level_3_id,
       "智家工程师"                                                                          index_level_3_name,
       "12"                                                                                  index_level_4_id,
       "上门预约"                                                                            index_level_4_name,
       "故障上门不准时投诉率"                                                                index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202210", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.394件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.394, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202210")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>没有按时上门/修障不及时",
                                     "投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>没有按时上门/修障不及时")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202210")
                 and kpi_code in ("CKP_67269", "-")
                 and prov_id = "111") b
union all
select "FWBZ098"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "03"                                                                                  index_level_2_id,
       "渠道服务"                                                                            index_level_2_name,
       "13"                                                                                  index_level_3_id,
       "智家工程师"                                                                          index_level_3_name,
       "12"                                                                                  index_level_4_id,
       "上门预约"                                                                            index_level_4_name,
       "故障上门不准时投诉率"                                                                index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202211", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.394件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.394, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202211")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>没有按时上门/修障不及时",
                                     "投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>没有按时上门/修障不及时")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202211")
                 and kpi_code in ("CKP_67269", "-")
                 and prov_id = "111") b
union all
select "FWBZ098"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "03"                                                                                  index_level_2_id,
       "渠道服务"                                                                            index_level_2_name,
       "13"                                                                                  index_level_3_id,
       "智家工程师"                                                                          index_level_3_name,
       "12"                                                                                  index_level_4_id,
       "上门预约"                                                                            index_level_4_name,
       "故障上门不准时投诉率"                                                                index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202212", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.394件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.394, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202212")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>没有按时上门/修障不及时",
                                     "投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>没有按时上门/修障不及时")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202212")
                 and kpi_code in ("CKP_67269", "-")
                 and prov_id = "111") b
union all
select "FWBZ098"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "03"                                                                                  index_level_2_id,
       "渠道服务"                                                                            index_level_2_name,
       "13"                                                                                  index_level_3_id,
       "智家工程师"                                                                          index_level_3_name,
       "12"                                                                                  index_level_4_id,
       "上门预约"                                                                            index_level_4_name,
       "故障上门不准时投诉率"                                                                index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202301", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.394件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.394, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202301")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>没有按时上门/修障不及时",
                                     "投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>没有按时上门/修障不及时")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202301")
                 and kpi_code in ("CKP_67269", "-")
                 and prov_id = "111") b
union all
select "FWBZ098"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "03"                                                                                  index_level_2_id,
       "渠道服务"                                                                            index_level_2_name,
       "13"                                                                                  index_level_3_id,
       "智家工程师"                                                                          index_level_3_name,
       "12"                                                                                  index_level_4_id,
       "上门预约"                                                                            index_level_4_name,
       "故障上门不准时投诉率"                                                                index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202302", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.394件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.394, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202302")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>没有按时上门/修障不及时",
                                     "投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>没有按时上门/修障不及时")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202302")
                 and kpi_code in ("CKP_67269", "-")
                 and prov_id = "111") b
union all
select "FWBZ098"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "03"                                                                                  index_level_2_id,
       "渠道服务"                                                                            index_level_2_name,
       "13"                                                                                  index_level_3_id,
       "智家工程师"                                                                          index_level_3_name,
       "12"                                                                                  index_level_4_id,
       "上门预约"                                                                            index_level_4_name,
       "故障上门不准时投诉率"                                                                index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202303", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.394件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.394, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202303")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>没有按时上门/修障不及时",
                                     "投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>没有按时上门/修障不及时")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202303")
                 and kpi_code in ("CKP_67269", "-")
                 and prov_id = "111") b
union all
select "FWBZ098"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "03"                                                                                  index_level_2_id,
       "渠道服务"                                                                            index_level_2_name,
       "13"                                                                                  index_level_3_id,
       "智家工程师"                                                                          index_level_3_name,
       "12"                                                                                  index_level_4_id,
       "上门预约"                                                                            index_level_4_name,
       "故障上门不准时投诉率"                                                                index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202304", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.394件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.394, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202304")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>没有按时上门/修障不及时",
                                     "投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>没有按时上门/修障不及时")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202304")
                 and kpi_code in ("CKP_67269", "-")
                 and prov_id = "111") b
union all
select "FWBZ098"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "03"                                                                                  index_level_2_id,
       "渠道服务"                                                                            index_level_2_name,
       "13"                                                                                  index_level_3_id,
       "智家工程师"                                                                          index_level_3_name,
       "12"                                                                                  index_level_4_id,
       "上门预约"                                                                            index_level_4_name,
       "故障上门不准时投诉率"                                                                index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202305", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.394件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.394, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202305")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>没有按时上门/修障不及时",
                                     "投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>没有按时上门/修障不及时")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202305")
                 and kpi_code in ("CKP_67269", "-")
                 and prov_id = "111") b
union all
select "FWBZ098"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "03"                                                                                  index_level_2_id,
       "渠道服务"                                                                            index_level_2_name,
       "13"                                                                                  index_level_3_id,
       "智家工程师"                                                                          index_level_3_name,
       "12"                                                                                  index_level_4_id,
       "上门预约"                                                                            index_level_4_name,
       "故障上门不准时投诉率"                                                                index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202306", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.394件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.394, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202306")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>没有按时上门/修障不及时",
                                     "投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>没有按时上门/修障不及时")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202306")
                 and kpi_code in ("CKP_67269", "-")
                 and prov_id = "111") b
union all
select "FWBZ098"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "03"                                                                                  index_level_2_id,
       "渠道服务"                                                                            index_level_2_name,
       "13"                                                                                  index_level_3_id,
       "智家工程师"                                                                          index_level_3_name,
       "12"                                                                                  index_level_4_id,
       "上门预约"                                                                            index_level_4_name,
       "故障上门不准时投诉率"                                                                index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202307", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.394件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.394, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202307")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>没有按时上门/修障不及时",
                                     "投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>没有按时上门/修障不及时")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202307")
                 and kpi_code in ("CKP_67269", "-")
                 and prov_id = "111") b
union all
select "FWBZ098"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "03"                                                                                  index_level_2_id,
       "渠道服务"                                                                            index_level_2_name,
       "13"                                                                                  index_level_3_id,
       "智家工程师"                                                                          index_level_3_name,
       "12"                                                                                  index_level_4_id,
       "上门预约"                                                                            index_level_4_name,
       "故障上门不准时投诉率"                                                                index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202308", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.394件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.394, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202308")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>没有按时上门/修障不及时",
                                     "投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>没有按时上门/修障不及时")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202308")
                 and kpi_code in ("CKP_67269", "-")
                 and prov_id = "111") b
union all
select "FWBZ098"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "03"                                                                                  index_level_2_id,
       "渠道服务"                                                                            index_level_2_name,
       "13"                                                                                  index_level_3_id,
       "智家工程师"                                                                          index_level_3_name,
       "12"                                                                                  index_level_4_id,
       "上门预约"                                                                            index_level_4_name,
       "故障上门不准时投诉率"                                                                index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202309", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.394件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.394, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202309")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>没有按时上门/修障不及时",
                                     "投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>没有按时上门/修障不及时")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202309")
                 and kpi_code in ("CKP_67269", "-")
                 and prov_id = "111") b
;

-- todo 3 智家服务规范投诉率 42     完成
select "FWBZ100"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "03"                                                                                  index_level_2_id,
       "渠道服务"                                                                            index_level_2_name,
       "13"                                                                                  index_level_3_id,
       "智家工程师"                                                                          index_level_3_name,
       "11"                                                                                  index_level_4_id,
       "入户规范"                                                                            index_level_4_name,
       "智家服务规范投诉率"                                                                  index_name,
       a.prov_code                                                                           pro_id,
       a.prov_name                                                                           pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202212", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.01件/万户"                                                                        target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.01, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_level,
       "GJ"                                                                                  index_level_code
from (select b.prov_code prov_code, b.prov_name prov_name, count(1) n
      from (select sheet_id, compl_area
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202207")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>未按上门规范服务",
                                     "投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>未按上门规范服务")
              and sheet_status not in ("8", "11")) a
               left join dc_dim.dim_pro_city_regoin b on a.compl_area = b.code_value
      group by b.prov_code, b.prov_name) a
         left join (select substr(prov_id, 2, 3) pro_id, prov_name, cast(sum(kpi_value) as bigint) n
                    from dc_dwd_cbss.dwd_m_user_info
                    where month_id in
                          ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302", "202303",
                           "202304", "202305", "202306")
                      and kpi_code in ("CKP_67269", "-")
                      and prov_id != "-1"
                    group by prov_id, prov_name) b on a.prov_code = b.pro_id and a.prov_name = b.prov_name
where a.prov_name is not null
  and b.prov_name is not null;
-- union all
select "FWBZ100"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "03"                                                                                  index_level_2_id,
       "渠道服务"                                                                            index_level_2_name,
       "13"                                                                                  index_level_3_id,
       "智家工程师"                                                                          index_level_3_name,
       "11"                                                                                  index_level_4_id,
       "入户规范"                                                                            index_level_4_name,
       "智家服务规范投诉率"                                                                  index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202210", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.01件/万户"                                                                        target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.01, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202210")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>未按上门规范服务",
                                     "投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>未按上门规范服务")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202210")
                 and kpi_code in ("CKP_67269", "-")
                 and prov_id = "111") b
union all
select "FWBZ100"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "03"                                                                                  index_level_2_id,
       "渠道服务"                                                                            index_level_2_name,
       "13"                                                                                  index_level_3_id,
       "智家工程师"                                                                          index_level_3_name,
       "11"                                                                                  index_level_4_id,
       "入户规范"                                                                            index_level_4_name,
       "智家服务规范投诉率"                                                                  index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202211", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.01件/万户"                                                                        target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.01, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202211")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>未按上门规范服务",
                                     "投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>未按上门规范服务")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202211")
                 and kpi_code in ("CKP_67269", "-")
                 and prov_id = "111") b
union all
select "FWBZ100"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "03"                                                                                  index_level_2_id,
       "渠道服务"                                                                            index_level_2_name,
       "13"                                                                                  index_level_3_id,
       "智家工程师"                                                                          index_level_3_name,
       "11"                                                                                  index_level_4_id,
       "入户规范"                                                                            index_level_4_name,
       "智家服务规范投诉率"                                                                  index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202212", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.01件/万户"                                                                        target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.01, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202212")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>未按上门规范服务",
                                     "投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>未按上门规范服务")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202212")
                 and kpi_code in ("CKP_67269", "-")
                 and prov_id = "111") b
union all
select "FWBZ100"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "03"                                                                                  index_level_2_id,
       "渠道服务"                                                                            index_level_2_name,
       "13"                                                                                  index_level_3_id,
       "智家工程师"                                                                          index_level_3_name,
       "11"                                                                                  index_level_4_id,
       "入户规范"                                                                            index_level_4_name,
       "智家服务规范投诉率"                                                                  index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202301", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.01件/万户"                                                                        target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.01, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202301")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>未按上门规范服务",
                                     "投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>未按上门规范服务")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202301")
                 and kpi_code in ("CKP_67269", "-")
                 and prov_id = "111") b
union all
select "FWBZ100"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "03"                                                                                  index_level_2_id,
       "渠道服务"                                                                            index_level_2_name,
       "13"                                                                                  index_level_3_id,
       "智家工程师"                                                                          index_level_3_name,
       "11"                                                                                  index_level_4_id,
       "入户规范"                                                                            index_level_4_name,
       "智家服务规范投诉率"                                                                  index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202302", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.01件/万户"                                                                        target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.01, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202302")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>未按上门规范服务",
                                     "投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>未按上门规范服务")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202302")
                 and kpi_code in ("CKP_67269", "-")
                 and prov_id = "111") b
union all
select "FWBZ100"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "03"                                                                                  index_level_2_id,
       "渠道服务"                                                                            index_level_2_name,
       "13"                                                                                  index_level_3_id,
       "智家工程师"                                                                          index_level_3_name,
       "11"                                                                                  index_level_4_id,
       "入户规范"                                                                            index_level_4_name,
       "智家服务规范投诉率"                                                                  index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202303", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.01件/万户"                                                                        target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.01, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202303")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>未按上门规范服务",
                                     "投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>未按上门规范服务")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202303")
                 and kpi_code in ("CKP_67269", "-")
                 and prov_id = "111") b
union all
select "FWBZ100"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "03"                                                                                  index_level_2_id,
       "渠道服务"                                                                            index_level_2_name,
       "13"                                                                                  index_level_3_id,
       "智家工程师"                                                                          index_level_3_name,
       "11"                                                                                  index_level_4_id,
       "入户规范"                                                                            index_level_4_name,
       "智家服务规范投诉率"                                                                  index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202304", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.01件/万户"                                                                        target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.01, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202304")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>未按上门规范服务",
                                     "投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>未按上门规范服务")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202304")
                 and kpi_code in ("CKP_67269", "-")
                 and prov_id = "111") b
union all
select "FWBZ100"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "03"                                                                                  index_level_2_id,
       "渠道服务"                                                                            index_level_2_name,
       "13"                                                                                  index_level_3_id,
       "智家工程师"                                                                          index_level_3_name,
       "11"                                                                                  index_level_4_id,
       "入户规范"                                                                            index_level_4_name,
       "智家服务规范投诉率"                                                                  index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202305", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.01件/万户"                                                                        target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.01, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202305")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>未按上门规范服务",
                                     "投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>未按上门规范服务")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202305")
                 and kpi_code in ("CKP_67269", "-")
                 and prov_id = "111") b
union all
select "FWBZ100"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "03"                                                                                  index_level_2_id,
       "渠道服务"                                                                            index_level_2_name,
       "13"                                                                                  index_level_3_id,
       "智家工程师"                                                                          index_level_3_name,
       "11"                                                                                  index_level_4_id,
       "入户规范"                                                                            index_level_4_name,
       "智家服务规范投诉率"                                                                  index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202306", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.01件/万户"                                                                        target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.01, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202306")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>未按上门规范服务",
                                     "投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>未按上门规范服务")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202306")
                 and kpi_code in ("CKP_67269", "-")
                 and prov_id = "111") b
union all
select "FWBZ100"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "03"                                                                                  index_level_2_id,
       "渠道服务"                                                                            index_level_2_name,
       "13"                                                                                  index_level_3_id,
       "智家工程师"                                                                          index_level_3_name,
       "11"                                                                                  index_level_4_id,
       "入户规范"                                                                            index_level_4_name,
       "智家服务规范投诉率"                                                                  index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202307", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.01件/万户"                                                                        target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.01, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202307")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>未按上门规范服务",
                                     "投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>未按上门规范服务")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202307")
                 and kpi_code in ("CKP_67269", "-")
                 and prov_id = "111") b
union all
select "FWBZ100"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "03"                                                                                  index_level_2_id,
       "渠道服务"                                                                            index_level_2_name,
       "13"                                                                                  index_level_3_id,
       "智家工程师"                                                                          index_level_3_name,
       "11"                                                                                  index_level_4_id,
       "入户规范"                                                                            index_level_4_name,
       "智家服务规范投诉率"                                                                  index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202308", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.01件/万户"                                                                        target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.01, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202308")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>未按上门规范服务",
                                     "投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>未按上门规范服务")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202308")
                 and kpi_code in ("CKP_67269", "-")
                 and prov_id = "111") b
union all
select "FWBZ100"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "03"                                                                                  index_level_2_id,
       "渠道服务"                                                                            index_level_2_name,
       "13"                                                                                  index_level_3_id,
       "智家工程师"                                                                          index_level_3_name,
       "11"                                                                                  index_level_4_id,
       "入户规范"                                                                            index_level_4_name,
       "智家服务规范投诉率"                                                                  index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202309", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.01件/万户"                                                                        target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.01, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202309")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>未按上门规范服务",
                                     "投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>未按上门规范服务")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202309")
                 and kpi_code in ("CKP_67269", "-")
                 and prov_id = "111") b
;

-- todo 4 智家服务技能投诉率 44 ---------------------------------------------------------------------------------------
select b.pro_id                                                                    pro_id,
       b.prov_name                                                                 pro_name,
       '00'                                                                        city_id,
       '全省'                                                                      city_name,
       '智家服务技能投诉率'                                                        index_name,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select a.prov_name,
             a.prov_code,
             if(a.n is null, 0, a.n) n
      from (select b.prov_code prov_code,
                   b.prov_name prov_name,
                   count(1)    n
            from (select sheet_id,
                         compl_area
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                         "202303", "202304", "202305", "202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>人员操作不熟练',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>人员操作不熟练',
                          '投诉工单（2021版）>>宽带>>【入网】办理>>智家工程师办理差错/不成功',
                          '投诉工单（2021版）>>移网>>【入网】办理>>智家工程师办理差错/不成功',
                          '投诉工单（2021版）>>融合>>【入网】办理>>智家工程师办理差错/不成功'
                            )
                    and sheet_status not in ('8', '11')) a
                     left join dc_dim.dim_pro_city_regoin_cb b on
                a.compl_area = b.code_value
            group by b.prov_code,
                     b.prov_name) a) a
         right join (select substr(prov_id, 2, 3)          pro_id,
                            prov_name,
                            cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                            "202303", "202304", "202305", "202306")
                       and kpi_code in ('CKP_66829', '-')
                       and city_id != '-1'
                     group by prov_id,
                              prov_name) b on
            a.prov_code = b.pro_id
        and a.prov_name = b.prov_name
where b.prov_name is not null;
-- union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '智家服务技能投诉率'                                                        index_name,
       '202210'                                                                    day_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202210")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>人员操作不熟练',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>人员操作不熟练',
                          '投诉工单（2021版）>>宽带>>【入网】办理>>智家工程师办理差错/不成功',
                          '投诉工单（2021版）>>移网>>【入网】办理>>智家工程师办理差错/不成功',
                          '投诉工单（2021版）>>融合>>【入网】办理>>智家工程师办理差错/不成功'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202210")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '智家服务技能投诉率'                                                        index_name,
       '202211'                                                                    day_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202211")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>人员操作不熟练',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>人员操作不熟练',
                          '投诉工单（2021版）>>宽带>>【入网】办理>>智家工程师办理差错/不成功',
                          '投诉工单（2021版）>>移网>>【入网】办理>>智家工程师办理差错/不成功',
                          '投诉工单（2021版）>>融合>>【入网】办理>>智家工程师办理差错/不成功'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202211")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '智家服务技能投诉率'                                                        index_name,
       '202212'                                                                    day_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202212")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>人员操作不熟练',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>人员操作不熟练',
                          '投诉工单（2021版）>>宽带>>【入网】办理>>智家工程师办理差错/不成功',
                          '投诉工单（2021版）>>移网>>【入网】办理>>智家工程师办理差错/不成功',
                          '投诉工单（2021版）>>融合>>【入网】办理>>智家工程师办理差错/不成功'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202212")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '智家服务技能投诉率'                                                        index_name,
       '202301'                                                                    day_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202301")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>人员操作不熟练',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>人员操作不熟练',
                          '投诉工单（2021版）>>宽带>>【入网】办理>>智家工程师办理差错/不成功',
                          '投诉工单（2021版）>>移网>>【入网】办理>>智家工程师办理差错/不成功',
                          '投诉工单（2021版）>>融合>>【入网】办理>>智家工程师办理差错/不成功'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202301")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '智家服务技能投诉率'                                                        index_name,
       '202302'                                                                    day_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202302")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>人员操作不熟练',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>人员操作不熟练',
                          '投诉工单（2021版）>>宽带>>【入网】办理>>智家工程师办理差错/不成功',
                          '投诉工单（2021版）>>移网>>【入网】办理>>智家工程师办理差错/不成功',
                          '投诉工单（2021版）>>融合>>【入网】办理>>智家工程师办理差错/不成功'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202302")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '智家服务技能投诉率'                                                        index_name,
       '202303'                                                                    day_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202303")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>人员操作不熟练',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>人员操作不熟练',
                          '投诉工单（2021版）>>宽带>>【入网】办理>>智家工程师办理差错/不成功',
                          '投诉工单（2021版）>>移网>>【入网】办理>>智家工程师办理差错/不成功',
                          '投诉工单（2021版）>>融合>>【入网】办理>>智家工程师办理差错/不成功'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202303")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '智家服务技能投诉率'                                                        index_name,
       '202304'                                                                    day_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202304")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>人员操作不熟练',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>人员操作不熟练',
                          '投诉工单（2021版）>>宽带>>【入网】办理>>智家工程师办理差错/不成功',
                          '投诉工单（2021版）>>移网>>【入网】办理>>智家工程师办理差错/不成功',
                          '投诉工单（2021版）>>融合>>【入网】办理>>智家工程师办理差错/不成功'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202304")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '智家服务技能投诉率'                                                        index_name,
       '202305'                                                                    day_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202305")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>人员操作不熟练',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>人员操作不熟练',
                          '投诉工单（2021版）>>宽带>>【入网】办理>>智家工程师办理差错/不成功',
                          '投诉工单（2021版）>>移网>>【入网】办理>>智家工程师办理差错/不成功',
                          '投诉工单（2021版）>>融合>>【入网】办理>>智家工程师办理差错/不成功'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202305")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '智家服务技能投诉率'                                                        index_name,
       '202306'                                                                    day_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>人员操作不熟练',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>人员操作不熟练',
                          '投诉工单（2021版）>>宽带>>【入网】办理>>智家工程师办理差错/不成功',
                          '投诉工单（2021版）>>移网>>【入网】办理>>智家工程师办理差错/不成功',
                          '投诉工单（2021版）>>融合>>【入网】办理>>智家工程师办理差错/不成功'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202306")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '智家服务技能投诉率'                                                        index_name,
       '202307'                                                                    day_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202307")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>人员操作不熟练',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>人员操作不熟练',
                          '投诉工单（2021版）>>宽带>>【入网】办理>>智家工程师办理差错/不成功',
                          '投诉工单（2021版）>>移网>>【入网】办理>>智家工程师办理差错/不成功',
                          '投诉工单（2021版）>>融合>>【入网】办理>>智家工程师办理差错/不成功'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202307")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '智家服务技能投诉率'                                                        index_name,
       '202306'                                                                    day_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202308")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>人员操作不熟练',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>人员操作不熟练',
                          '投诉工单（2021版）>>宽带>>【入网】办理>>智家工程师办理差错/不成功',
                          '投诉工单（2021版）>>移网>>【入网】办理>>智家工程师办理差错/不成功',
                          '投诉工单（2021版）>>融合>>【入网】办理>>智家工程师办理差错/不成功'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202308")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '智家服务技能投诉率'                                                        index_name,
       '202309'                                                                    day_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202309")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>人员操作不熟练',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>人员操作不熟练',
                          '投诉工单（2021版）>>宽带>>【入网】办理>>智家工程师办理差错/不成功',
                          '投诉工单（2021版）>>移网>>【入网】办理>>智家工程师办理差错/不成功',
                          '投诉工单（2021版）>>融合>>【入网】办理>>智家工程师办理差错/不成功'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202309")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
;


-- todo 5 智家服务态度投诉率 45 完成
select "FWBZ101"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "03"                                                                                  index_level_2_id,
       "渠道服务"                                                                            index_level_2_name,
       "13"                                                                                  index_level_3_id,
       "智家工程师"                                                                          index_level_3_name,
       "11"                                                                                  index_level_4_id,
       "入户规范"                                                                            index_level_4_name,
       "智家服务态度投诉率"                                                                  index_name,
       a.prov_code                                                                           pro_id,
       a.prov_name                                                                           pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202212", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.139件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.139, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_level,
       "GJ"                                                                                  index_level_code
from (select b.prov_code prov_code, b.prov_name prov_name, count(1) n
      from (select sheet_id, compl_area
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202207")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【入网】装机>>装机人员服务问题",
                                     "投诉工单（2021版）>>融合>>【变更及服务】宽带移机>>移机人员服务问题",
                                     "投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>人员态度不好",
                                     "投诉工单（2021版）>>宽带>>【入网】装机>>装机人员服务问题",
                                     "投诉工单（2021版）>>宽带>>【变更及服务】宽带移机>>移机人员服务问题",
                                     "投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>人员态度不好")
              and sheet_status not in ("8", "11")) a
               left join dc_dim.dim_pro_city_regoin b on a.compl_area = b.code_value
      group by b.prov_code, b.prov_name) a
         left join (select substr(prov_id, 2, 3) pro_id, prov_name, cast(sum(kpi_value) as bigint) n
                    from dc_dwd_cbss.dwd_m_user_info
                    where month_id in
                          ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302", "202303",
                           "202304", "202305", "202306")
                      and kpi_code in ("CKP_67269", "-")
                      and prov_id != "-1"
                    group by prov_id, prov_name) b on a.prov_code = b.pro_id and a.prov_name = b.prov_name
where a.prov_name is not null
  and b.prov_name is not null;
-- union all
select "FWBZ101"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "03"                                                                                  index_level_2_id,
       "渠道服务"                                                                            index_level_2_name,
       "13"                                                                                  index_level_3_id,
       "智家工程师"                                                                          index_level_3_name,
       "11"                                                                                  index_level_4_id,
       "入户规范"                                                                            index_level_4_name,
       "智家服务态度投诉率"                                                                  index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202210", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.139件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.139, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202210")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【入网】装机>>装机人员服务问题",
                                     "投诉工单（2021版）>>融合>>【变更及服务】宽带移机>>移机人员服务问题",
                                     "投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>人员态度不好",
                                     "投诉工单（2021版）>>宽带>>【入网】装机>>装机人员服务问题",
                                     "投诉工单（2021版）>>宽带>>【变更及服务】宽带移机>>移机人员服务问题",
                                     "投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>人员态度不好")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202210")
                 and kpi_code in ("CKP_67269", "-")
                 and prov_id = "111") b
union all
select "FWBZ101"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "03"                                                                                  index_level_2_id,
       "渠道服务"                                                                            index_level_2_name,
       "13"                                                                                  index_level_3_id,
       "智家工程师"                                                                          index_level_3_name,
       "11"                                                                                  index_level_4_id,
       "入户规范"                                                                            index_level_4_name,
       "智家服务态度投诉率"                                                                  index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202211", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.139件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.139, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202211")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【入网】装机>>装机人员服务问题",
                                     "投诉工单（2021版）>>融合>>【变更及服务】宽带移机>>移机人员服务问题",
                                     "投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>人员态度不好",
                                     "投诉工单（2021版）>>宽带>>【入网】装机>>装机人员服务问题",
                                     "投诉工单（2021版）>>宽带>>【变更及服务】宽带移机>>移机人员服务问题",
                                     "投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>人员态度不好")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202211")
                 and kpi_code in ("CKP_67269", "-")
                 and prov_id = "111") b
union all
select "FWBZ101"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "03"                                                                                  index_level_2_id,
       "渠道服务"                                                                            index_level_2_name,
       "13"                                                                                  index_level_3_id,
       "智家工程师"                                                                          index_level_3_name,
       "11"                                                                                  index_level_4_id,
       "入户规范"                                                                            index_level_4_name,
       "智家服务态度投诉率"                                                                  index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202212", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.139件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.139, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202212")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【入网】装机>>装机人员服务问题",
                                     "投诉工单（2021版）>>融合>>【变更及服务】宽带移机>>移机人员服务问题",
                                     "投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>人员态度不好",
                                     "投诉工单（2021版）>>宽带>>【入网】装机>>装机人员服务问题",
                                     "投诉工单（2021版）>>宽带>>【变更及服务】宽带移机>>移机人员服务问题",
                                     "投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>人员态度不好")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202212")
                 and kpi_code in ("CKP_67269", "-")
                 and prov_id = "111") b
union all
select "FWBZ101"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "03"                                                                                  index_level_2_id,
       "渠道服务"                                                                            index_level_2_name,
       "13"                                                                                  index_level_3_id,
       "智家工程师"                                                                          index_level_3_name,
       "11"                                                                                  index_level_4_id,
       "入户规范"                                                                            index_level_4_name,
       "智家服务态度投诉率"                                                                  index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202301", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.139件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.139, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202301")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【入网】装机>>装机人员服务问题",
                                     "投诉工单（2021版）>>融合>>【变更及服务】宽带移机>>移机人员服务问题",
                                     "投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>人员态度不好",
                                     "投诉工单（2021版）>>宽带>>【入网】装机>>装机人员服务问题",
                                     "投诉工单（2021版）>>宽带>>【变更及服务】宽带移机>>移机人员服务问题",
                                     "投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>人员态度不好")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202301")
                 and kpi_code in ("CKP_67269", "-")
                 and prov_id = "111") b
union all
select "FWBZ101"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "03"                                                                                  index_level_2_id,
       "渠道服务"                                                                            index_level_2_name,
       "13"                                                                                  index_level_3_id,
       "智家工程师"                                                                          index_level_3_name,
       "11"                                                                                  index_level_4_id,
       "入户规范"                                                                            index_level_4_name,
       "智家服务态度投诉率"                                                                  index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202302", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.139件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.139, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202302")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【入网】装机>>装机人员服务问题",
                                     "投诉工单（2021版）>>融合>>【变更及服务】宽带移机>>移机人员服务问题",
                                     "投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>人员态度不好",
                                     "投诉工单（2021版）>>宽带>>【入网】装机>>装机人员服务问题",
                                     "投诉工单（2021版）>>宽带>>【变更及服务】宽带移机>>移机人员服务问题",
                                     "投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>人员态度不好")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202302")
                 and kpi_code in ("CKP_67269", "-")
                 and prov_id = "111") b
union all
select "FWBZ101"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "03"                                                                                  index_level_2_id,
       "渠道服务"                                                                            index_level_2_name,
       "13"                                                                                  index_level_3_id,
       "智家工程师"                                                                          index_level_3_name,
       "11"                                                                                  index_level_4_id,
       "入户规范"                                                                            index_level_4_name,
       "智家服务态度投诉率"                                                                  index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202303", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.139件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.139, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202303")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【入网】装机>>装机人员服务问题",
                                     "投诉工单（2021版）>>融合>>【变更及服务】宽带移机>>移机人员服务问题",
                                     "投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>人员态度不好",
                                     "投诉工单（2021版）>>宽带>>【入网】装机>>装机人员服务问题",
                                     "投诉工单（2021版）>>宽带>>【变更及服务】宽带移机>>移机人员服务问题",
                                     "投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>人员态度不好")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202303")
                 and kpi_code in ("CKP_67269", "-")
                 and prov_id = "111") b
union all
select "FWBZ101"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "03"                                                                                  index_level_2_id,
       "渠道服务"                                                                            index_level_2_name,
       "13"                                                                                  index_level_3_id,
       "智家工程师"                                                                          index_level_3_name,
       "11"                                                                                  index_level_4_id,
       "入户规范"                                                                            index_level_4_name,
       "智家服务态度投诉率"                                                                  index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202304", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.139件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.139, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202304")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【入网】装机>>装机人员服务问题",
                                     "投诉工单（2021版）>>融合>>【变更及服务】宽带移机>>移机人员服务问题",
                                     "投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>人员态度不好",
                                     "投诉工单（2021版）>>宽带>>【入网】装机>>装机人员服务问题",
                                     "投诉工单（2021版）>>宽带>>【变更及服务】宽带移机>>移机人员服务问题",
                                     "投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>人员态度不好")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202304")
                 and kpi_code in ("CKP_67269", "-")
                 and prov_id = "111") b
union all
select "FWBZ101"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "03"                                                                                  index_level_2_id,
       "渠道服务"                                                                            index_level_2_name,
       "13"                                                                                  index_level_3_id,
       "智家工程师"                                                                          index_level_3_name,
       "11"                                                                                  index_level_4_id,
       "入户规范"                                                                            index_level_4_name,
       "智家服务态度投诉率"                                                                  index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202305", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.139件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.139, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202305")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【入网】装机>>装机人员服务问题",
                                     "投诉工单（2021版）>>融合>>【变更及服务】宽带移机>>移机人员服务问题",
                                     "投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>人员态度不好",
                                     "投诉工单（2021版）>>宽带>>【入网】装机>>装机人员服务问题",
                                     "投诉工单（2021版）>>宽带>>【变更及服务】宽带移机>>移机人员服务问题",
                                     "投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>人员态度不好")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202305")
                 and kpi_code in ("CKP_67269", "-")
                 and prov_id = "111") b
union all
select "FWBZ101"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "03"                                                                                  index_level_2_id,
       "渠道服务"                                                                            index_level_2_name,
       "13"                                                                                  index_level_3_id,
       "智家工程师"                                                                          index_level_3_name,
       "11"                                                                                  index_level_4_id,
       "入户规范"                                                                            index_level_4_name,
       "智家服务态度投诉率"                                                                  index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202306", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.139件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.139, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202306")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【入网】装机>>装机人员服务问题",
                                     "投诉工单（2021版）>>融合>>【变更及服务】宽带移机>>移机人员服务问题",
                                     "投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>人员态度不好",
                                     "投诉工单（2021版）>>宽带>>【入网】装机>>装机人员服务问题",
                                     "投诉工单（2021版）>>宽带>>【变更及服务】宽带移机>>移机人员服务问题",
                                     "投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>人员态度不好")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202306")
                 and kpi_code in ("CKP_67269", "-")
                 and prov_id = "111") b
union all
select "FWBZ101"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "03"                                                                                  index_level_2_id,
       "渠道服务"                                                                            index_level_2_name,
       "13"                                                                                  index_level_3_id,
       "智家工程师"                                                                          index_level_3_name,
       "11"                                                                                  index_level_4_id,
       "入户规范"                                                                            index_level_4_name,
       "智家服务态度投诉率"                                                                  index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202307", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.139件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.139, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202307")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【入网】装机>>装机人员服务问题",
                                     "投诉工单（2021版）>>融合>>【变更及服务】宽带移机>>移机人员服务问题",
                                     "投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>人员态度不好",
                                     "投诉工单（2021版）>>宽带>>【入网】装机>>装机人员服务问题",
                                     "投诉工单（2021版）>>宽带>>【变更及服务】宽带移机>>移机人员服务问题",
                                     "投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>人员态度不好")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202307")
                 and kpi_code in ("CKP_67269", "-")
                 and prov_id = "111") b
union all
select "FWBZ101"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "03"                                                                                  index_level_2_id,
       "渠道服务"                                                                            index_level_2_name,
       "13"                                                                                  index_level_3_id,
       "智家工程师"                                                                          index_level_3_name,
       "11"                                                                                  index_level_4_id,
       "入户规范"                                                                            index_level_4_name,
       "智家服务态度投诉率"                                                                  index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202308", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.139件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.139, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202308")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【入网】装机>>装机人员服务问题",
                                     "投诉工单（2021版）>>融合>>【变更及服务】宽带移机>>移机人员服务问题",
                                     "投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>人员态度不好",
                                     "投诉工单（2021版）>>宽带>>【入网】装机>>装机人员服务问题",
                                     "投诉工单（2021版）>>宽带>>【变更及服务】宽带移机>>移机人员服务问题",
                                     "投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>人员态度不好")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202308")
                 and kpi_code in ("CKP_67269", "-")
                 and prov_id = "111") b
union all
select "FWBZ101"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "03"                                                                                  index_level_2_id,
       "渠道服务"                                                                            index_level_2_name,
       "13"                                                                                  index_level_3_id,
       "智家工程师"                                                                          index_level_3_name,
       "11"                                                                                  index_level_4_id,
       "入户规范"                                                                            index_level_4_name,
       "智家服务态度投诉率"                                                                  index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202309", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.139件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.139, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202309")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【入网】装机>>装机人员服务问题",
                                     "投诉工单（2021版）>>融合>>【变更及服务】宽带移机>>移机人员服务问题",
                                     "投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>人员态度不好",
                                     "投诉工单（2021版）>>宽带>>【入网】装机>>装机人员服务问题",
                                     "投诉工单（2021版）>>宽带>>【变更及服务】宽带移机>>移机人员服务问题",
                                     "投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>人员态度不好")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202309")
                 and kpi_code in ("CKP_67269", "-")
                 and prov_id = "111") b
;

-- todo 6 装移机不及时投诉率 51 完成
select "FWBZ102"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "03"                                                                                  index_level_2_id,
       "渠道服务"                                                                            index_level_2_name,
       "13"                                                                                  index_level_3_id,
       "智家工程师"                                                                          index_level_3_name,
       "02"                                                                                  index_level_4_id,
       "安装维修"                                                                            index_level_4_name,
       "装移机不及时投诉率"                                                                  index_name,
       a.prov_code                                                                           pro_id,
       a.prov_name                                                                           pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202212", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<1.35件/万户"                                                                        target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 1.35, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_level,
       "GJ"                                                                                  index_level_code
from (select b.prov_code prov_code, b.prov_name prov_name, count(1) n
      from (select sheet_id, compl_area
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                   "202303", "202304", "202305", "202306")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【入网】装机>>装机不及时",
                                     "投诉工单（2021版）>>融合>>【变更及服务】宽带移机>>移机不及时",
                                     "投诉工单（2021版）>>宽带>>【入网】装机>>装机不及时",
                                     "投诉工单（2021版）>>宽带>>【变更及服务】宽带移机>>移机不及时")
              and sheet_status not in ("8", "11")) a
               left join dc_dim.dim_pro_city_regoin b on a.compl_area = b.code_value
      group by b.prov_code, b.prov_name) a
         left join (select substr(prov_id, 2, 3) pro_id, prov_name, cast(sum(kpi_value) as bigint) n
                    from dc_dwd_cbss.dwd_m_user_info
                    where month_id in
                          ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                           "202303", "202304", "202305", "202306")
                      and kpi_code in ("CKP_67269", "-")
                      and prov_id != "-1"
                    group by prov_id, prov_name) b on a.prov_code = b.pro_id and a.prov_name = b.prov_name
where a.prov_name is not null
  and b.prov_name is not null;
-- union all
select "FWBZ102"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "03"                                                                                  index_level_2_id,
       "渠道服务"                                                                            index_level_2_name,
       "13"                                                                                  index_level_3_id,
       "智家工程师"                                                                          index_level_3_name,
       "02"                                                                                  index_level_4_id,
       "安装维修"                                                                            index_level_4_name,
       "装移机不及时投诉率"                                                                  index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202210", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<1.35件/万户"                                                                        target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 1.35, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202210")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【入网】装机>>装机不及时",
                                     "投诉工单（2021版）>>融合>>【变更及服务】宽带移机>>移机不及时",
                                     "投诉工单（2021版）>>宽带>>【入网】装机>>装机不及时",
                                     "投诉工单（2021版）>>宽带>>【变更及服务】宽带移机>>移机不及时")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202210")
                 and kpi_code in ("CKP_67269", "-")
                 and prov_id = "111") b
union all
select "FWBZ102"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "03"                                                                                  index_level_2_id,
       "渠道服务"                                                                            index_level_2_name,
       "13"                                                                                  index_level_3_id,
       "智家工程师"                                                                          index_level_3_name,
       "02"                                                                                  index_level_4_id,
       "安装维修"                                                                            index_level_4_name,
       "装移机不及时投诉率"                                                                  index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202211", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<1.35件/万户"                                                                        target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 1.35, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202211")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【入网】装机>>装机不及时",
                                     "投诉工单（2021版）>>融合>>【变更及服务】宽带移机>>移机不及时",
                                     "投诉工单（2021版）>>宽带>>【入网】装机>>装机不及时",
                                     "投诉工单（2021版）>>宽带>>【变更及服务】宽带移机>>移机不及时")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202211")
                 and kpi_code in ("CKP_67269", "-")
                 and prov_id = "111") b
union all
select "FWBZ102"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "03"                                                                                  index_level_2_id,
       "渠道服务"                                                                            index_level_2_name,
       "13"                                                                                  index_level_3_id,
       "智家工程师"                                                                          index_level_3_name,
       "02"                                                                                  index_level_4_id,
       "安装维修"                                                                            index_level_4_name,
       "装移机不及时投诉率"                                                                  index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202212", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<1.35件/万户"                                                                        target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 1.35, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202212")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【入网】装机>>装机不及时",
                                     "投诉工单（2021版）>>融合>>【变更及服务】宽带移机>>移机不及时",
                                     "投诉工单（2021版）>>宽带>>【入网】装机>>装机不及时",
                                     "投诉工单（2021版）>>宽带>>【变更及服务】宽带移机>>移机不及时")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202212")
                 and kpi_code in ("CKP_67269", "-")
                 and prov_id = "111") b
union all
select "FWBZ102"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "03"                                                                                  index_level_2_id,
       "渠道服务"                                                                            index_level_2_name,
       "13"                                                                                  index_level_3_id,
       "智家工程师"                                                                          index_level_3_name,
       "02"                                                                                  index_level_4_id,
       "安装维修"                                                                            index_level_4_name,
       "装移机不及时投诉率"                                                                  index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202301", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<1.35件/万户"                                                                        target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 1.35, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202301")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【入网】装机>>装机不及时",
                                     "投诉工单（2021版）>>融合>>【变更及服务】宽带移机>>移机不及时",
                                     "投诉工单（2021版）>>宽带>>【入网】装机>>装机不及时",
                                     "投诉工单（2021版）>>宽带>>【变更及服务】宽带移机>>移机不及时")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202301")
                 and kpi_code in ("CKP_67269", "-")
                 and prov_id = "111") b
union all
select "FWBZ102"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "03"                                                                                  index_level_2_id,
       "渠道服务"                                                                            index_level_2_name,
       "13"                                                                                  index_level_3_id,
       "智家工程师"                                                                          index_level_3_name,
       "02"                                                                                  index_level_4_id,
       "安装维修"                                                                            index_level_4_name,
       "装移机不及时投诉率"                                                                  index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202302", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<1.35件/万户"                                                                        target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 1.35, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202302")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【入网】装机>>装机不及时",
                                     "投诉工单（2021版）>>融合>>【变更及服务】宽带移机>>移机不及时",
                                     "投诉工单（2021版）>>宽带>>【入网】装机>>装机不及时",
                                     "投诉工单（2021版）>>宽带>>【变更及服务】宽带移机>>移机不及时")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202302")
                 and kpi_code in ("CKP_67269", "-")
                 and prov_id = "111") b
union all
select "FWBZ102"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "03"                                                                                  index_level_2_id,
       "渠道服务"                                                                            index_level_2_name,
       "13"                                                                                  index_level_3_id,
       "智家工程师"                                                                          index_level_3_name,
       "02"                                                                                  index_level_4_id,
       "安装维修"                                                                            index_level_4_name,
       "装移机不及时投诉率"                                                                  index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202303", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<1.35件/万户"                                                                        target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 1.35, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202303")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【入网】装机>>装机不及时",
                                     "投诉工单（2021版）>>融合>>【变更及服务】宽带移机>>移机不及时",
                                     "投诉工单（2021版）>>宽带>>【入网】装机>>装机不及时",
                                     "投诉工单（2021版）>>宽带>>【变更及服务】宽带移机>>移机不及时")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202303")
                 and kpi_code in ("CKP_67269", "-")
                 and prov_id = "111") b
union all
select "FWBZ102"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "03"                                                                                  index_level_2_id,
       "渠道服务"                                                                            index_level_2_name,
       "13"                                                                                  index_level_3_id,
       "智家工程师"                                                                          index_level_3_name,
       "02"                                                                                  index_level_4_id,
       "安装维修"                                                                            index_level_4_name,
       "装移机不及时投诉率"                                                                  index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202304", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<1.35件/万户"                                                                        target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 1.35, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202304")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【入网】装机>>装机不及时",
                                     "投诉工单（2021版）>>融合>>【变更及服务】宽带移机>>移机不及时",
                                     "投诉工单（2021版）>>宽带>>【入网】装机>>装机不及时",
                                     "投诉工单（2021版）>>宽带>>【变更及服务】宽带移机>>移机不及时")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202304")
                 and kpi_code in ("CKP_67269", "-")
                 and prov_id = "111") b
union all
select "FWBZ102"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "03"                                                                                  index_level_2_id,
       "渠道服务"                                                                            index_level_2_name,
       "13"                                                                                  index_level_3_id,
       "智家工程师"                                                                          index_level_3_name,
       "02"                                                                                  index_level_4_id,
       "安装维修"                                                                            index_level_4_name,
       "装移机不及时投诉率"                                                                  index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202305", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<1.35件/万户"                                                                        target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 1.35, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202305")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【入网】装机>>装机不及时",
                                     "投诉工单（2021版）>>融合>>【变更及服务】宽带移机>>移机不及时",
                                     "投诉工单（2021版）>>宽带>>【入网】装机>>装机不及时",
                                     "投诉工单（2021版）>>宽带>>【变更及服务】宽带移机>>移机不及时")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202305")
                 and kpi_code in ("CKP_67269", "-")
                 and prov_id = "111") b
union all
select "FWBZ102"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "03"                                                                                  index_level_2_id,
       "渠道服务"                                                                            index_level_2_name,
       "13"                                                                                  index_level_3_id,
       "智家工程师"                                                                          index_level_3_name,
       "02"                                                                                  index_level_4_id,
       "安装维修"                                                                            index_level_4_name,
       "装移机不及时投诉率"                                                                  index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202306", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<1.35件/万户"                                                                        target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 1.35, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202306")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【入网】装机>>装机不及时",
                                     "投诉工单（2021版）>>融合>>【变更及服务】宽带移机>>移机不及时",
                                     "投诉工单（2021版）>>宽带>>【入网】装机>>装机不及时",
                                     "投诉工单（2021版）>>宽带>>【变更及服务】宽带移机>>移机不及时")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202306")
                 and kpi_code in ("CKP_67269", "-")
                 and prov_id = "111") b
union all
select "FWBZ102"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "03"                                                                                  index_level_2_id,
       "渠道服务"                                                                            index_level_2_name,
       "13"                                                                                  index_level_3_id,
       "智家工程师"                                                                          index_level_3_name,
       "02"                                                                                  index_level_4_id,
       "安装维修"                                                                            index_level_4_name,
       "装移机不及时投诉率"                                                                  index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202307", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<1.35件/万户"                                                                        target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 1.35, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202307")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【入网】装机>>装机不及时",
                                     "投诉工单（2021版）>>融合>>【变更及服务】宽带移机>>移机不及时",
                                     "投诉工单（2021版）>>宽带>>【入网】装机>>装机不及时",
                                     "投诉工单（2021版）>>宽带>>【变更及服务】宽带移机>>移机不及时")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202307")
                 and kpi_code in ("CKP_67269", "-")
                 and prov_id = "111") b
union all
select "FWBZ102"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "03"                                                                                  index_level_2_id,
       "渠道服务"                                                                            index_level_2_name,
       "13"                                                                                  index_level_3_id,
       "智家工程师"                                                                          index_level_3_name,
       "02"                                                                                  index_level_4_id,
       "安装维修"                                                                            index_level_4_name,
       "装移机不及时投诉率"                                                                  index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202308", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<1.35件/万户"                                                                        target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 1.35, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202308")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【入网】装机>>装机不及时",
                                     "投诉工单（2021版）>>融合>>【变更及服务】宽带移机>>移机不及时",
                                     "投诉工单（2021版）>>宽带>>【入网】装机>>装机不及时",
                                     "投诉工单（2021版）>>宽带>>【变更及服务】宽带移机>>移机不及时")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202308")
                 and kpi_code in ("CKP_67269", "-")
                 and prov_id = "111") b
union all
select "FWBZ102"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "03"                                                                                  index_level_2_id,
       "渠道服务"                                                                            index_level_2_name,
       "13"                                                                                  index_level_3_id,
       "智家工程师"                                                                          index_level_3_name,
       "02"                                                                                  index_level_4_id,
       "安装维修"                                                                            index_level_4_name,
       "装移机不及时投诉率"                                                                  index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202309", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<1.35件/万户"                                                                        target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 1.35, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202309")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【入网】装机>>装机不及时",
                                     "投诉工单（2021版）>>融合>>【变更及服务】宽带移机>>移机不及时",
                                     "投诉工单（2021版）>>宽带>>【入网】装机>>装机不及时",
                                     "投诉工单（2021版）>>宽带>>【变更及服务】宽带移机>>移机不及时")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202309")
                 and kpi_code in ("CKP_67269", "-")
                 and prov_id = "111") b
;

-- todo 7 故障未修好投诉率 52 完成
select "FWBZ103"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "03"                                                                                  index_level_2_id,
       "渠道服务"                                                                            index_level_2_name,
       "13"                                                                                  index_level_3_id,
       "智家工程师"                                                                          index_level_3_name,
       "02"                                                                                  index_level_4_id,
       "安装维修"                                                                            index_level_4_name,
       "故障未修好投诉率"                                                                    index_name,
       a.prov_code                                                                           pro_id,
       a.prov_name                                                                           pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202207", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.099"                                                                              target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.009, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_level,
       "GJ"                                                                                  index_level_code
from (select b.prov_code prov_code, b.prov_name prov_name, count(1) n
      from (select sheet_id, compl_area
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202207")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>上门后没装好/没修好",
                                     "投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>上门后没装好/没修好")
              and sheet_status not in ("8", "11")) a
               left join dc_dim.dim_pro_city_regoin b on a.compl_area = b.code_value
      group by b.prov_code, b.prov_name) a
         left join (select substr(prov_id, 2, 3) pro_id, prov_name, cast(sum(kpi_value) as bigint) n
                    from dc_dwd_cbss.dwd_m_user_info
                    where month_id in
                          ("202207")
                      and kpi_code in ("CKP_67269", "-")
                      and prov_id != "-1"
                    group by prov_id, prov_name) b on a.prov_code = b.pro_id and a.prov_name = b.prov_name
where a.prov_name is not null
  and b.prov_name is not null;
-- union all
select "FWBZ103"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "03"                                                                                  index_level_2_id,
       "渠道服务"                                                                            index_level_2_name,
       "13"                                                                                  index_level_3_id,
       "智家工程师"                                                                          index_level_3_name,
       "02"                                                                                  index_level_4_id,
       "安装维修"                                                                            index_level_4_name,
       "故障未修好投诉率"                                                                    index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202210", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.099"                                                                              target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.009, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202210")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>上门后没装好/没修好",
                                     "投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>上门后没装好/没修好")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202210")
                 and kpi_code in ("CKP_67269", "-")
                 and prov_id = "111") b
union all
select "FWBZ103"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "03"                                                                                  index_level_2_id,
       "渠道服务"                                                                            index_level_2_name,
       "13"                                                                                  index_level_3_id,
       "智家工程师"                                                                          index_level_3_name,
       "02"                                                                                  index_level_4_id,
       "安装维修"                                                                            index_level_4_name,
       "故障未修好投诉率"                                                                    index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202211", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.099"                                                                              target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.009, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202211")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>上门后没装好/没修好",
                                     "投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>上门后没装好/没修好")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202211")
                 and kpi_code in ("CKP_67269", "-")
                 and prov_id = "111") b
union all
select "FWBZ103"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "03"                                                                                  index_level_2_id,
       "渠道服务"                                                                            index_level_2_name,
       "13"                                                                                  index_level_3_id,
       "智家工程师"                                                                          index_level_3_name,
       "02"                                                                                  index_level_4_id,
       "安装维修"                                                                            index_level_4_name,
       "故障未修好投诉率"                                                                    index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202212", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.099"                                                                              target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.009, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202212")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>上门后没装好/没修好",
                                     "投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>上门后没装好/没修好")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202212")
                 and kpi_code in ("CKP_67269", "-")
                 and prov_id = "111") b
union all
select "FWBZ103"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "03"                                                                                  index_level_2_id,
       "渠道服务"                                                                            index_level_2_name,
       "13"                                                                                  index_level_3_id,
       "智家工程师"                                                                          index_level_3_name,
       "02"                                                                                  index_level_4_id,
       "安装维修"                                                                            index_level_4_name,
       "故障未修好投诉率"                                                                    index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202301", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.099"                                                                              target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.009, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202301")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>上门后没装好/没修好",
                                     "投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>上门后没装好/没修好")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202301")
                 and kpi_code in ("CKP_67269", "-")
                 and prov_id = "111") b
union all
select "FWBZ103"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "03"                                                                                  index_level_2_id,
       "渠道服务"                                                                            index_level_2_name,
       "13"                                                                                  index_level_3_id,
       "智家工程师"                                                                          index_level_3_name,
       "02"                                                                                  index_level_4_id,
       "安装维修"                                                                            index_level_4_name,
       "故障未修好投诉率"                                                                    index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202302", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.099"                                                                              target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.009, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202302")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>上门后没装好/没修好",
                                     "投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>上门后没装好/没修好")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202302")
                 and kpi_code in ("CKP_67269", "-")
                 and prov_id = "111") b
union all
select "FWBZ103"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "03"                                                                                  index_level_2_id,
       "渠道服务"                                                                            index_level_2_name,
       "13"                                                                                  index_level_3_id,
       "智家工程师"                                                                          index_level_3_name,
       "02"                                                                                  index_level_4_id,
       "安装维修"                                                                            index_level_4_name,
       "故障未修好投诉率"                                                                    index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202303", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.099"                                                                              target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.009, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202303")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>上门后没装好/没修好",
                                     "投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>上门后没装好/没修好")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202303")
                 and kpi_code in ("CKP_67269", "-")
                 and prov_id = "111") b
union all
select "FWBZ103"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "03"                                                                                  index_level_2_id,
       "渠道服务"                                                                            index_level_2_name,
       "13"                                                                                  index_level_3_id,
       "智家工程师"                                                                          index_level_3_name,
       "02"                                                                                  index_level_4_id,
       "安装维修"                                                                            index_level_4_name,
       "故障未修好投诉率"                                                                    index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202304", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.099"                                                                              target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.009, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202304")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>上门后没装好/没修好",
                                     "投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>上门后没装好/没修好")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202304")
                 and kpi_code in ("CKP_67269", "-")
                 and prov_id = "111") b
union all
select "FWBZ103"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "03"                                                                                  index_level_2_id,
       "渠道服务"                                                                            index_level_2_name,
       "13"                                                                                  index_level_3_id,
       "智家工程师"                                                                          index_level_3_name,
       "02"                                                                                  index_level_4_id,
       "安装维修"                                                                            index_level_4_name,
       "故障未修好投诉率"                                                                    index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202305", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.099"                                                                              target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.009, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202305")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>上门后没装好/没修好",
                                     "投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>上门后没装好/没修好")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202305")
                 and kpi_code in ("CKP_67269", "-")
                 and prov_id = "111") b
union all
select "FWBZ103"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "03"                                                                                  index_level_2_id,
       "渠道服务"                                                                            index_level_2_name,
       "13"                                                                                  index_level_3_id,
       "智家工程师"                                                                          index_level_3_name,
       "02"                                                                                  index_level_4_id,
       "安装维修"                                                                            index_level_4_name,
       "故障未修好投诉率"                                                                    index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202306", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.099"                                                                              target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.009, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202306")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>上门后没装好/没修好",
                                     "投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>上门后没装好/没修好")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202306")
                 and kpi_code in ("CKP_67269", "-")
                 and prov_id = "111") b
union all
select "FWBZ103"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "03"                                                                                  index_level_2_id,
       "渠道服务"                                                                            index_level_2_name,
       "13"                                                                                  index_level_3_id,
       "智家工程师"                                                                          index_level_3_name,
       "02"                                                                                  index_level_4_id,
       "安装维修"                                                                            index_level_4_name,
       "故障未修好投诉率"                                                                    index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202307", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.099"                                                                              target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.009, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202307")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>上门后没装好/没修好",
                                     "投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>上门后没装好/没修好")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202307")
                 and kpi_code in ("CKP_67269", "-")
                 and prov_id = "111") b
union all
select "FWBZ103"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "03"                                                                                  index_level_2_id,
       "渠道服务"                                                                            index_level_2_name,
       "13"                                                                                  index_level_3_id,
       "智家工程师"                                                                          index_level_3_name,
       "02"                                                                                  index_level_4_id,
       "安装维修"                                                                            index_level_4_name,
       "故障未修好投诉率"                                                                    index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202308", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.099"                                                                              target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.009, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202308")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>上门后没装好/没修好",
                                     "投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>上门后没装好/没修好")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202308")
                 and kpi_code in ("CKP_67269", "-")
                 and prov_id = "111") b
union all
select "FWBZ103"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "03"                                                                                  index_level_2_id,
       "渠道服务"                                                                            index_level_2_name,
       "13"                                                                                  index_level_3_id,
       "智家工程师"                                                                          index_level_3_name,
       "02"                                                                                  index_level_4_id,
       "安装维修"                                                                            index_level_4_name,
       "故障未修好投诉率"                                                                    index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202309", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.099"                                                                              target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.009, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202309")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>上门后没装好/没修好",
                                     "投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>上门后没装好/没修好")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202309")
                 and kpi_code in ("CKP_67269", "-")
                 and prov_id = "111") b;

-- todo 8 智家预约上门投诉率 55 完成
select b.pro_id                                                                    pro_id,
       b.prov_name                                                                 pro_name,
       '00'                                                                        city_id,
       '全省'                                                                      city_name,
       '智家预约上门投诉率'                                                        index_name,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select a.prov_name,
             a.prov_code,
             if(a.n is null, 0, a.n) n
      from (select b.prov_code prov_code,
                   b.prov_name prov_name,
                   count(1)    n
            from (select sheet_id,
                         compl_area
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                         "202303", "202304", "202305", "202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>尚未与用户联系',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>尚未与用户联系',
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>没有按时上门/修障不及时',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>没有按时上门/修障不及时'
                            )
                    and sheet_status not in ('8', '11')) a
                     left join dc_dim.dim_pro_city_regoin_cb b on
                a.compl_area = b.code_value
            group by b.prov_code,
                     b.prov_name) a) a
         right join (select substr(prov_id, 2, 3)          pro_id,
                            prov_name,
                            cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                            "202303", "202304", "202305", "202306")
                       and kpi_code in ('CKP_66829', '-')
                       and city_id != '-1'
                     group by prov_id,
                              prov_name) b on
            a.prov_code = b.pro_id
        and a.prov_name = b.prov_name
where b.prov_name is not null;
-- union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '智家预约上门投诉率'                                                        index_name,
       '202210'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202210")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>尚未与用户联系',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>尚未与用户联系',
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>没有按时上门/修障不及时',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>没有按时上门/修障不及时'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202210")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '智家预约上门投诉率'                                                        index_name,
       '202211'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202211")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>尚未与用户联系',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>尚未与用户联系',
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>没有按时上门/修障不及时',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>没有按时上门/修障不及时'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202211")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '智家预约上门投诉率'                                                        index_name,
       '202212'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202212")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>尚未与用户联系',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>尚未与用户联系',
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>没有按时上门/修障不及时',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>没有按时上门/修障不及时'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202212")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '智家预约上门投诉率'                                                        index_name,
       '202301'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202301")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>尚未与用户联系',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>尚未与用户联系',
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>没有按时上门/修障不及时',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>没有按时上门/修障不及时'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202301")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '智家预约上门投诉率'                                                        index_name,
       '202302'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202302")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>尚未与用户联系',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>尚未与用户联系',
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>没有按时上门/修障不及时',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>没有按时上门/修障不及时'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202302")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '智家预约上门投诉率'                                                        index_name,
       '202303'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202303")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>尚未与用户联系',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>尚未与用户联系',
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>没有按时上门/修障不及时',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>没有按时上门/修障不及时'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202303")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '智家预约上门投诉率'                                                        index_name,
       '202304'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202304")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>尚未与用户联系',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>尚未与用户联系',
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>没有按时上门/修障不及时',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>没有按时上门/修障不及时'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202304")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '智家预约上门投诉率'                                                        index_name,
       '202305'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202305")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>尚未与用户联系',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>尚未与用户联系',
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>没有按时上门/修障不及时',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>没有按时上门/修障不及时'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202305")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '智家预约上门投诉率'                                                        index_name,
       '202306'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>尚未与用户联系',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>尚未与用户联系',
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>没有按时上门/修障不及时',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>没有按时上门/修障不及时'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202306")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '智家预约上门投诉率'                                                        index_name,
       '202307'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202307")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>尚未与用户联系',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>尚未与用户联系',
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>没有按时上门/修障不及时',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>没有按时上门/修障不及时'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202307")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '智家预约上门投诉率'                                                        index_name,
       '202308'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202308")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>尚未与用户联系',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>尚未与用户联系',
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>没有按时上门/修障不及时',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>没有按时上门/修障不及时'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202308")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '智家预约上门投诉率'                                                        index_name,
       '202309'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202309")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>尚未与用户联系',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>尚未与用户联系',
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>没有按时上门/修障不及时',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>没有按时上门/修障不及时'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202309")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
;

-- todo 9 智家入户规范投诉率 56 完成
select b.pro_id                                                                    pro_id,
       b.prov_name                                                                 pro_name,
       '00'                                                                        city_id,
       '全省'                                                                      city_name,
       '智家入户规范投诉率'                                                        index_name,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select a.prov_name,
             a.prov_code,
             if(a.n is null, 0, a.n) n
      from (select b.prov_code prov_code,
                   b.prov_name prov_name,
                   count(1)    n
            from (select sheet_id,
                         compl_area
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                         "202303", "202304", "202305", "202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>未按上门规范服务',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>未按上门规范服务',
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>人员操作不熟练',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>人员操作不熟练',
                          '投诉工单（2021版）>>宽带>>【入网】办理>>智家工程师办理差错/不成功',
                          '投诉工单（2021版）>>移网>>【入网】办理>>智家工程师办理差错/不成功',
                          '投诉工单（2021版）>>融合>>【入网】办理>>智家工程师办理差错/不成功',
                          '投诉工单（2021版）>>融合>>【变更及服务】宽带移机>>移机人员服务问题',
                          '投诉工单（2021版）>>宽带>>【变更及服务】宽带移机>>移机人员服务问题',
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>人员态度不好',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>人员态度不好',
                          '投诉工单（2021版）>>融合>>【入网】装机>>装机人员服务问题',
                          '投诉工单（2021版）>>宽带>>【入网】装机>>装机人员服务问题'
                            )
                    and sheet_status not in ('8', '11')) a
                     left join dc_dim.dim_pro_city_regoin_cb b on
                a.compl_area = b.code_value
            group by b.prov_code,
                     b.prov_name) a) a
         right join (select substr(prov_id, 2, 3)          pro_id,
                            prov_name,
                            cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                            "202303", "202304", "202305", "202306")
                       and kpi_code in ('CKP_66829', '-')
                       and city_id != '-1'
                     group by prov_id,
                              prov_name) b on
            a.prov_code = b.pro_id
        and a.prov_name = b.prov_name
where b.prov_name is not null;
-- union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '智家入户规范投诉率'                                                        index_name,
       '202210'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202210")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>未按上门规范服务',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>未按上门规范服务',
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>人员操作不熟练',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>人员操作不熟练',
                          '投诉工单（2021版）>>宽带>>【入网】办理>>智家工程师办理差错/不成功',
                          '投诉工单（2021版）>>移网>>【入网】办理>>智家工程师办理差错/不成功',
                          '投诉工单（2021版）>>融合>>【入网】办理>>智家工程师办理差错/不成功',
                          '投诉工单（2021版）>>融合>>【变更及服务】宽带移机>>移机人员服务问题',
                          '投诉工单（2021版）>>宽带>>【变更及服务】宽带移机>>移机人员服务问题',
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>人员态度不好',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>人员态度不好',
                          '投诉工单（2021版）>>融合>>【入网】装机>>装机人员服务问题',
                          '投诉工单（2021版）>>宽带>>【入网】装机>>装机人员服务问题'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202210")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '智家入户规范投诉率'                                                        index_name,
       '202211'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202211")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>未按上门规范服务',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>未按上门规范服务',
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>人员操作不熟练',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>人员操作不熟练',
                          '投诉工单（2021版）>>宽带>>【入网】办理>>智家工程师办理差错/不成功',
                          '投诉工单（2021版）>>移网>>【入网】办理>>智家工程师办理差错/不成功',
                          '投诉工单（2021版）>>融合>>【入网】办理>>智家工程师办理差错/不成功',
                          '投诉工单（2021版）>>融合>>【变更及服务】宽带移机>>移机人员服务问题',
                          '投诉工单（2021版）>>宽带>>【变更及服务】宽带移机>>移机人员服务问题',
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>人员态度不好',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>人员态度不好',
                          '投诉工单（2021版）>>融合>>【入网】装机>>装机人员服务问题',
                          '投诉工单（2021版）>>宽带>>【入网】装机>>装机人员服务问题'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202211")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '智家入户规范投诉率'                                                        index_name,
       '202212'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202212")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>未按上门规范服务',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>未按上门规范服务',
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>人员操作不熟练',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>人员操作不熟练',
                          '投诉工单（2021版）>>宽带>>【入网】办理>>智家工程师办理差错/不成功',
                          '投诉工单（2021版）>>移网>>【入网】办理>>智家工程师办理差错/不成功',
                          '投诉工单（2021版）>>融合>>【入网】办理>>智家工程师办理差错/不成功',
                          '投诉工单（2021版）>>融合>>【变更及服务】宽带移机>>移机人员服务问题',
                          '投诉工单（2021版）>>宽带>>【变更及服务】宽带移机>>移机人员服务问题',
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>人员态度不好',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>人员态度不好',
                          '投诉工单（2021版）>>融合>>【入网】装机>>装机人员服务问题',
                          '投诉工单（2021版）>>宽带>>【入网】装机>>装机人员服务问题'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202212")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '智家入户规范投诉率'                                                        index_name,
       '202301'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202301")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>未按上门规范服务',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>未按上门规范服务',
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>人员操作不熟练',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>人员操作不熟练',
                          '投诉工单（2021版）>>宽带>>【入网】办理>>智家工程师办理差错/不成功',
                          '投诉工单（2021版）>>移网>>【入网】办理>>智家工程师办理差错/不成功',
                          '投诉工单（2021版）>>融合>>【入网】办理>>智家工程师办理差错/不成功',
                          '投诉工单（2021版）>>融合>>【变更及服务】宽带移机>>移机人员服务问题',
                          '投诉工单（2021版）>>宽带>>【变更及服务】宽带移机>>移机人员服务问题',
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>人员态度不好',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>人员态度不好',
                          '投诉工单（2021版）>>融合>>【入网】装机>>装机人员服务问题',
                          '投诉工单（2021版）>>宽带>>【入网】装机>>装机人员服务问题'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202301")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '智家入户规范投诉率'                                                        index_name,
       '202302'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202302")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>未按上门规范服务',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>未按上门规范服务',
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>人员操作不熟练',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>人员操作不熟练',
                          '投诉工单（2021版）>>宽带>>【入网】办理>>智家工程师办理差错/不成功',
                          '投诉工单（2021版）>>移网>>【入网】办理>>智家工程师办理差错/不成功',
                          '投诉工单（2021版）>>融合>>【入网】办理>>智家工程师办理差错/不成功',
                          '投诉工单（2021版）>>融合>>【变更及服务】宽带移机>>移机人员服务问题',
                          '投诉工单（2021版）>>宽带>>【变更及服务】宽带移机>>移机人员服务问题',
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>人员态度不好',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>人员态度不好',
                          '投诉工单（2021版）>>融合>>【入网】装机>>装机人员服务问题',
                          '投诉工单（2021版）>>宽带>>【入网】装机>>装机人员服务问题'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202302")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '智家入户规范投诉率'                                                        index_name,
       '202303'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202303")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>未按上门规范服务',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>未按上门规范服务',
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>人员操作不熟练',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>人员操作不熟练',
                          '投诉工单（2021版）>>宽带>>【入网】办理>>智家工程师办理差错/不成功',
                          '投诉工单（2021版）>>移网>>【入网】办理>>智家工程师办理差错/不成功',
                          '投诉工单（2021版）>>融合>>【入网】办理>>智家工程师办理差错/不成功',
                          '投诉工单（2021版）>>融合>>【变更及服务】宽带移机>>移机人员服务问题',
                          '投诉工单（2021版）>>宽带>>【变更及服务】宽带移机>>移机人员服务问题',
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>人员态度不好',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>人员态度不好',
                          '投诉工单（2021版）>>融合>>【入网】装机>>装机人员服务问题',
                          '投诉工单（2021版）>>宽带>>【入网】装机>>装机人员服务问题'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202303")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '智家入户规范投诉率'                                                        index_name,
       '202304'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202304")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>未按上门规范服务',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>未按上门规范服务',
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>人员操作不熟练',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>人员操作不熟练',
                          '投诉工单（2021版）>>宽带>>【入网】办理>>智家工程师办理差错/不成功',
                          '投诉工单（2021版）>>移网>>【入网】办理>>智家工程师办理差错/不成功',
                          '投诉工单（2021版）>>融合>>【入网】办理>>智家工程师办理差错/不成功',
                          '投诉工单（2021版）>>融合>>【变更及服务】宽带移机>>移机人员服务问题',
                          '投诉工单（2021版）>>宽带>>【变更及服务】宽带移机>>移机人员服务问题',
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>人员态度不好',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>人员态度不好',
                          '投诉工单（2021版）>>融合>>【入网】装机>>装机人员服务问题',
                          '投诉工单（2021版）>>宽带>>【入网】装机>>装机人员服务问题'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202304")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '智家入户规范投诉率'                                                        index_name,
       '202305'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202305")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>未按上门规范服务',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>未按上门规范服务',
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>人员操作不熟练',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>人员操作不熟练',
                          '投诉工单（2021版）>>宽带>>【入网】办理>>智家工程师办理差错/不成功',
                          '投诉工单（2021版）>>移网>>【入网】办理>>智家工程师办理差错/不成功',
                          '投诉工单（2021版）>>融合>>【入网】办理>>智家工程师办理差错/不成功',
                          '投诉工单（2021版）>>融合>>【变更及服务】宽带移机>>移机人员服务问题',
                          '投诉工单（2021版）>>宽带>>【变更及服务】宽带移机>>移机人员服务问题',
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>人员态度不好',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>人员态度不好',
                          '投诉工单（2021版）>>融合>>【入网】装机>>装机人员服务问题',
                          '投诉工单（2021版）>>宽带>>【入网】装机>>装机人员服务问题'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202305")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '智家入户规范投诉率'                                                        index_name,
       '202306'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>未按上门规范服务',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>未按上门规范服务',
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>人员操作不熟练',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>人员操作不熟练',
                          '投诉工单（2021版）>>宽带>>【入网】办理>>智家工程师办理差错/不成功',
                          '投诉工单（2021版）>>移网>>【入网】办理>>智家工程师办理差错/不成功',
                          '投诉工单（2021版）>>融合>>【入网】办理>>智家工程师办理差错/不成功',
                          '投诉工单（2021版）>>融合>>【变更及服务】宽带移机>>移机人员服务问题',
                          '投诉工单（2021版）>>宽带>>【变更及服务】宽带移机>>移机人员服务问题',
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>人员态度不好',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>人员态度不好',
                          '投诉工单（2021版）>>融合>>【入网】装机>>装机人员服务问题',
                          '投诉工单（2021版）>>宽带>>【入网】装机>>装机人员服务问题'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202306")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '智家入户规范投诉率'                                                        index_name,
       '202307'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202307")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>未按上门规范服务',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>未按上门规范服务',
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>人员操作不熟练',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>人员操作不熟练',
                          '投诉工单（2021版）>>宽带>>【入网】办理>>智家工程师办理差错/不成功',
                          '投诉工单（2021版）>>移网>>【入网】办理>>智家工程师办理差错/不成功',
                          '投诉工单（2021版）>>融合>>【入网】办理>>智家工程师办理差错/不成功',
                          '投诉工单（2021版）>>融合>>【变更及服务】宽带移机>>移机人员服务问题',
                          '投诉工单（2021版）>>宽带>>【变更及服务】宽带移机>>移机人员服务问题',
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>人员态度不好',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>人员态度不好',
                          '投诉工单（2021版）>>融合>>【入网】装机>>装机人员服务问题',
                          '投诉工单（2021版）>>宽带>>【入网】装机>>装机人员服务问题'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202307")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '智家入户规范投诉率'                                                        index_name,
       '202308'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202308")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>未按上门规范服务',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>未按上门规范服务',
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>人员操作不熟练',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>人员操作不熟练',
                          '投诉工单（2021版）>>宽带>>【入网】办理>>智家工程师办理差错/不成功',
                          '投诉工单（2021版）>>移网>>【入网】办理>>智家工程师办理差错/不成功',
                          '投诉工单（2021版）>>融合>>【入网】办理>>智家工程师办理差错/不成功',
                          '投诉工单（2021版）>>融合>>【变更及服务】宽带移机>>移机人员服务问题',
                          '投诉工单（2021版）>>宽带>>【变更及服务】宽带移机>>移机人员服务问题',
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>人员态度不好',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>人员态度不好',
                          '投诉工单（2021版）>>融合>>【入网】装机>>装机人员服务问题',
                          '投诉工单（2021版）>>宽带>>【入网】装机>>装机人员服务问题'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202308")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '智家入户规范投诉率'                                                        index_name,
       '202309'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202309")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>未按上门规范服务',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>未按上门规范服务',
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>人员操作不熟练',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>人员操作不熟练',
                          '投诉工单（2021版）>>宽带>>【入网】办理>>智家工程师办理差错/不成功',
                          '投诉工单（2021版）>>移网>>【入网】办理>>智家工程师办理差错/不成功',
                          '投诉工单（2021版）>>融合>>【入网】办理>>智家工程师办理差错/不成功',
                          '投诉工单（2021版）>>融合>>【变更及服务】宽带移机>>移机人员服务问题',
                          '投诉工单（2021版）>>宽带>>【变更及服务】宽带移机>>移机人员服务问题',
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>人员态度不好',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>人员态度不好',
                          '投诉工单（2021版）>>融合>>【入网】装机>>装机人员服务问题',
                          '投诉工单（2021版）>>宽带>>【入网】装机>>装机人员服务问题'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202309")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
;


-- todo 10 智家安装维修投诉率 57 完成
select b.pro_id                                                                    pro_id,
       b.prov_name                                                                 pro_name,
       '00'                                                                        city_id,
       '全省'                                                                      city_name,
       '智家安装维修投诉率'                                                        index_name,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select a.prov_name,
             a.prov_code,
             if(a.n is null, 0, a.n) n
      from (select b.prov_code prov_code,
                   b.prov_name prov_name,
                   count(1)    n
            from (select sheet_id,
                         compl_area
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                         "202303", "202304", "202305", "202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>融合>>【入网】装机>>装机不及时',
                          '投诉工单（2021版）>>融合>>【变更及服务】宽带移机>>移机不及时',
                          '投诉工单（2021版）>>宽带>>【入网】装机>>装机不及时',
                          '投诉工单（2021版）>>宽带>>【变更及服务】宽带移机>>移机不及时',
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>上门后没装好/没修好',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>上门后没装好/没修好'
                            )
                    and sheet_status not in ('8', '11')) a
                     left join dc_dim.dim_pro_city_regoin_cb b on
                a.compl_area = b.code_value
            group by b.prov_code,
                     b.prov_name) a) a
         right join (select substr(prov_id, 2, 3)          pro_id,
                            prov_name,
                            cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                            "202303", "202304", "202305", "202306")
                       and kpi_code in ('CKP_66829', '-')
                       and city_id != '-1'
                     group by prov_id,
                              prov_name) b on
            a.prov_code = b.pro_id
        and a.prov_name = b.prov_name
where b.prov_name is not null;
-- union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '智家安装维修投诉率'                                                        index_name,
       '202210'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202210")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>融合>>【入网】装机>>装机不及时',
                          '投诉工单（2021版）>>融合>>【变更及服务】宽带移机>>移机不及时',
                          '投诉工单（2021版）>>宽带>>【入网】装机>>装机不及时',
                          '投诉工单（2021版）>>宽带>>【变更及服务】宽带移机>>移机不及时',
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>上门后没装好/没修好',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>上门后没装好/没修好'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202210")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '智家安装维修投诉率'                                                        index_name,
       '202211'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202211")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>融合>>【入网】装机>>装机不及时',
                          '投诉工单（2021版）>>融合>>【变更及服务】宽带移机>>移机不及时',
                          '投诉工单（2021版）>>宽带>>【入网】装机>>装机不及时',
                          '投诉工单（2021版）>>宽带>>【变更及服务】宽带移机>>移机不及时',
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>上门后没装好/没修好',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>上门后没装好/没修好'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202211")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '智家安装维修投诉率'                                                        index_name,
       '202212'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202212")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>融合>>【入网】装机>>装机不及时',
                          '投诉工单（2021版）>>融合>>【变更及服务】宽带移机>>移机不及时',
                          '投诉工单（2021版）>>宽带>>【入网】装机>>装机不及时',
                          '投诉工单（2021版）>>宽带>>【变更及服务】宽带移机>>移机不及时',
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>上门后没装好/没修好',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>上门后没装好/没修好'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202212")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '智家安装维修投诉率'                                                        index_name,
       '202301'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202301")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>融合>>【入网】装机>>装机不及时',
                          '投诉工单（2021版）>>融合>>【变更及服务】宽带移机>>移机不及时',
                          '投诉工单（2021版）>>宽带>>【入网】装机>>装机不及时',
                          '投诉工单（2021版）>>宽带>>【变更及服务】宽带移机>>移机不及时',
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>上门后没装好/没修好',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>上门后没装好/没修好'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202301")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '智家安装维修投诉率'                                                        index_name,
       '202302'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202302")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>融合>>【入网】装机>>装机不及时',
                          '投诉工单（2021版）>>融合>>【变更及服务】宽带移机>>移机不及时',
                          '投诉工单（2021版）>>宽带>>【入网】装机>>装机不及时',
                          '投诉工单（2021版）>>宽带>>【变更及服务】宽带移机>>移机不及时',
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>上门后没装好/没修好',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>上门后没装好/没修好'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202302")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '智家安装维修投诉率'                                                        index_name,
       '202303'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202303")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>融合>>【入网】装机>>装机不及时',
                          '投诉工单（2021版）>>融合>>【变更及服务】宽带移机>>移机不及时',
                          '投诉工单（2021版）>>宽带>>【入网】装机>>装机不及时',
                          '投诉工单（2021版）>>宽带>>【变更及服务】宽带移机>>移机不及时',
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>上门后没装好/没修好',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>上门后没装好/没修好'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202303")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '智家安装维修投诉率'                                                        index_name,
       '202304'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202304")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>融合>>【入网】装机>>装机不及时',
                          '投诉工单（2021版）>>融合>>【变更及服务】宽带移机>>移机不及时',
                          '投诉工单（2021版）>>宽带>>【入网】装机>>装机不及时',
                          '投诉工单（2021版）>>宽带>>【变更及服务】宽带移机>>移机不及时',
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>上门后没装好/没修好',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>上门后没装好/没修好'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202304")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '智家安装维修投诉率'                                                        index_name,
       '202305'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202305")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>融合>>【入网】装机>>装机不及时',
                          '投诉工单（2021版）>>融合>>【变更及服务】宽带移机>>移机不及时',
                          '投诉工单（2021版）>>宽带>>【入网】装机>>装机不及时',
                          '投诉工单（2021版）>>宽带>>【变更及服务】宽带移机>>移机不及时',
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>上门后没装好/没修好',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>上门后没装好/没修好'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202305")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '智家安装维修投诉率'                                                        index_name,
       '202306'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>融合>>【入网】装机>>装机不及时',
                          '投诉工单（2021版）>>融合>>【变更及服务】宽带移机>>移机不及时',
                          '投诉工单（2021版）>>宽带>>【入网】装机>>装机不及时',
                          '投诉工单（2021版）>>宽带>>【变更及服务】宽带移机>>移机不及时',
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>上门后没装好/没修好',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>上门后没装好/没修好'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202306")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '智家安装维修投诉率'                                                        index_name,
       '202307'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202307")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>融合>>【入网】装机>>装机不及时',
                          '投诉工单（2021版）>>融合>>【变更及服务】宽带移机>>移机不及时',
                          '投诉工单（2021版）>>宽带>>【入网】装机>>装机不及时',
                          '投诉工单（2021版）>>宽带>>【变更及服务】宽带移机>>移机不及时',
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>上门后没装好/没修好',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>上门后没装好/没修好'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202307")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '智家安装维修投诉率'                                                        index_name,
       '202308'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202308")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>融合>>【入网】装机>>装机不及时',
                          '投诉工单（2021版）>>融合>>【变更及服务】宽带移机>>移机不及时',
                          '投诉工单（2021版）>>宽带>>【入网】装机>>装机不及时',
                          '投诉工单（2021版）>>宽带>>【变更及服务】宽带移机>>移机不及时',
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>上门后没装好/没修好',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>上门后没装好/没修好'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202308")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '智家安装维修投诉率'                                                        index_name,
       '202309'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202309")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>融合>>【入网】装机>>装机不及时',
                          '投诉工单（2021版）>>融合>>【变更及服务】宽带移机>>移机不及时',
                          '投诉工单（2021版）>>宽带>>【入网】装机>>装机不及时',
                          '投诉工单（2021版）>>宽带>>【变更及服务】宽带移机>>移机不及时',
                          '投诉工单（2021版）>>融合>>【宽带修障】宽带修障>>上门后没装好/没修好',
                          '投诉工单（2021版）>>宽带>>【宽带修障】宽带修障>>上门后没装好/没修好'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202309")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
;

-- todo 11 资费未明示投诉率 62 完成
select "FWBZ105"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "15"                                                                                  index_level_3_id,
       "资费明示"                                                                            index_level_3_name,
       "22"                                                                                  index_level_4_id,
       "资费明示"                                                                            index_level_4_name,
       "资费未明示投诉率"                                                                    index_name,
       a.prov_code                                                                           pro_id,
       a.prov_name                                                                           pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202212", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.009件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.009, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_level,
       "GJ"                                                                                  index_level_code
from (select b.prov_code prov_code, b.prov_name prov_name, count(1) n
      from (select sheet_id, compl_area
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                   "202303", "202304", "202305", "202306")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in
                  ("投诉工单（2021版）>>移网>>【入网】宣传>>资费未明示", "投诉工单（2021版）>>融合>>【入网】宣传>>资费未明示",
                   "投诉工单（2021版）>>宽带>>【入网】宣传>>资费未明示")
              and sheet_status not in ("8", "11")) a
               left join dc_dim.dim_pro_city_regoin b on a.compl_area = b.code_value
      group by b.prov_code, b.prov_name) a
         left join (select substr(prov_id, 2, 3) pro_id, prov_name, cast(sum(kpi_value) as bigint) n
                    from dc_dwd_cbss.dwd_m_user_info
                    where month_id in
                          ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                           "202303", "202304", "202305", "202306")
                      and kpi_code in ("CKP_66829", "CKP_11453")
                      and prov_id != "-1"
                    group by prov_id, prov_name) b on a.prov_code = b.pro_id and a.prov_name = b.prov_name
where a.prov_name is not null
  and b.prov_name is not null;
-- union all
select "FWBZ105"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "15"                                                                                  index_level_3_id,
       "资费明示"                                                                            index_level_3_name,
       "22"                                                                                  index_level_4_id,
       "资费明示"                                                                            index_level_4_name,
       "资费未明示投诉率"                                                                    index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202210", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.009件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.009, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202210")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in
                  ("投诉工单（2021版）>>移网>>【入网】宣传>>资费未明示", "投诉工单（2021版）>>融合>>【入网】宣传>>资费未明示",
                   "投诉工单（2021版）>>宽带>>【入网】宣传>>资费未明示")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202210")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ105"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "15"                                                                                  index_level_3_id,
       "资费明示"                                                                            index_level_3_name,
       "22"                                                                                  index_level_4_id,
       "资费明示"                                                                            index_level_4_name,
       "资费未明示投诉率"                                                                    index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202211", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.009件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.009, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202211")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in
                  ("投诉工单（2021版）>>移网>>【入网】宣传>>资费未明示", "投诉工单（2021版）>>融合>>【入网】宣传>>资费未明示",
                   "投诉工单（2021版）>>宽带>>【入网】宣传>>资费未明示")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202211")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ105"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "15"                                                                                  index_level_3_id,
       "资费明示"                                                                            index_level_3_name,
       "22"                                                                                  index_level_4_id,
       "资费明示"                                                                            index_level_4_name,
       "资费未明示投诉率"                                                                    index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202212", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.009件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.009, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202212")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in
                  ("投诉工单（2021版）>>移网>>【入网】宣传>>资费未明示", "投诉工单（2021版）>>融合>>【入网】宣传>>资费未明示",
                   "投诉工单（2021版）>>宽带>>【入网】宣传>>资费未明示")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202212")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ105"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "15"                                                                                  index_level_3_id,
       "资费明示"                                                                            index_level_3_name,
       "22"                                                                                  index_level_4_id,
       "资费明示"                                                                            index_level_4_name,
       "资费未明示投诉率"                                                                    index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202301", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.009件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.009, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202301")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in
                  ("投诉工单（2021版）>>移网>>【入网】宣传>>资费未明示", "投诉工单（2021版）>>融合>>【入网】宣传>>资费未明示",
                   "投诉工单（2021版）>>宽带>>【入网】宣传>>资费未明示")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202301")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ105"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "15"                                                                                  index_level_3_id,
       "资费明示"                                                                            index_level_3_name,
       "22"                                                                                  index_level_4_id,
       "资费明示"                                                                            index_level_4_name,
       "资费未明示投诉率"                                                                    index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202302", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.009件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.009, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202302")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in
                  ("投诉工单（2021版）>>移网>>【入网】宣传>>资费未明示", "投诉工单（2021版）>>融合>>【入网】宣传>>资费未明示",
                   "投诉工单（2021版）>>宽带>>【入网】宣传>>资费未明示")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202302")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ105"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "15"                                                                                  index_level_3_id,
       "资费明示"                                                                            index_level_3_name,
       "22"                                                                                  index_level_4_id,
       "资费明示"                                                                            index_level_4_name,
       "资费未明示投诉率"                                                                    index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202303", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.009件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.009, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202303")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in
                  ("投诉工单（2021版）>>移网>>【入网】宣传>>资费未明示", "投诉工单（2021版）>>融合>>【入网】宣传>>资费未明示",
                   "投诉工单（2021版）>>宽带>>【入网】宣传>>资费未明示")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202303")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ105"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "15"                                                                                  index_level_3_id,
       "资费明示"                                                                            index_level_3_name,
       "22"                                                                                  index_level_4_id,
       "资费明示"                                                                            index_level_4_name,
       "资费未明示投诉率"                                                                    index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202304", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.009件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.009, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202304")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in
                  ("投诉工单（2021版）>>移网>>【入网】宣传>>资费未明示", "投诉工单（2021版）>>融合>>【入网】宣传>>资费未明示",
                   "投诉工单（2021版）>>宽带>>【入网】宣传>>资费未明示")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202304")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ105"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "15"                                                                                  index_level_3_id,
       "资费明示"                                                                            index_level_3_name,
       "22"                                                                                  index_level_4_id,
       "资费明示"                                                                            index_level_4_name,
       "资费未明示投诉率"                                                                    index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202305", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.009件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.009, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202305")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in
                  ("投诉工单（2021版）>>移网>>【入网】宣传>>资费未明示", "投诉工单（2021版）>>融合>>【入网】宣传>>资费未明示",
                   "投诉工单（2021版）>>宽带>>【入网】宣传>>资费未明示")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202305")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ105"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "15"                                                                                  index_level_3_id,
       "资费明示"                                                                            index_level_3_name,
       "22"                                                                                  index_level_4_id,
       "资费明示"                                                                            index_level_4_name,
       "资费未明示投诉率"                                                                    index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202306", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.009件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.009, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202306")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in
                  ("投诉工单（2021版）>>移网>>【入网】宣传>>资费未明示", "投诉工单（2021版）>>融合>>【入网】宣传>>资费未明示",
                   "投诉工单（2021版）>>宽带>>【入网】宣传>>资费未明示")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202306")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ105"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "15"                                                                                  index_level_3_id,
       "资费明示"                                                                            index_level_3_name,
       "22"                                                                                  index_level_4_id,
       "资费明示"                                                                            index_level_4_name,
       "资费未明示投诉率"                                                                    index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202307", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.009件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.009, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202307")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in
                  ("投诉工单（2021版）>>移网>>【入网】宣传>>资费未明示", "投诉工单（2021版）>>融合>>【入网】宣传>>资费未明示",
                   "投诉工单（2021版）>>宽带>>【入网】宣传>>资费未明示")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202307")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ105"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "15"                                                                                  index_level_3_id,
       "资费明示"                                                                            index_level_3_name,
       "22"                                                                                  index_level_4_id,
       "资费明示"                                                                            index_level_4_name,
       "资费未明示投诉率"                                                                    index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202308", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.009件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.009, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202308")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in
                  ("投诉工单（2021版）>>移网>>【入网】宣传>>资费未明示", "投诉工单（2021版）>>融合>>【入网】宣传>>资费未明示",
                   "投诉工单（2021版）>>宽带>>【入网】宣传>>资费未明示")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202308")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ105"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "15"                                                                                  index_level_3_id,
       "资费明示"                                                                            index_level_3_name,
       "22"                                                                                  index_level_4_id,
       "资费明示"                                                                            index_level_4_name,
       "资费未明示投诉率"                                                                    index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202309", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.009件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.009, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202309")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in
                  ("投诉工单（2021版）>>移网>>【入网】宣传>>资费未明示", "投诉工单（2021版）>>融合>>【入网】宣传>>资费未明示",
                   "投诉工单（2021版）>>宽带>>【入网】宣传>>资费未明示")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202309")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
;

-- todo 12 活动资费宣传不清晰投诉率 64 完成
select "FWBZ106"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "15"                                                                                  index_level_3_id,
       "资费明示"                                                                            index_level_3_name,
       "22"                                                                                  index_level_4_id,
       "资费明示"                                                                            index_level_4_name,
       "活动资费宣传不清晰投诉率"                                                            index_name,
       a.prov_code                                                                           pro_id,
       a.prov_name                                                                           pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202212", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.108件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.108, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_level,
       "GJ"                                                                                  index_level_code
from (select b.prov_code prov_code, b.prov_name prov_name, count(1) n
      from (select sheet_id, compl_area
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                   "202303", "202304", "202305", "202306")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>移网>>【入网】宣传>>活动、资费宣传不清晰/模糊宣传",
                                     "投诉工单（2021版）>>融合>>【入网】宣传>>活动、资费宣传不清晰/模糊宣传",
                                     "投诉工单（2021版）>>宽带>>【入网】宣传>>活动、资费宣传不清晰/模糊宣传")
              and sheet_status not in ("8", "11")) a
               left join dc_dim.dim_pro_city_regoin b on a.compl_area = b.code_value
      group by b.prov_code, b.prov_name) a
         left join (select substr(prov_id, 2, 3) pro_id, prov_name, cast(sum(kpi_value) as bigint) n
                    from dc_dwd_cbss.dwd_m_user_info
                    where month_id in
                          ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                           "202303", "202304", "202305", "202306")
                      and kpi_code in ("CKP_66829", "CKP_11453")
                      and prov_id != "-1"
                    group by prov_id, prov_name) b on a.prov_code = b.pro_id and a.prov_name = b.prov_name
where a.prov_name is not null
  and b.prov_name is not null;
-- union all
select "FWBZ106"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "15"                                                                                  index_level_3_id,
       "资费明示"                                                                            index_level_3_name,
       "22"                                                                                  index_level_4_id,
       "资费明示"                                                                            index_level_4_name,
       "活动资费宣传不清晰投诉率"                                                            index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202210", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.108件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.108, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202210")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>移网>>【入网】宣传>>活动、资费宣传不清晰/模糊宣传",
                                     "投诉工单（2021版）>>融合>>【入网】宣传>>活动、资费宣传不清晰/模糊宣传",
                                     "投诉工单（2021版）>>宽带>>【入网】宣传>>活动、资费宣传不清晰/模糊宣传")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202210")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ106"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "15"                                                                                  index_level_3_id,
       "资费明示"                                                                            index_level_3_name,
       "22"                                                                                  index_level_4_id,
       "资费明示"                                                                            index_level_4_name,
       "活动资费宣传不清晰投诉率"                                                            index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202211", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.108件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.108, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202211")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>移网>>【入网】宣传>>活动、资费宣传不清晰/模糊宣传",
                                     "投诉工单（2021版）>>融合>>【入网】宣传>>活动、资费宣传不清晰/模糊宣传",
                                     "投诉工单（2021版）>>宽带>>【入网】宣传>>活动、资费宣传不清晰/模糊宣传")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202211")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ106"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "15"                                                                                  index_level_3_id,
       "资费明示"                                                                            index_level_3_name,
       "22"                                                                                  index_level_4_id,
       "资费明示"                                                                            index_level_4_name,
       "活动资费宣传不清晰投诉率"                                                            index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202212", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.108件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.108, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202212")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>移网>>【入网】宣传>>活动、资费宣传不清晰/模糊宣传",
                                     "投诉工单（2021版）>>融合>>【入网】宣传>>活动、资费宣传不清晰/模糊宣传",
                                     "投诉工单（2021版）>>宽带>>【入网】宣传>>活动、资费宣传不清晰/模糊宣传")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202212")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ106"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "15"                                                                                  index_level_3_id,
       "资费明示"                                                                            index_level_3_name,
       "22"                                                                                  index_level_4_id,
       "资费明示"                                                                            index_level_4_name,
       "活动资费宣传不清晰投诉率"                                                            index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202301", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.108件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.108, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202301")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>移网>>【入网】宣传>>活动、资费宣传不清晰/模糊宣传",
                                     "投诉工单（2021版）>>融合>>【入网】宣传>>活动、资费宣传不清晰/模糊宣传",
                                     "投诉工单（2021版）>>宽带>>【入网】宣传>>活动、资费宣传不清晰/模糊宣传")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202301")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ106"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "15"                                                                                  index_level_3_id,
       "资费明示"                                                                            index_level_3_name,
       "22"                                                                                  index_level_4_id,
       "资费明示"                                                                            index_level_4_name,
       "活动资费宣传不清晰投诉率"                                                            index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202302", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.108件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.108, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202302")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>移网>>【入网】宣传>>活动、资费宣传不清晰/模糊宣传",
                                     "投诉工单（2021版）>>融合>>【入网】宣传>>活动、资费宣传不清晰/模糊宣传",
                                     "投诉工单（2021版）>>宽带>>【入网】宣传>>活动、资费宣传不清晰/模糊宣传")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202302")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ106"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "15"                                                                                  index_level_3_id,
       "资费明示"                                                                            index_level_3_name,
       "22"                                                                                  index_level_4_id,
       "资费明示"                                                                            index_level_4_name,
       "活动资费宣传不清晰投诉率"                                                            index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202303", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.108件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.108, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202303")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>移网>>【入网】宣传>>活动、资费宣传不清晰/模糊宣传",
                                     "投诉工单（2021版）>>融合>>【入网】宣传>>活动、资费宣传不清晰/模糊宣传",
                                     "投诉工单（2021版）>>宽带>>【入网】宣传>>活动、资费宣传不清晰/模糊宣传")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202303")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ106"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "15"                                                                                  index_level_3_id,
       "资费明示"                                                                            index_level_3_name,
       "22"                                                                                  index_level_4_id,
       "资费明示"                                                                            index_level_4_name,
       "活动资费宣传不清晰投诉率"                                                            index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202304", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.108件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.108, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202304")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>移网>>【入网】宣传>>活动、资费宣传不清晰/模糊宣传",
                                     "投诉工单（2021版）>>融合>>【入网】宣传>>活动、资费宣传不清晰/模糊宣传",
                                     "投诉工单（2021版）>>宽带>>【入网】宣传>>活动、资费宣传不清晰/模糊宣传")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202304")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ106"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "15"                                                                                  index_level_3_id,
       "资费明示"                                                                            index_level_3_name,
       "22"                                                                                  index_level_4_id,
       "资费明示"                                                                            index_level_4_name,
       "活动资费宣传不清晰投诉率"                                                            index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202305", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.108件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.108, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202305")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>移网>>【入网】宣传>>活动、资费宣传不清晰/模糊宣传",
                                     "投诉工单（2021版）>>融合>>【入网】宣传>>活动、资费宣传不清晰/模糊宣传",
                                     "投诉工单（2021版）>>宽带>>【入网】宣传>>活动、资费宣传不清晰/模糊宣传")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202305")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ106"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "15"                                                                                  index_level_3_id,
       "资费明示"                                                                            index_level_3_name,
       "22"                                                                                  index_level_4_id,
       "资费明示"                                                                            index_level_4_name,
       "活动资费宣传不清晰投诉率"                                                            index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202306", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.108件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.108, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202306")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>移网>>【入网】宣传>>活动、资费宣传不清晰/模糊宣传",
                                     "投诉工单（2021版）>>融合>>【入网】宣传>>活动、资费宣传不清晰/模糊宣传",
                                     "投诉工单（2021版）>>宽带>>【入网】宣传>>活动、资费宣传不清晰/模糊宣传")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202306")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ106"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "15"                                                                                  index_level_3_id,
       "资费明示"                                                                            index_level_3_name,
       "22"                                                                                  index_level_4_id,
       "资费明示"                                                                            index_level_4_name,
       "活动资费宣传不清晰投诉率"                                                            index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202307", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.108件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.108, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202307")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>移网>>【入网】宣传>>活动、资费宣传不清晰/模糊宣传",
                                     "投诉工单（2021版）>>融合>>【入网】宣传>>活动、资费宣传不清晰/模糊宣传",
                                     "投诉工单（2021版）>>宽带>>【入网】宣传>>活动、资费宣传不清晰/模糊宣传")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202307")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ106"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "15"                                                                                  index_level_3_id,
       "资费明示"                                                                            index_level_3_name,
       "22"                                                                                  index_level_4_id,
       "资费明示"                                                                            index_level_4_name,
       "活动资费宣传不清晰投诉率"                                                            index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202308", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.108件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.108, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202308")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>移网>>【入网】宣传>>活动、资费宣传不清晰/模糊宣传",
                                     "投诉工单（2021版）>>融合>>【入网】宣传>>活动、资费宣传不清晰/模糊宣传",
                                     "投诉工单（2021版）>>宽带>>【入网】宣传>>活动、资费宣传不清晰/模糊宣传")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202308")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ106"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "15"                                                                                  index_level_3_id,
       "资费明示"                                                                            index_level_3_name,
       "22"                                                                                  index_level_4_id,
       "资费明示"                                                                            index_level_4_name,
       "活动资费宣传不清晰投诉率"                                                            index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202309", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.108件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.108, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202309")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>移网>>【入网】宣传>>活动、资费宣传不清晰/模糊宣传",
                                     "投诉工单（2021版）>>融合>>【入网】宣传>>活动、资费宣传不清晰/模糊宣传",
                                     "投诉工单（2021版）>>宽带>>【入网】宣传>>活动、资费宣传不清晰/模糊宣传")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202309")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
;

-- todo 13 不知情不认可投诉率 66 完成
select "FWBZ107"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "10"                                                                                  index_level_3_id,
       "业务办理"                                                                            index_level_3_name,
       "18"                                                                                  index_level_4_id,
       "业务办理"                                                                            index_level_4_name,
       "不知情不认可投诉率"                                                                  index_name,
       a.prov_code                                                                           pro_id,
       a.prov_name                                                                           pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202212", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<6.331件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 6.331, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_level,
       "GJ"                                                                                  index_level_code
from (select b.prov_code prov_code, b.prov_name prov_name, count(1) n
      from (select sheet_id, compl_area
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                   "202303", "202304", "202305", "202306")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>移网>>【入网】办理>>不知情/未经同意被办理业务",
                                     "投诉工单（2021版）>>移网>>【入网】金融分期等合约>>不知情/诱导办理合约",
                                     "投诉工单（2021版）>>移网>>【变更及服务】增值或权益业务使用>>对业务办理不认可（不知情、不承认）",
                                     "投诉工单（2021版）>>移网>>【变更及服务】增值或权益业务使用>>点播未二次确认",
                                     "投诉工单（2021版）>>移网>>【变更及服务】增值或权益业务使用>>营销无故开通",
                                     "投诉工单（2021版）>>移网>>【变更及服务】渠道服务>>电话营销诱导定制/不知情定制",
                                     "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>点播消费无二次短信确认",
                                     "投诉工单（2021版）>>融合>>【入网】办理>>不知情/未经同意被办理业务",
                                     "投诉工单（2021版）>>融合>>【入网】金融分期等合约>>不知情/诱导办理合约",
                                     "投诉工单（2021版）>>融合>>【IPTV使用】IPTV>>点播未二次确认",
                                     "投诉工单（2021版）>>融合>>【变更及服务】增值或权益业务使用>>对业务办理不认可（不知情、不承认）",
                                     "投诉工单（2021版）>>融合>>【变更及服务】增值或权益业务使用>>点播未二次确认",
                                     "投诉工单（2021版）>>融合>>【变更及服务】渠道服务>>电话营销诱导定制/不知情定制",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>点播消费无二次短信确认",
                                     "投诉工单（2021版）>>宽带>>【IPTV使用】IPTV>>点播未二次确认",
                                     "投诉工单（2021版）>>宽带>>【变更及服务】增值或权益业务使用>>对业务办理不认可（不知情、不承认）",
                                     "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>点播消费无二次短信确认")
              and sheet_status not in ("8", "11")) a
               left join dc_dim.dim_pro_city_regoin b on a.compl_area = b.code_value
      group by b.prov_code, b.prov_name) a
         left join (select substr(prov_id, 2, 3) pro_id, prov_name, cast(sum(kpi_value) as bigint) n
                    from dc_dwd_cbss.dwd_m_user_info
                    where month_id in
                          ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                           "202303", "202304", "202305", "202306")
                      and kpi_code in ("CKP_66829", "CKP_11453")
                      and prov_id != "-1"
                    group by prov_id, prov_name) b on a.prov_code = b.pro_id and a.prov_name = b.prov_name
where a.prov_name is not null
  and b.prov_name is not null;
-- union all
select "FWBZ107"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "10"                                                                                  index_level_3_id,
       "业务办理"                                                                            index_level_3_name,
       "18"                                                                                  index_level_4_id,
       "业务办理"                                                                            index_level_4_name,
       "不知情不认可投诉率"                                                                  index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202210", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<6.331件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 6.331, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202210")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>移网>>【入网】办理>>不知情/未经同意被办理业务",
                                     "投诉工单（2021版）>>移网>>【入网】金融分期等合约>>不知情/诱导办理合约",
                                     "投诉工单（2021版）>>移网>>【变更及服务】增值或权益业务使用>>对业务办理不认可（不知情、不承认）",
                                     "投诉工单（2021版）>>移网>>【变更及服务】增值或权益业务使用>>点播未二次确认",
                                     "投诉工单（2021版）>>移网>>【变更及服务】增值或权益业务使用>>营销无故开通",
                                     "投诉工单（2021版）>>移网>>【变更及服务】渠道服务>>电话营销诱导定制/不知情定制",
                                     "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>点播消费无二次短信确认",
                                     "投诉工单（2021版）>>融合>>【入网】办理>>不知情/未经同意被办理业务",
                                     "投诉工单（2021版）>>融合>>【入网】金融分期等合约>>不知情/诱导办理合约",
                                     "投诉工单（2021版）>>融合>>【IPTV使用】IPTV>>点播未二次确认",
                                     "投诉工单（2021版）>>融合>>【变更及服务】增值或权益业务使用>>对业务办理不认可（不知情、不承认）",
                                     "投诉工单（2021版）>>融合>>【变更及服务】增值或权益业务使用>>点播未二次确认",
                                     "投诉工单（2021版）>>融合>>【变更及服务】渠道服务>>电话营销诱导定制/不知情定制",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>点播消费无二次短信确认",
                                     "投诉工单（2021版）>>宽带>>【IPTV使用】IPTV>>点播未二次确认",
                                     "投诉工单（2021版）>>宽带>>【变更及服务】增值或权益业务使用>>对业务办理不认可（不知情、不承认）",
                                     "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>点播消费无二次短信确认")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202210")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ107"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "10"                                                                                  index_level_3_id,
       "业务办理"                                                                            index_level_3_name,
       "18"                                                                                  index_level_4_id,
       "业务办理"                                                                            index_level_4_name,
       "不知情不认可投诉率"                                                                  index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202211", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<6.331件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 6.331, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202211")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>移网>>【入网】办理>>不知情/未经同意被办理业务",
                                     "投诉工单（2021版）>>移网>>【入网】金融分期等合约>>不知情/诱导办理合约",
                                     "投诉工单（2021版）>>移网>>【变更及服务】增值或权益业务使用>>对业务办理不认可（不知情、不承认）",
                                     "投诉工单（2021版）>>移网>>【变更及服务】增值或权益业务使用>>点播未二次确认",
                                     "投诉工单（2021版）>>移网>>【变更及服务】增值或权益业务使用>>营销无故开通",
                                     "投诉工单（2021版）>>移网>>【变更及服务】渠道服务>>电话营销诱导定制/不知情定制",
                                     "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>点播消费无二次短信确认",
                                     "投诉工单（2021版）>>融合>>【入网】办理>>不知情/未经同意被办理业务",
                                     "投诉工单（2021版）>>融合>>【入网】金融分期等合约>>不知情/诱导办理合约",
                                     "投诉工单（2021版）>>融合>>【IPTV使用】IPTV>>点播未二次确认",
                                     "投诉工单（2021版）>>融合>>【变更及服务】增值或权益业务使用>>对业务办理不认可（不知情、不承认）",
                                     "投诉工单（2021版）>>融合>>【变更及服务】增值或权益业务使用>>点播未二次确认",
                                     "投诉工单（2021版）>>融合>>【变更及服务】渠道服务>>电话营销诱导定制/不知情定制",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>点播消费无二次短信确认",
                                     "投诉工单（2021版）>>宽带>>【IPTV使用】IPTV>>点播未二次确认",
                                     "投诉工单（2021版）>>宽带>>【变更及服务】增值或权益业务使用>>对业务办理不认可（不知情、不承认）",
                                     "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>点播消费无二次短信确认")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202211")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ107"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "10"                                                                                  index_level_3_id,
       "业务办理"                                                                            index_level_3_name,
       "18"                                                                                  index_level_4_id,
       "业务办理"                                                                            index_level_4_name,
       "不知情不认可投诉率"                                                                  index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202212", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<6.331件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 6.331, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202212")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>移网>>【入网】办理>>不知情/未经同意被办理业务",
                                     "投诉工单（2021版）>>移网>>【入网】金融分期等合约>>不知情/诱导办理合约",
                                     "投诉工单（2021版）>>移网>>【变更及服务】增值或权益业务使用>>对业务办理不认可（不知情、不承认）",
                                     "投诉工单（2021版）>>移网>>【变更及服务】增值或权益业务使用>>点播未二次确认",
                                     "投诉工单（2021版）>>移网>>【变更及服务】增值或权益业务使用>>营销无故开通",
                                     "投诉工单（2021版）>>移网>>【变更及服务】渠道服务>>电话营销诱导定制/不知情定制",
                                     "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>点播消费无二次短信确认",
                                     "投诉工单（2021版）>>融合>>【入网】办理>>不知情/未经同意被办理业务",
                                     "投诉工单（2021版）>>融合>>【入网】金融分期等合约>>不知情/诱导办理合约",
                                     "投诉工单（2021版）>>融合>>【IPTV使用】IPTV>>点播未二次确认",
                                     "投诉工单（2021版）>>融合>>【变更及服务】增值或权益业务使用>>对业务办理不认可（不知情、不承认）",
                                     "投诉工单（2021版）>>融合>>【变更及服务】增值或权益业务使用>>点播未二次确认",
                                     "投诉工单（2021版）>>融合>>【变更及服务】渠道服务>>电话营销诱导定制/不知情定制",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>点播消费无二次短信确认",
                                     "投诉工单（2021版）>>宽带>>【IPTV使用】IPTV>>点播未二次确认",
                                     "投诉工单（2021版）>>宽带>>【变更及服务】增值或权益业务使用>>对业务办理不认可（不知情、不承认）",
                                     "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>点播消费无二次短信确认")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202212")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ107"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "10"                                                                                  index_level_3_id,
       "业务办理"                                                                            index_level_3_name,
       "18"                                                                                  index_level_4_id,
       "业务办理"                                                                            index_level_4_name,
       "不知情不认可投诉率"                                                                  index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202301", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<6.331件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 6.331, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202301")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>移网>>【入网】办理>>不知情/未经同意被办理业务",
                                     "投诉工单（2021版）>>移网>>【入网】金融分期等合约>>不知情/诱导办理合约",
                                     "投诉工单（2021版）>>移网>>【变更及服务】增值或权益业务使用>>对业务办理不认可（不知情、不承认）",
                                     "投诉工单（2021版）>>移网>>【变更及服务】增值或权益业务使用>>点播未二次确认",
                                     "投诉工单（2021版）>>移网>>【变更及服务】增值或权益业务使用>>营销无故开通",
                                     "投诉工单（2021版）>>移网>>【变更及服务】渠道服务>>电话营销诱导定制/不知情定制",
                                     "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>点播消费无二次短信确认",
                                     "投诉工单（2021版）>>融合>>【入网】办理>>不知情/未经同意被办理业务",
                                     "投诉工单（2021版）>>融合>>【入网】金融分期等合约>>不知情/诱导办理合约",
                                     "投诉工单（2021版）>>融合>>【IPTV使用】IPTV>>点播未二次确认",
                                     "投诉工单（2021版）>>融合>>【变更及服务】增值或权益业务使用>>对业务办理不认可（不知情、不承认）",
                                     "投诉工单（2021版）>>融合>>【变更及服务】增值或权益业务使用>>点播未二次确认",
                                     "投诉工单（2021版）>>融合>>【变更及服务】渠道服务>>电话营销诱导定制/不知情定制",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>点播消费无二次短信确认",
                                     "投诉工单（2021版）>>宽带>>【IPTV使用】IPTV>>点播未二次确认",
                                     "投诉工单（2021版）>>宽带>>【变更及服务】增值或权益业务使用>>对业务办理不认可（不知情、不承认）",
                                     "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>点播消费无二次短信确认")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202301")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ107"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "10"                                                                                  index_level_3_id,
       "业务办理"                                                                            index_level_3_name,
       "18"                                                                                  index_level_4_id,
       "业务办理"                                                                            index_level_4_name,
       "不知情不认可投诉率"                                                                  index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202302", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<6.331件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 6.331, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202302")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>移网>>【入网】办理>>不知情/未经同意被办理业务",
                                     "投诉工单（2021版）>>移网>>【入网】金融分期等合约>>不知情/诱导办理合约",
                                     "投诉工单（2021版）>>移网>>【变更及服务】增值或权益业务使用>>对业务办理不认可（不知情、不承认）",
                                     "投诉工单（2021版）>>移网>>【变更及服务】增值或权益业务使用>>点播未二次确认",
                                     "投诉工单（2021版）>>移网>>【变更及服务】增值或权益业务使用>>营销无故开通",
                                     "投诉工单（2021版）>>移网>>【变更及服务】渠道服务>>电话营销诱导定制/不知情定制",
                                     "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>点播消费无二次短信确认",
                                     "投诉工单（2021版）>>融合>>【入网】办理>>不知情/未经同意被办理业务",
                                     "投诉工单（2021版）>>融合>>【入网】金融分期等合约>>不知情/诱导办理合约",
                                     "投诉工单（2021版）>>融合>>【IPTV使用】IPTV>>点播未二次确认",
                                     "投诉工单（2021版）>>融合>>【变更及服务】增值或权益业务使用>>对业务办理不认可（不知情、不承认）",
                                     "投诉工单（2021版）>>融合>>【变更及服务】增值或权益业务使用>>点播未二次确认",
                                     "投诉工单（2021版）>>融合>>【变更及服务】渠道服务>>电话营销诱导定制/不知情定制",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>点播消费无二次短信确认",
                                     "投诉工单（2021版）>>宽带>>【IPTV使用】IPTV>>点播未二次确认",
                                     "投诉工单（2021版）>>宽带>>【变更及服务】增值或权益业务使用>>对业务办理不认可（不知情、不承认）",
                                     "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>点播消费无二次短信确认")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202302")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ107"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "10"                                                                                  index_level_3_id,
       "业务办理"                                                                            index_level_3_name,
       "18"                                                                                  index_level_4_id,
       "业务办理"                                                                            index_level_4_name,
       "不知情不认可投诉率"                                                                  index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202303", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<6.331件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 6.331, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202303")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>移网>>【入网】办理>>不知情/未经同意被办理业务",
                                     "投诉工单（2021版）>>移网>>【入网】金融分期等合约>>不知情/诱导办理合约",
                                     "投诉工单（2021版）>>移网>>【变更及服务】增值或权益业务使用>>对业务办理不认可（不知情、不承认）",
                                     "投诉工单（2021版）>>移网>>【变更及服务】增值或权益业务使用>>点播未二次确认",
                                     "投诉工单（2021版）>>移网>>【变更及服务】增值或权益业务使用>>营销无故开通",
                                     "投诉工单（2021版）>>移网>>【变更及服务】渠道服务>>电话营销诱导定制/不知情定制",
                                     "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>点播消费无二次短信确认",
                                     "投诉工单（2021版）>>融合>>【入网】办理>>不知情/未经同意被办理业务",
                                     "投诉工单（2021版）>>融合>>【入网】金融分期等合约>>不知情/诱导办理合约",
                                     "投诉工单（2021版）>>融合>>【IPTV使用】IPTV>>点播未二次确认",
                                     "投诉工单（2021版）>>融合>>【变更及服务】增值或权益业务使用>>对业务办理不认可（不知情、不承认）",
                                     "投诉工单（2021版）>>融合>>【变更及服务】增值或权益业务使用>>点播未二次确认",
                                     "投诉工单（2021版）>>融合>>【变更及服务】渠道服务>>电话营销诱导定制/不知情定制",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>点播消费无二次短信确认",
                                     "投诉工单（2021版）>>宽带>>【IPTV使用】IPTV>>点播未二次确认",
                                     "投诉工单（2021版）>>宽带>>【变更及服务】增值或权益业务使用>>对业务办理不认可（不知情、不承认）",
                                     "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>点播消费无二次短信确认")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202303")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ107"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "10"                                                                                  index_level_3_id,
       "业务办理"                                                                            index_level_3_name,
       "18"                                                                                  index_level_4_id,
       "业务办理"                                                                            index_level_4_name,
       "不知情不认可投诉率"                                                                  index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202304", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<6.331件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 6.331, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202304")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>移网>>【入网】办理>>不知情/未经同意被办理业务",
                                     "投诉工单（2021版）>>移网>>【入网】金融分期等合约>>不知情/诱导办理合约",
                                     "投诉工单（2021版）>>移网>>【变更及服务】增值或权益业务使用>>对业务办理不认可（不知情、不承认）",
                                     "投诉工单（2021版）>>移网>>【变更及服务】增值或权益业务使用>>点播未二次确认",
                                     "投诉工单（2021版）>>移网>>【变更及服务】增值或权益业务使用>>营销无故开通",
                                     "投诉工单（2021版）>>移网>>【变更及服务】渠道服务>>电话营销诱导定制/不知情定制",
                                     "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>点播消费无二次短信确认",
                                     "投诉工单（2021版）>>融合>>【入网】办理>>不知情/未经同意被办理业务",
                                     "投诉工单（2021版）>>融合>>【入网】金融分期等合约>>不知情/诱导办理合约",
                                     "投诉工单（2021版）>>融合>>【IPTV使用】IPTV>>点播未二次确认",
                                     "投诉工单（2021版）>>融合>>【变更及服务】增值或权益业务使用>>对业务办理不认可（不知情、不承认）",
                                     "投诉工单（2021版）>>融合>>【变更及服务】增值或权益业务使用>>点播未二次确认",
                                     "投诉工单（2021版）>>融合>>【变更及服务】渠道服务>>电话营销诱导定制/不知情定制",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>点播消费无二次短信确认",
                                     "投诉工单（2021版）>>宽带>>【IPTV使用】IPTV>>点播未二次确认",
                                     "投诉工单（2021版）>>宽带>>【变更及服务】增值或权益业务使用>>对业务办理不认可（不知情、不承认）",
                                     "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>点播消费无二次短信确认")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202304")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ107"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "10"                                                                                  index_level_3_id,
       "业务办理"                                                                            index_level_3_name,
       "18"                                                                                  index_level_4_id,
       "业务办理"                                                                            index_level_4_name,
       "不知情不认可投诉率"                                                                  index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202305", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<6.331件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 6.331, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202305")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>移网>>【入网】办理>>不知情/未经同意被办理业务",
                                     "投诉工单（2021版）>>移网>>【入网】金融分期等合约>>不知情/诱导办理合约",
                                     "投诉工单（2021版）>>移网>>【变更及服务】增值或权益业务使用>>对业务办理不认可（不知情、不承认）",
                                     "投诉工单（2021版）>>移网>>【变更及服务】增值或权益业务使用>>点播未二次确认",
                                     "投诉工单（2021版）>>移网>>【变更及服务】增值或权益业务使用>>营销无故开通",
                                     "投诉工单（2021版）>>移网>>【变更及服务】渠道服务>>电话营销诱导定制/不知情定制",
                                     "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>点播消费无二次短信确认",
                                     "投诉工单（2021版）>>融合>>【入网】办理>>不知情/未经同意被办理业务",
                                     "投诉工单（2021版）>>融合>>【入网】金融分期等合约>>不知情/诱导办理合约",
                                     "投诉工单（2021版）>>融合>>【IPTV使用】IPTV>>点播未二次确认",
                                     "投诉工单（2021版）>>融合>>【变更及服务】增值或权益业务使用>>对业务办理不认可（不知情、不承认）",
                                     "投诉工单（2021版）>>融合>>【变更及服务】增值或权益业务使用>>点播未二次确认",
                                     "投诉工单（2021版）>>融合>>【变更及服务】渠道服务>>电话营销诱导定制/不知情定制",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>点播消费无二次短信确认",
                                     "投诉工单（2021版）>>宽带>>【IPTV使用】IPTV>>点播未二次确认",
                                     "投诉工单（2021版）>>宽带>>【变更及服务】增值或权益业务使用>>对业务办理不认可（不知情、不承认）",
                                     "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>点播消费无二次短信确认")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202305")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ107"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "10"                                                                                  index_level_3_id,
       "业务办理"                                                                            index_level_3_name,
       "18"                                                                                  index_level_4_id,
       "业务办理"                                                                            index_level_4_name,
       "不知情不认可投诉率"                                                                  index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202306", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<6.331件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 6.331, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202306")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>移网>>【入网】办理>>不知情/未经同意被办理业务",
                                     "投诉工单（2021版）>>移网>>【入网】金融分期等合约>>不知情/诱导办理合约",
                                     "投诉工单（2021版）>>移网>>【变更及服务】增值或权益业务使用>>对业务办理不认可（不知情、不承认）",
                                     "投诉工单（2021版）>>移网>>【变更及服务】增值或权益业务使用>>点播未二次确认",
                                     "投诉工单（2021版）>>移网>>【变更及服务】增值或权益业务使用>>营销无故开通",
                                     "投诉工单（2021版）>>移网>>【变更及服务】渠道服务>>电话营销诱导定制/不知情定制",
                                     "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>点播消费无二次短信确认",
                                     "投诉工单（2021版）>>融合>>【入网】办理>>不知情/未经同意被办理业务",
                                     "投诉工单（2021版）>>融合>>【入网】金融分期等合约>>不知情/诱导办理合约",
                                     "投诉工单（2021版）>>融合>>【IPTV使用】IPTV>>点播未二次确认",
                                     "投诉工单（2021版）>>融合>>【变更及服务】增值或权益业务使用>>对业务办理不认可（不知情、不承认）",
                                     "投诉工单（2021版）>>融合>>【变更及服务】增值或权益业务使用>>点播未二次确认",
                                     "投诉工单（2021版）>>融合>>【变更及服务】渠道服务>>电话营销诱导定制/不知情定制",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>点播消费无二次短信确认",
                                     "投诉工单（2021版）>>宽带>>【IPTV使用】IPTV>>点播未二次确认",
                                     "投诉工单（2021版）>>宽带>>【变更及服务】增值或权益业务使用>>对业务办理不认可（不知情、不承认）",
                                     "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>点播消费无二次短信确认")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202306")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ107"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "10"                                                                                  index_level_3_id,
       "业务办理"                                                                            index_level_3_name,
       "18"                                                                                  index_level_4_id,
       "业务办理"                                                                            index_level_4_name,
       "不知情不认可投诉率"                                                                  index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202307", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<6.331件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 6.331, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202307")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>移网>>【入网】办理>>不知情/未经同意被办理业务",
                                     "投诉工单（2021版）>>移网>>【入网】金融分期等合约>>不知情/诱导办理合约",
                                     "投诉工单（2021版）>>移网>>【变更及服务】增值或权益业务使用>>对业务办理不认可（不知情、不承认）",
                                     "投诉工单（2021版）>>移网>>【变更及服务】增值或权益业务使用>>点播未二次确认",
                                     "投诉工单（2021版）>>移网>>【变更及服务】增值或权益业务使用>>营销无故开通",
                                     "投诉工单（2021版）>>移网>>【变更及服务】渠道服务>>电话营销诱导定制/不知情定制",
                                     "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>点播消费无二次短信确认",
                                     "投诉工单（2021版）>>融合>>【入网】办理>>不知情/未经同意被办理业务",
                                     "投诉工单（2021版）>>融合>>【入网】金融分期等合约>>不知情/诱导办理合约",
                                     "投诉工单（2021版）>>融合>>【IPTV使用】IPTV>>点播未二次确认",
                                     "投诉工单（2021版）>>融合>>【变更及服务】增值或权益业务使用>>对业务办理不认可（不知情、不承认）",
                                     "投诉工单（2021版）>>融合>>【变更及服务】增值或权益业务使用>>点播未二次确认",
                                     "投诉工单（2021版）>>融合>>【变更及服务】渠道服务>>电话营销诱导定制/不知情定制",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>点播消费无二次短信确认",
                                     "投诉工单（2021版）>>宽带>>【IPTV使用】IPTV>>点播未二次确认",
                                     "投诉工单（2021版）>>宽带>>【变更及服务】增值或权益业务使用>>对业务办理不认可（不知情、不承认）",
                                     "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>点播消费无二次短信确认")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202307")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ107"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "10"                                                                                  index_level_3_id,
       "业务办理"                                                                            index_level_3_name,
       "18"                                                                                  index_level_4_id,
       "业务办理"                                                                            index_level_4_name,
       "不知情不认可投诉率"                                                                  index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202308", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<6.331件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 6.331, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202308")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>移网>>【入网】办理>>不知情/未经同意被办理业务",
                                     "投诉工单（2021版）>>移网>>【入网】金融分期等合约>>不知情/诱导办理合约",
                                     "投诉工单（2021版）>>移网>>【变更及服务】增值或权益业务使用>>对业务办理不认可（不知情、不承认）",
                                     "投诉工单（2021版）>>移网>>【变更及服务】增值或权益业务使用>>点播未二次确认",
                                     "投诉工单（2021版）>>移网>>【变更及服务】增值或权益业务使用>>营销无故开通",
                                     "投诉工单（2021版）>>移网>>【变更及服务】渠道服务>>电话营销诱导定制/不知情定制",
                                     "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>点播消费无二次短信确认",
                                     "投诉工单（2021版）>>融合>>【入网】办理>>不知情/未经同意被办理业务",
                                     "投诉工单（2021版）>>融合>>【入网】金融分期等合约>>不知情/诱导办理合约",
                                     "投诉工单（2021版）>>融合>>【IPTV使用】IPTV>>点播未二次确认",
                                     "投诉工单（2021版）>>融合>>【变更及服务】增值或权益业务使用>>对业务办理不认可（不知情、不承认）",
                                     "投诉工单（2021版）>>融合>>【变更及服务】增值或权益业务使用>>点播未二次确认",
                                     "投诉工单（2021版）>>融合>>【变更及服务】渠道服务>>电话营销诱导定制/不知情定制",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>点播消费无二次短信确认",
                                     "投诉工单（2021版）>>宽带>>【IPTV使用】IPTV>>点播未二次确认",
                                     "投诉工单（2021版）>>宽带>>【变更及服务】增值或权益业务使用>>对业务办理不认可（不知情、不承认）",
                                     "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>点播消费无二次短信确认")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202308")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ107"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "10"                                                                                  index_level_3_id,
       "业务办理"                                                                            index_level_3_name,
       "18"                                                                                  index_level_4_id,
       "业务办理"                                                                            index_level_4_name,
       "不知情不认可投诉率"                                                                  index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202309", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<6.331件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 6.331, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202309")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>移网>>【入网】办理>>不知情/未经同意被办理业务",
                                     "投诉工单（2021版）>>移网>>【入网】金融分期等合约>>不知情/诱导办理合约",
                                     "投诉工单（2021版）>>移网>>【变更及服务】增值或权益业务使用>>对业务办理不认可（不知情、不承认）",
                                     "投诉工单（2021版）>>移网>>【变更及服务】增值或权益业务使用>>点播未二次确认",
                                     "投诉工单（2021版）>>移网>>【变更及服务】增值或权益业务使用>>营销无故开通",
                                     "投诉工单（2021版）>>移网>>【变更及服务】渠道服务>>电话营销诱导定制/不知情定制",
                                     "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>点播消费无二次短信确认",
                                     "投诉工单（2021版）>>融合>>【入网】办理>>不知情/未经同意被办理业务",
                                     "投诉工单（2021版）>>融合>>【入网】金融分期等合约>>不知情/诱导办理合约",
                                     "投诉工单（2021版）>>融合>>【IPTV使用】IPTV>>点播未二次确认",
                                     "投诉工单（2021版）>>融合>>【变更及服务】增值或权益业务使用>>对业务办理不认可（不知情、不承认）",
                                     "投诉工单（2021版）>>融合>>【变更及服务】增值或权益业务使用>>点播未二次确认",
                                     "投诉工单（2021版）>>融合>>【变更及服务】渠道服务>>电话营销诱导定制/不知情定制",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>点播消费无二次短信确认",
                                     "投诉工单（2021版）>>宽带>>【IPTV使用】IPTV>>点播未二次确认",
                                     "投诉工单（2021版）>>宽带>>【变更及服务】增值或权益业务使用>>对业务办理不认可（不知情、不承认）",
                                     "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>点播消费无二次短信确认")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202309")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
;

-- todo 14 消费提醒投诉率 68
select "FWBZ108"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "09"                                                                                  index_level_3_id,
       "消费服务"                                                                            index_level_3_name,
       "16"                                                                                  index_level_4_id,
       "消费提醒"                                                                            index_level_4_name,
       "消费提醒投诉率"                                                                      index_name,
       a.prov_code                                                                           pro_id,
       a.prov_name                                                                           pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202212", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.757件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.757, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_level,
       "GJ"                                                                                  index_level_code
from (select b.prov_code prov_code, b.prov_name prov_name, count(1) n
      from (select sheet_id, compl_area
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                   "202303", "202304", "202305", "202306")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in
                  ("投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>流量使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>语音使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>欠费提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>赠款提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>权益使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>停复机提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>漏话提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>提醒过度/提醒时间不合理",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>提醒内容不准确",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>账单提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>流量使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>语音使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>欠费提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>赠款提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>权益使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>停复机提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>漏话提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>提醒过度/提醒时间不合理",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>提醒内容不准确",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>账单提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>宽带提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>欠费提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>赠款提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>权益使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>停复机提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>提醒过度/提醒时间不合理",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>提醒内容不准确",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>宽带提醒不及时/不到位/未提醒")
              and sheet_status not in ("8", "11")) a
               left join dc_dim.dim_pro_city_regoin b on a.compl_area = b.code_value
      group by b.prov_code, b.prov_name) a
         left join (select substr(prov_id, 2, 3) pro_id, prov_name, cast(sum(kpi_value) as bigint) n
                    from dc_dwd_cbss.dwd_m_user_info
                    where month_id in
                          ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                           "202303", "202304", "202305", "202306")
                      and kpi_code in ("CKP_66829", "CKP_11453")
                      and prov_id != "-1"
                    group by prov_id, prov_name) b on a.prov_code = b.pro_id and a.prov_name = b.prov_name
where a.prov_name is not null
  and b.prov_name is not null;
-- union all
select "FWBZ108"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "09"                                                                                  index_level_3_id,
       "消费服务"                                                                            index_level_3_name,
       "16"                                                                                  index_level_4_id,
       "消费提醒"                                                                            index_level_4_name,
       "消费提醒投诉率"                                                                      index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202210", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.757件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.757, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202210")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in
                  ("投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>流量使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>语音使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>欠费提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>赠款提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>权益使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>停复机提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>漏话提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>提醒过度/提醒时间不合理",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>提醒内容不准确",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>账单提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>流量使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>语音使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>欠费提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>赠款提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>权益使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>停复机提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>漏话提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>提醒过度/提醒时间不合理",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>提醒内容不准确",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>账单提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>宽带提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>欠费提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>赠款提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>权益使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>停复机提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>提醒过度/提醒时间不合理",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>提醒内容不准确",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>宽带提醒不及时/不到位/未提醒")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202210")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ108"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "09"                                                                                  index_level_3_id,
       "消费服务"                                                                            index_level_3_name,
       "16"                                                                                  index_level_4_id,
       "消费提醒"                                                                            index_level_4_name,
       "消费提醒投诉率"                                                                      index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202211", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.757件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.757, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202211")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in
                  ("投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>流量使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>语音使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>欠费提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>赠款提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>权益使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>停复机提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>漏话提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>提醒过度/提醒时间不合理",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>提醒内容不准确",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>账单提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>流量使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>语音使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>欠费提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>赠款提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>权益使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>停复机提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>漏话提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>提醒过度/提醒时间不合理",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>提醒内容不准确",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>账单提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>宽带提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>欠费提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>赠款提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>权益使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>停复机提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>提醒过度/提醒时间不合理",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>提醒内容不准确",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>宽带提醒不及时/不到位/未提醒")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202211")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ108"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "09"                                                                                  index_level_3_id,
       "消费服务"                                                                            index_level_3_name,
       "16"                                                                                  index_level_4_id,
       "消费提醒"                                                                            index_level_4_name,
       "消费提醒投诉率"                                                                      index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202212", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.757件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.757, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202212")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in
                  ("投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>流量使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>语音使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>欠费提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>赠款提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>权益使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>停复机提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>漏话提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>提醒过度/提醒时间不合理",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>提醒内容不准确",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>账单提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>流量使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>语音使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>欠费提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>赠款提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>权益使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>停复机提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>漏话提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>提醒过度/提醒时间不合理",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>提醒内容不准确",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>账单提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>宽带提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>欠费提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>赠款提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>权益使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>停复机提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>提醒过度/提醒时间不合理",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>提醒内容不准确",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>宽带提醒不及时/不到位/未提醒")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202212")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ108"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "09"                                                                                  index_level_3_id,
       "消费服务"                                                                            index_level_3_name,
       "16"                                                                                  index_level_4_id,
       "消费提醒"                                                                            index_level_4_name,
       "消费提醒投诉率"                                                                      index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202301", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.757件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.757, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202301")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in
                  ("投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>流量使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>语音使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>欠费提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>赠款提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>权益使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>停复机提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>漏话提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>提醒过度/提醒时间不合理",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>提醒内容不准确",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>账单提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>流量使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>语音使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>欠费提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>赠款提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>权益使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>停复机提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>漏话提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>提醒过度/提醒时间不合理",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>提醒内容不准确",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>账单提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>宽带提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>欠费提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>赠款提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>权益使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>停复机提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>提醒过度/提醒时间不合理",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>提醒内容不准确",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>宽带提醒不及时/不到位/未提醒")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202301")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ108"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "09"                                                                                  index_level_3_id,
       "消费服务"                                                                            index_level_3_name,
       "16"                                                                                  index_level_4_id,
       "消费提醒"                                                                            index_level_4_name,
       "消费提醒投诉率"                                                                      index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202302", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.757件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.757, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202302")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in
                  ("投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>流量使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>语音使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>欠费提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>赠款提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>权益使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>停复机提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>漏话提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>提醒过度/提醒时间不合理",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>提醒内容不准确",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>账单提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>流量使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>语音使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>欠费提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>赠款提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>权益使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>停复机提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>漏话提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>提醒过度/提醒时间不合理",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>提醒内容不准确",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>账单提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>宽带提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>欠费提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>赠款提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>权益使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>停复机提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>提醒过度/提醒时间不合理",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>提醒内容不准确",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>宽带提醒不及时/不到位/未提醒")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202302")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ108"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "09"                                                                                  index_level_3_id,
       "消费服务"                                                                            index_level_3_name,
       "16"                                                                                  index_level_4_id,
       "消费提醒"                                                                            index_level_4_name,
       "消费提醒投诉率"                                                                      index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202303", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.757件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.757, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202303")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in
                  ("投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>流量使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>语音使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>欠费提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>赠款提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>权益使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>停复机提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>漏话提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>提醒过度/提醒时间不合理",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>提醒内容不准确",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>账单提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>流量使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>语音使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>欠费提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>赠款提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>权益使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>停复机提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>漏话提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>提醒过度/提醒时间不合理",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>提醒内容不准确",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>账单提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>宽带提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>欠费提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>赠款提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>权益使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>停复机提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>提醒过度/提醒时间不合理",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>提醒内容不准确",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>宽带提醒不及时/不到位/未提醒")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202303")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ108"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "09"                                                                                  index_level_3_id,
       "消费服务"                                                                            index_level_3_name,
       "16"                                                                                  index_level_4_id,
       "消费提醒"                                                                            index_level_4_name,
       "消费提醒投诉率"                                                                      index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202304", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.757件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.757, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202304")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in
                  ("投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>流量使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>语音使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>欠费提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>赠款提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>权益使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>停复机提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>漏话提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>提醒过度/提醒时间不合理",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>提醒内容不准确",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>账单提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>流量使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>语音使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>欠费提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>赠款提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>权益使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>停复机提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>漏话提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>提醒过度/提醒时间不合理",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>提醒内容不准确",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>账单提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>宽带提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>欠费提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>赠款提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>权益使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>停复机提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>提醒过度/提醒时间不合理",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>提醒内容不准确",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>宽带提醒不及时/不到位/未提醒")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202304")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ108"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "09"                                                                                  index_level_3_id,
       "消费服务"                                                                            index_level_3_name,
       "16"                                                                                  index_level_4_id,
       "消费提醒"                                                                            index_level_4_name,
       "消费提醒投诉率"                                                                      index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202305", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.757件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.757, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202305")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in
                  ("投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>流量使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>语音使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>欠费提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>赠款提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>权益使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>停复机提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>漏话提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>提醒过度/提醒时间不合理",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>提醒内容不准确",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>账单提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>流量使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>语音使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>欠费提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>赠款提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>权益使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>停复机提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>漏话提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>提醒过度/提醒时间不合理",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>提醒内容不准确",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>账单提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>宽带提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>欠费提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>赠款提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>权益使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>停复机提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>提醒过度/提醒时间不合理",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>提醒内容不准确",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>宽带提醒不及时/不到位/未提醒")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202305")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ108"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "09"                                                                                  index_level_3_id,
       "消费服务"                                                                            index_level_3_name,
       "16"                                                                                  index_level_4_id,
       "消费提醒"                                                                            index_level_4_name,
       "消费提醒投诉率"                                                                      index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202306", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.757件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.757, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202306")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in
                  ("投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>流量使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>语音使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>欠费提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>赠款提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>权益使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>停复机提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>漏话提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>提醒过度/提醒时间不合理",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>提醒内容不准确",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>账单提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>流量使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>语音使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>欠费提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>赠款提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>权益使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>停复机提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>漏话提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>提醒过度/提醒时间不合理",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>提醒内容不准确",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>账单提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>宽带提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>欠费提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>赠款提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>权益使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>停复机提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>提醒过度/提醒时间不合理",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>提醒内容不准确",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>宽带提醒不及时/不到位/未提醒")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202306")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ108"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "09"                                                                                  index_level_3_id,
       "消费服务"                                                                            index_level_3_name,
       "16"                                                                                  index_level_4_id,
       "消费提醒"                                                                            index_level_4_name,
       "消费提醒投诉率"                                                                      index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202307", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.757件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.757, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202307")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in
                  ("投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>流量使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>语音使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>欠费提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>赠款提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>权益使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>停复机提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>漏话提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>提醒过度/提醒时间不合理",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>提醒内容不准确",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>账单提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>流量使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>语音使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>欠费提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>赠款提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>权益使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>停复机提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>漏话提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>提醒过度/提醒时间不合理",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>提醒内容不准确",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>账单提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>宽带提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>欠费提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>赠款提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>权益使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>停复机提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>提醒过度/提醒时间不合理",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>提醒内容不准确",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>宽带提醒不及时/不到位/未提醒")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202307")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ108"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "09"                                                                                  index_level_3_id,
       "消费服务"                                                                            index_level_3_name,
       "16"                                                                                  index_level_4_id,
       "消费提醒"                                                                            index_level_4_name,
       "消费提醒投诉率"                                                                      index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202308", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.757件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.757, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202308")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in
                  ("投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>流量使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>语音使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>欠费提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>赠款提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>权益使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>停复机提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>漏话提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>提醒过度/提醒时间不合理",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>提醒内容不准确",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>账单提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>流量使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>语音使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>欠费提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>赠款提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>权益使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>停复机提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>漏话提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>提醒过度/提醒时间不合理",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>提醒内容不准确",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>账单提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>宽带提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>欠费提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>赠款提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>权益使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>停复机提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>提醒过度/提醒时间不合理",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>提醒内容不准确",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>宽带提醒不及时/不到位/未提醒")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202308")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ108"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "09"                                                                                  index_level_3_id,
       "消费服务"                                                                            index_level_3_name,
       "16"                                                                                  index_level_4_id,
       "消费提醒"                                                                            index_level_4_name,
       "消费提醒投诉率"                                                                      index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202309", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.757件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.757, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202309")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in
                  ("投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>流量使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>语音使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>欠费提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>赠款提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>权益使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>停复机提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>漏话提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>提醒过度/提醒时间不合理",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>提醒内容不准确",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>账单提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>流量使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>语音使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>欠费提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>赠款提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>权益使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>停复机提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>漏话提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>提醒过度/提醒时间不合理",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>提醒内容不准确",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>账单提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>宽带提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>欠费提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>赠款提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>权益使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>停复机提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>提醒过度/提醒时间不合理",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>提醒内容不准确",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】消费提示>>宽带提醒不及时/不到位/未提醒")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202309")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
;

-- todo 15 合约到期提醒投诉率 70 完成
select "FWBZ109"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "09"                                                                                  index_level_3_id,
       "消费服务"                                                                            index_level_3_name,
       "16"                                                                                  index_level_4_id,
       "消费提醒"                                                                            index_level_4_name,
       "合约到期提醒投诉率"                                                                  index_name,
       a.prov_code                                                                           pro_id,
       a.prov_name                                                                           pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202212", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.068件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.068, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_level,
       "GJ"                                                                                  index_level_code
from (select b.prov_code prov_code, b.prov_name prov_name, count(1) n
      from (select sheet_id, compl_area
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                   "202303", "202304", "202305", "202306")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in
                  ("投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>合约使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>合约使用提醒不及时/不到位/未提醒")
              and sheet_status not in ("8", "11")) a
               left join dc_dim.dim_pro_city_regoin b on a.compl_area = b.code_value
      group by b.prov_code, b.prov_name) a
         left join (select substr(prov_id, 2, 3) pro_id, prov_name, cast(sum(kpi_value) as bigint) n
                    from dc_dwd_cbss.dwd_m_user_info
                    where month_id in
                          ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                           "202303", "202304", "202305", "202306")
                      and kpi_code in ("CKP_66829", "CKP_11453")
                      and prov_id != "-1"
                    group by prov_id, prov_name) b on a.prov_code = b.pro_id and a.prov_name = b.prov_name
where a.prov_name is not null
  and b.prov_name is not null;
-- union all
select "FWBZ109"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "09"                                                                                  index_level_3_id,
       "消费服务"                                                                            index_level_3_name,
       "16"                                                                                  index_level_4_id,
       "消费提醒"                                                                            index_level_4_name,
       "合约到期提醒投诉率"                                                                  index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202210", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.068件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.068, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202210")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in
                  ("投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>合约使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>合约使用提醒不及时/不到位/未提醒")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202210")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ109"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "09"                                                                                  index_level_3_id,
       "消费服务"                                                                            index_level_3_name,
       "16"                                                                                  index_level_4_id,
       "消费提醒"                                                                            index_level_4_name,
       "合约到期提醒投诉率"                                                                  index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202211", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.068件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.068, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202211")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in
                  ("投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>合约使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>合约使用提醒不及时/不到位/未提醒")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202211")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ109"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "09"                                                                                  index_level_3_id,
       "消费服务"                                                                            index_level_3_name,
       "16"                                                                                  index_level_4_id,
       "消费提醒"                                                                            index_level_4_name,
       "合约到期提醒投诉率"                                                                  index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202212", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.068件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.068, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202212")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in
                  ("投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>合约使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>合约使用提醒不及时/不到位/未提醒")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202212")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ109"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "09"                                                                                  index_level_3_id,
       "消费服务"                                                                            index_level_3_name,
       "16"                                                                                  index_level_4_id,
       "消费提醒"                                                                            index_level_4_name,
       "合约到期提醒投诉率"                                                                  index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202301", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.068件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.068, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202301")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in
                  ("投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>合约使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>合约使用提醒不及时/不到位/未提醒")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202301")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ109"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "09"                                                                                  index_level_3_id,
       "消费服务"                                                                            index_level_3_name,
       "16"                                                                                  index_level_4_id,
       "消费提醒"                                                                            index_level_4_name,
       "合约到期提醒投诉率"                                                                  index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202302", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.068件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.068, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202302")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in
                  ("投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>合约使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>合约使用提醒不及时/不到位/未提醒")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202302")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ109"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "09"                                                                                  index_level_3_id,
       "消费服务"                                                                            index_level_3_name,
       "16"                                                                                  index_level_4_id,
       "消费提醒"                                                                            index_level_4_name,
       "合约到期提醒投诉率"                                                                  index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202303", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.068件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.068, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202303")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in
                  ("投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>合约使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>合约使用提醒不及时/不到位/未提醒")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202303")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ109"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "09"                                                                                  index_level_3_id,
       "消费服务"                                                                            index_level_3_name,
       "16"                                                                                  index_level_4_id,
       "消费提醒"                                                                            index_level_4_name,
       "合约到期提醒投诉率"                                                                  index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202304", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.068件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.068, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202304")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in
                  ("投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>合约使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>合约使用提醒不及时/不到位/未提醒")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202304")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ109"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "09"                                                                                  index_level_3_id,
       "消费服务"                                                                            index_level_3_name,
       "16"                                                                                  index_level_4_id,
       "消费提醒"                                                                            index_level_4_name,
       "合约到期提醒投诉率"                                                                  index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202305", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.068件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.068, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202305")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in
                  ("投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>合约使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>合约使用提醒不及时/不到位/未提醒")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202305")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ109"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "09"                                                                                  index_level_3_id,
       "消费服务"                                                                            index_level_3_name,
       "16"                                                                                  index_level_4_id,
       "消费提醒"                                                                            index_level_4_name,
       "合约到期提醒投诉率"                                                                  index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202306", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.068件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.068, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202306")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in
                  ("投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>合约使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>合约使用提醒不及时/不到位/未提醒")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202306")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ109"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "09"                                                                                  index_level_3_id,
       "消费服务"                                                                            index_level_3_name,
       "16"                                                                                  index_level_4_id,
       "消费提醒"                                                                            index_level_4_name,
       "合约到期提醒投诉率"                                                                  index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202307", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.068件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.068, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202307")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in
                  ("投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>合约使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>合约使用提醒不及时/不到位/未提醒")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202307")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ109"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "09"                                                                                  index_level_3_id,
       "消费服务"                                                                            index_level_3_name,
       "16"                                                                                  index_level_4_id,
       "消费提醒"                                                                            index_level_4_name,
       "合约到期提醒投诉率"                                                                  index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202308", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.068件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.068, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202308")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in
                  ("投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>合约使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>合约使用提醒不及时/不到位/未提醒")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202308")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ109"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "09"                                                                                  index_level_3_id,
       "消费服务"                                                                            index_level_3_name,
       "16"                                                                                  index_level_4_id,
       "消费提醒"                                                                            index_level_4_name,
       "合约到期提醒投诉率"                                                                  index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202309", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.068件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.068, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202309")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in
                  ("投诉工单（2021版）>>移网>>【产品及计费使用】消费提示>>合约使用提醒不及时/不到位/未提醒",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】消费提示>>合约使用提醒不及时/不到位/未提醒")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202309")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
;

-- todo 16 账单内容投诉率 72  完成
select "FWBZ110"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "09"                                                                                  index_level_3_id,
       "消费服务"                                                                            index_level_3_name,
       "20"                                                                                  index_level_4_id,
       "账单服务"                                                                            index_level_4_name,
       "账单内容投诉率"                                                                      index_name,
       a.prov_code                                                                           pro_id,
       a.prov_name                                                                           pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202212", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.397件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.397, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_level,
       "GJ"                                                                                  index_level_code
from (select b.prov_code prov_code, b.prov_name prov_name, count(1) n
      from (select sheet_id, compl_area
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                   "202303", "202304", "202305", "202306")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>移网>>【产品及计费使用】账单>>账详单内容不清晰/看不懂",
                                     "投诉工单（2021版）>>移网>>【产品及计费使用】账单>>内容有误/查询结果不一致",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】账单>>账详单内容不清晰/看不懂",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】账单>>内容有误/查询结果不一致",
                                     "投诉工单（2021版）>>宽带>>【产品及计费使用】账单>>账详单内容不清晰/看不懂",
                                     "投诉工单（2021版）>>宽带>>【产品及计费使用】账单>>内容有误/查询结果不一致")
              and sheet_status not in ("8", "11")) a
               left join dc_dim.dim_pro_city_regoin b on a.compl_area = b.code_value
      group by b.prov_code, b.prov_name) a
         left join (select substr(prov_id, 2, 3) pro_id, prov_name, cast(sum(kpi_value) as bigint) n
                    from dc_dwd_cbss.dwd_m_user_info
                    where month_id in
                          ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                           "202303", "202304", "202305", "202306")
                      and kpi_code in ("CKP_66829", "CKP_11453")
                      and prov_id != "-1"
                    group by prov_id, prov_name) b on a.prov_code = b.pro_id and a.prov_name = b.prov_name
where a.prov_name is not null
  and b.prov_name is not null;
-- union all
select "FWBZ110"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "09"                                                                                  index_level_3_id,
       "消费服务"                                                                            index_level_3_name,
       "20"                                                                                  index_level_4_id,
       "账单服务"                                                                            index_level_4_name,
       "账单内容投诉率"                                                                      index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202210", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.397件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.397, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202210")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>移网>>【产品及计费使用】账单>>账详单内容不清晰/看不懂",
                                     "投诉工单（2021版）>>移网>>【产品及计费使用】账单>>内容有误/查询结果不一致",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】账单>>账详单内容不清晰/看不懂",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】账单>>内容有误/查询结果不一致",
                                     "投诉工单（2021版）>>宽带>>【产品及计费使用】账单>>账详单内容不清晰/看不懂",
                                     "投诉工单（2021版）>>宽带>>【产品及计费使用】账单>>内容有误/查询结果不一致")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202210")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ110"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "09"                                                                                  index_level_3_id,
       "消费服务"                                                                            index_level_3_name,
       "20"                                                                                  index_level_4_id,
       "账单服务"                                                                            index_level_4_name,
       "账单内容投诉率"                                                                      index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202211", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.397件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.397, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202211")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>移网>>【产品及计费使用】账单>>账详单内容不清晰/看不懂",
                                     "投诉工单（2021版）>>移网>>【产品及计费使用】账单>>内容有误/查询结果不一致",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】账单>>账详单内容不清晰/看不懂",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】账单>>内容有误/查询结果不一致",
                                     "投诉工单（2021版）>>宽带>>【产品及计费使用】账单>>账详单内容不清晰/看不懂",
                                     "投诉工单（2021版）>>宽带>>【产品及计费使用】账单>>内容有误/查询结果不一致")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202211")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ110"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "09"                                                                                  index_level_3_id,
       "消费服务"                                                                            index_level_3_name,
       "20"                                                                                  index_level_4_id,
       "账单服务"                                                                            index_level_4_name,
       "账单内容投诉率"                                                                      index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202212", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.397件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.397, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202212")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>移网>>【产品及计费使用】账单>>账详单内容不清晰/看不懂",
                                     "投诉工单（2021版）>>移网>>【产品及计费使用】账单>>内容有误/查询结果不一致",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】账单>>账详单内容不清晰/看不懂",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】账单>>内容有误/查询结果不一致",
                                     "投诉工单（2021版）>>宽带>>【产品及计费使用】账单>>账详单内容不清晰/看不懂",
                                     "投诉工单（2021版）>>宽带>>【产品及计费使用】账单>>内容有误/查询结果不一致")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202212")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ110"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "09"                                                                                  index_level_3_id,
       "消费服务"                                                                            index_level_3_name,
       "20"                                                                                  index_level_4_id,
       "账单服务"                                                                            index_level_4_name,
       "账单内容投诉率"                                                                      index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202301", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.397件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.397, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202301")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>移网>>【产品及计费使用】账单>>账详单内容不清晰/看不懂",
                                     "投诉工单（2021版）>>移网>>【产品及计费使用】账单>>内容有误/查询结果不一致",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】账单>>账详单内容不清晰/看不懂",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】账单>>内容有误/查询结果不一致",
                                     "投诉工单（2021版）>>宽带>>【产品及计费使用】账单>>账详单内容不清晰/看不懂",
                                     "投诉工单（2021版）>>宽带>>【产品及计费使用】账单>>内容有误/查询结果不一致")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202301")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ110"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "09"                                                                                  index_level_3_id,
       "消费服务"                                                                            index_level_3_name,
       "20"                                                                                  index_level_4_id,
       "账单服务"                                                                            index_level_4_name,
       "账单内容投诉率"                                                                      index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202302", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.397件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.397, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202302")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>移网>>【产品及计费使用】账单>>账详单内容不清晰/看不懂",
                                     "投诉工单（2021版）>>移网>>【产品及计费使用】账单>>内容有误/查询结果不一致",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】账单>>账详单内容不清晰/看不懂",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】账单>>内容有误/查询结果不一致",
                                     "投诉工单（2021版）>>宽带>>【产品及计费使用】账单>>账详单内容不清晰/看不懂",
                                     "投诉工单（2021版）>>宽带>>【产品及计费使用】账单>>内容有误/查询结果不一致")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202302")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ110"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "09"                                                                                  index_level_3_id,
       "消费服务"                                                                            index_level_3_name,
       "20"                                                                                  index_level_4_id,
       "账单服务"                                                                            index_level_4_name,
       "账单内容投诉率"                                                                      index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202303", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.397件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.397, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202303")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>移网>>【产品及计费使用】账单>>账详单内容不清晰/看不懂",
                                     "投诉工单（2021版）>>移网>>【产品及计费使用】账单>>内容有误/查询结果不一致",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】账单>>账详单内容不清晰/看不懂",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】账单>>内容有误/查询结果不一致",
                                     "投诉工单（2021版）>>宽带>>【产品及计费使用】账单>>账详单内容不清晰/看不懂",
                                     "投诉工单（2021版）>>宽带>>【产品及计费使用】账单>>内容有误/查询结果不一致")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202303")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ110"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "09"                                                                                  index_level_3_id,
       "消费服务"                                                                            index_level_3_name,
       "20"                                                                                  index_level_4_id,
       "账单服务"                                                                            index_level_4_name,
       "账单内容投诉率"                                                                      index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202304", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.397件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.397, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202304")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>移网>>【产品及计费使用】账单>>账详单内容不清晰/看不懂",
                                     "投诉工单（2021版）>>移网>>【产品及计费使用】账单>>内容有误/查询结果不一致",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】账单>>账详单内容不清晰/看不懂",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】账单>>内容有误/查询结果不一致",
                                     "投诉工单（2021版）>>宽带>>【产品及计费使用】账单>>账详单内容不清晰/看不懂",
                                     "投诉工单（2021版）>>宽带>>【产品及计费使用】账单>>内容有误/查询结果不一致")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202304")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ110"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "09"                                                                                  index_level_3_id,
       "消费服务"                                                                            index_level_3_name,
       "20"                                                                                  index_level_4_id,
       "账单服务"                                                                            index_level_4_name,
       "账单内容投诉率"                                                                      index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202305", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.397件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.397, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202305")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>移网>>【产品及计费使用】账单>>账详单内容不清晰/看不懂",
                                     "投诉工单（2021版）>>移网>>【产品及计费使用】账单>>内容有误/查询结果不一致",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】账单>>账详单内容不清晰/看不懂",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】账单>>内容有误/查询结果不一致",
                                     "投诉工单（2021版）>>宽带>>【产品及计费使用】账单>>账详单内容不清晰/看不懂",
                                     "投诉工单（2021版）>>宽带>>【产品及计费使用】账单>>内容有误/查询结果不一致")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202305")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ110"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "09"                                                                                  index_level_3_id,
       "消费服务"                                                                            index_level_3_name,
       "20"                                                                                  index_level_4_id,
       "账单服务"                                                                            index_level_4_name,
       "账单内容投诉率"                                                                      index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202306", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.397件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.397, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202306")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>移网>>【产品及计费使用】账单>>账详单内容不清晰/看不懂",
                                     "投诉工单（2021版）>>移网>>【产品及计费使用】账单>>内容有误/查询结果不一致",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】账单>>账详单内容不清晰/看不懂",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】账单>>内容有误/查询结果不一致",
                                     "投诉工单（2021版）>>宽带>>【产品及计费使用】账单>>账详单内容不清晰/看不懂",
                                     "投诉工单（2021版）>>宽带>>【产品及计费使用】账单>>内容有误/查询结果不一致")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202306")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ110"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "09"                                                                                  index_level_3_id,
       "消费服务"                                                                            index_level_3_name,
       "20"                                                                                  index_level_4_id,
       "账单服务"                                                                            index_level_4_name,
       "账单内容投诉率"                                                                      index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202307", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.397件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.397, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202307")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>移网>>【产品及计费使用】账单>>账详单内容不清晰/看不懂",
                                     "投诉工单（2021版）>>移网>>【产品及计费使用】账单>>内容有误/查询结果不一致",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】账单>>账详单内容不清晰/看不懂",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】账单>>内容有误/查询结果不一致",
                                     "投诉工单（2021版）>>宽带>>【产品及计费使用】账单>>账详单内容不清晰/看不懂",
                                     "投诉工单（2021版）>>宽带>>【产品及计费使用】账单>>内容有误/查询结果不一致")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202307")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ110"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "09"                                                                                  index_level_3_id,
       "消费服务"                                                                            index_level_3_name,
       "20"                                                                                  index_level_4_id,
       "账单服务"                                                                            index_level_4_name,
       "账单内容投诉率"                                                                      index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202308", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.397件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.397, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202308")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>移网>>【产品及计费使用】账单>>账详单内容不清晰/看不懂",
                                     "投诉工单（2021版）>>移网>>【产品及计费使用】账单>>内容有误/查询结果不一致",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】账单>>账详单内容不清晰/看不懂",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】账单>>内容有误/查询结果不一致",
                                     "投诉工单（2021版）>>宽带>>【产品及计费使用】账单>>账详单内容不清晰/看不懂",
                                     "投诉工单（2021版）>>宽带>>【产品及计费使用】账单>>内容有误/查询结果不一致")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202308")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ110"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "09"                                                                                  index_level_3_id,
       "消费服务"                                                                            index_level_3_name,
       "20"                                                                                  index_level_4_id,
       "账单服务"                                                                            index_level_4_name,
       "账单内容投诉率"                                                                      index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202309", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.397件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.397, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202309")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>移网>>【产品及计费使用】账单>>账详单内容不清晰/看不懂",
                                     "投诉工单（2021版）>>移网>>【产品及计费使用】账单>>内容有误/查询结果不一致",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】账单>>账详单内容不清晰/看不懂",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】账单>>内容有误/查询结果不一致",
                                     "投诉工单（2021版）>>宽带>>【产品及计费使用】账单>>账详单内容不清晰/看不懂",
                                     "投诉工单（2021版）>>宽带>>【产品及计费使用】账单>>内容有误/查询结果不一致")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202309")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
;

-- todo 17 账单查询及获取投诉率 74 完成
select "FWBZ111"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "09"                                                                                  index_level_3_id,
       "消费服务"                                                                            index_level_3_name,
       "20"                                                                                  index_level_4_id,
       "账单服务"                                                                            index_level_4_name,
       "账单查询及获取投诉率"                                                                index_name,
       a.prov_code                                                                           pro_id,
       a.prov_name                                                                           pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202212", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.039件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.039, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_level,
       "GJ"                                                                                  index_level_code
from (select b.prov_code prov_code, b.prov_name prov_name, count(1) n
      from (select sheet_id, compl_area
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                   "202303", "202304", "202305", "202306")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>移网>>【产品及计费使用】账单>>账单信息告知不及时/未收到",
                                     "投诉工单（2021版）>>移网>>【产品及计费使用】账单>>对出账期无法查询账详单不满",
                                     "投诉工单（2021版）>>移网>>【产品及计费使用】账单>>获取不便捷/不成功",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】账单>>账单信息告知不及时/未收到",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】账单>>对出账期无法查询账详单不满",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】账单>>获取不便捷/不成功",
                                     "投诉工单（2021版）>>宽带>>【产品及计费使用】账单>>账单信息告知不及时/未收到")
              and sheet_status not in ("8", "11")) a
               left join dc_dim.dim_pro_city_regoin b on a.compl_area = b.code_value
      group by b.prov_code, b.prov_name) a
         left join (select substr(prov_id, 2, 3) pro_id, prov_name, cast(sum(kpi_value) as bigint) n
                    from dc_dwd_cbss.dwd_m_user_info
                    where month_id in
                          ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                           "202303", "202304", "202305", "202306")
                      and kpi_code in ("CKP_66829", "CKP_11453")
                      and prov_id != "-1"
                    group by prov_id, prov_name) b on a.prov_code = b.pro_id and a.prov_name = b.prov_name
where a.prov_name is not null
  and b.prov_name is not null;
-- union all
select "FWBZ111"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "09"                                                                                  index_level_3_id,
       "消费服务"                                                                            index_level_3_name,
       "20"                                                                                  index_level_4_id,
       "账单服务"                                                                            index_level_4_name,
       "账单查询及获取投诉率"                                                                index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202210", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.039件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.039, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202210")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>移网>>【产品及计费使用】账单>>账单信息告知不及时/未收到",
                                     "投诉工单（2021版）>>移网>>【产品及计费使用】账单>>对出账期无法查询账详单不满",
                                     "投诉工单（2021版）>>移网>>【产品及计费使用】账单>>获取不便捷/不成功",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】账单>>账单信息告知不及时/未收到",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】账单>>对出账期无法查询账详单不满",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】账单>>获取不便捷/不成功",
                                     "投诉工单（2021版）>>宽带>>【产品及计费使用】账单>>账单信息告知不及时/未收到")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202210")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ111"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "09"                                                                                  index_level_3_id,
       "消费服务"                                                                            index_level_3_name,
       "20"                                                                                  index_level_4_id,
       "账单服务"                                                                            index_level_4_name,
       "账单查询及获取投诉率"                                                                index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202211", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.039件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.039, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202211")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>移网>>【产品及计费使用】账单>>账单信息告知不及时/未收到",
                                     "投诉工单（2021版）>>移网>>【产品及计费使用】账单>>对出账期无法查询账详单不满",
                                     "投诉工单（2021版）>>移网>>【产品及计费使用】账单>>获取不便捷/不成功",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】账单>>账单信息告知不及时/未收到",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】账单>>对出账期无法查询账详单不满",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】账单>>获取不便捷/不成功",
                                     "投诉工单（2021版）>>宽带>>【产品及计费使用】账单>>账单信息告知不及时/未收到")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202211")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ111"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "09"                                                                                  index_level_3_id,
       "消费服务"                                                                            index_level_3_name,
       "20"                                                                                  index_level_4_id,
       "账单服务"                                                                            index_level_4_name,
       "账单查询及获取投诉率"                                                                index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202212", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.039件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.039, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202212")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>移网>>【产品及计费使用】账单>>账单信息告知不及时/未收到",
                                     "投诉工单（2021版）>>移网>>【产品及计费使用】账单>>对出账期无法查询账详单不满",
                                     "投诉工单（2021版）>>移网>>【产品及计费使用】账单>>获取不便捷/不成功",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】账单>>账单信息告知不及时/未收到",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】账单>>对出账期无法查询账详单不满",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】账单>>获取不便捷/不成功",
                                     "投诉工单（2021版）>>宽带>>【产品及计费使用】账单>>账单信息告知不及时/未收到")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202212")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ111"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "09"                                                                                  index_level_3_id,
       "消费服务"                                                                            index_level_3_name,
       "20"                                                                                  index_level_4_id,
       "账单服务"                                                                            index_level_4_name,
       "账单查询及获取投诉率"                                                                index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202301", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.039件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.039, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202301")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>移网>>【产品及计费使用】账单>>账单信息告知不及时/未收到",
                                     "投诉工单（2021版）>>移网>>【产品及计费使用】账单>>对出账期无法查询账详单不满",
                                     "投诉工单（2021版）>>移网>>【产品及计费使用】账单>>获取不便捷/不成功",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】账单>>账单信息告知不及时/未收到",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】账单>>对出账期无法查询账详单不满",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】账单>>获取不便捷/不成功",
                                     "投诉工单（2021版）>>宽带>>【产品及计费使用】账单>>账单信息告知不及时/未收到")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202301")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ111"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "09"                                                                                  index_level_3_id,
       "消费服务"                                                                            index_level_3_name,
       "20"                                                                                  index_level_4_id,
       "账单服务"                                                                            index_level_4_name,
       "账单查询及获取投诉率"                                                                index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202302", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.039件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.039, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202302")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>移网>>【产品及计费使用】账单>>账单信息告知不及时/未收到",
                                     "投诉工单（2021版）>>移网>>【产品及计费使用】账单>>对出账期无法查询账详单不满",
                                     "投诉工单（2021版）>>移网>>【产品及计费使用】账单>>获取不便捷/不成功",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】账单>>账单信息告知不及时/未收到",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】账单>>对出账期无法查询账详单不满",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】账单>>获取不便捷/不成功",
                                     "投诉工单（2021版）>>宽带>>【产品及计费使用】账单>>账单信息告知不及时/未收到")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202302")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ111"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "09"                                                                                  index_level_3_id,
       "消费服务"                                                                            index_level_3_name,
       "20"                                                                                  index_level_4_id,
       "账单服务"                                                                            index_level_4_name,
       "账单查询及获取投诉率"                                                                index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202303", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.039件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.039, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202303")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>移网>>【产品及计费使用】账单>>账单信息告知不及时/未收到",
                                     "投诉工单（2021版）>>移网>>【产品及计费使用】账单>>对出账期无法查询账详单不满",
                                     "投诉工单（2021版）>>移网>>【产品及计费使用】账单>>获取不便捷/不成功",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】账单>>账单信息告知不及时/未收到",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】账单>>对出账期无法查询账详单不满",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】账单>>获取不便捷/不成功",
                                     "投诉工单（2021版）>>宽带>>【产品及计费使用】账单>>账单信息告知不及时/未收到")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202303")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ111"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "09"                                                                                  index_level_3_id,
       "消费服务"                                                                            index_level_3_name,
       "20"                                                                                  index_level_4_id,
       "账单服务"                                                                            index_level_4_name,
       "账单查询及获取投诉率"                                                                index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202304", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.039件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.039, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202304")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>移网>>【产品及计费使用】账单>>账单信息告知不及时/未收到",
                                     "投诉工单（2021版）>>移网>>【产品及计费使用】账单>>对出账期无法查询账详单不满",
                                     "投诉工单（2021版）>>移网>>【产品及计费使用】账单>>获取不便捷/不成功",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】账单>>账单信息告知不及时/未收到",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】账单>>对出账期无法查询账详单不满",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】账单>>获取不便捷/不成功",
                                     "投诉工单（2021版）>>宽带>>【产品及计费使用】账单>>账单信息告知不及时/未收到")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202304")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ111"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "09"                                                                                  index_level_3_id,
       "消费服务"                                                                            index_level_3_name,
       "20"                                                                                  index_level_4_id,
       "账单服务"                                                                            index_level_4_name,
       "账单查询及获取投诉率"                                                                index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202305", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.039件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.039, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202305")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>移网>>【产品及计费使用】账单>>账单信息告知不及时/未收到",
                                     "投诉工单（2021版）>>移网>>【产品及计费使用】账单>>对出账期无法查询账详单不满",
                                     "投诉工单（2021版）>>移网>>【产品及计费使用】账单>>获取不便捷/不成功",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】账单>>账单信息告知不及时/未收到",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】账单>>对出账期无法查询账详单不满",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】账单>>获取不便捷/不成功",
                                     "投诉工单（2021版）>>宽带>>【产品及计费使用】账单>>账单信息告知不及时/未收到")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202305")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ111"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "09"                                                                                  index_level_3_id,
       "消费服务"                                                                            index_level_3_name,
       "20"                                                                                  index_level_4_id,
       "账单服务"                                                                            index_level_4_name,
       "账单查询及获取投诉率"                                                                index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202306", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.039件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.039, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202306")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>移网>>【产品及计费使用】账单>>账单信息告知不及时/未收到",
                                     "投诉工单（2021版）>>移网>>【产品及计费使用】账单>>对出账期无法查询账详单不满",
                                     "投诉工单（2021版）>>移网>>【产品及计费使用】账单>>获取不便捷/不成功",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】账单>>账单信息告知不及时/未收到",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】账单>>对出账期无法查询账详单不满",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】账单>>获取不便捷/不成功",
                                     "投诉工单（2021版）>>宽带>>【产品及计费使用】账单>>账单信息告知不及时/未收到")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202306")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ111"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "09"                                                                                  index_level_3_id,
       "消费服务"                                                                            index_level_3_name,
       "20"                                                                                  index_level_4_id,
       "账单服务"                                                                            index_level_4_name,
       "账单查询及获取投诉率"                                                                index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202307", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.039件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.039, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202307")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>移网>>【产品及计费使用】账单>>账单信息告知不及时/未收到",
                                     "投诉工单（2021版）>>移网>>【产品及计费使用】账单>>对出账期无法查询账详单不满",
                                     "投诉工单（2021版）>>移网>>【产品及计费使用】账单>>获取不便捷/不成功",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】账单>>账单信息告知不及时/未收到",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】账单>>对出账期无法查询账详单不满",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】账单>>获取不便捷/不成功",
                                     "投诉工单（2021版）>>宽带>>【产品及计费使用】账单>>账单信息告知不及时/未收到")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202307")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ111"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "09"                                                                                  index_level_3_id,
       "消费服务"                                                                            index_level_3_name,
       "20"                                                                                  index_level_4_id,
       "账单服务"                                                                            index_level_4_name,
       "账单查询及获取投诉率"                                                                index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202308", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.039件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.039, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202308")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>移网>>【产品及计费使用】账单>>账单信息告知不及时/未收到",
                                     "投诉工单（2021版）>>移网>>【产品及计费使用】账单>>对出账期无法查询账详单不满",
                                     "投诉工单（2021版）>>移网>>【产品及计费使用】账单>>获取不便捷/不成功",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】账单>>账单信息告知不及时/未收到",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】账单>>对出账期无法查询账详单不满",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】账单>>获取不便捷/不成功",
                                     "投诉工单（2021版）>>宽带>>【产品及计费使用】账单>>账单信息告知不及时/未收到")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202308")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ111"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "05"                                                                                  index_level_2_id,
       "业务服务"                                                                            index_level_2_name,
       "09"                                                                                  index_level_3_id,
       "消费服务"                                                                            index_level_3_name,
       "20"                                                                                  index_level_4_id,
       "账单服务"                                                                            index_level_4_name,
       "账单查询及获取投诉率"                                                                index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202309", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.039件/万户"                                                                       target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.039, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202309")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in ("投诉工单（2021版）>>移网>>【产品及计费使用】账单>>账单信息告知不及时/未收到",
                                     "投诉工单（2021版）>>移网>>【产品及计费使用】账单>>对出账期无法查询账详单不满",
                                     "投诉工单（2021版）>>移网>>【产品及计费使用】账单>>获取不便捷/不成功",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】账单>>账单信息告知不及时/未收到",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】账单>>对出账期无法查询账详单不满",
                                     "投诉工单（2021版）>>融合>>【产品及计费使用】账单>>获取不便捷/不成功",
                                     "投诉工单（2021版）>>宽带>>【产品及计费使用】账单>>账单信息告知不及时/未收到")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202309")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
;

-- todo 18 安全风险投诉率 87 完成
select "FWBZ157"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "06"                                                                                  index_level_2_id,
       "关爱服务"                                                                            index_level_2_name,
       "20"                                                                                  index_level_3_id,
       "安全服务"                                                                            index_level_3_name,
       "25"                                                                                  index_level_4_id,
       "安全服务"                                                                            index_level_4_name,
       "高品质服务2.0安全风险投诉率"                                                         index_name,
       a.prov_code                                                                           pro_id,
       a.prov_name                                                                           pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202212", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.51件/万户"                                                                        target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.51, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_level,
       "GJ"                                                                                  index_level_code
from (select b.prov_code prov_code, b.prov_name prov_name, count(1) n
      from (select sheet_id, compl_area
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                   "202303", "202304", "202305", "202306")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in
                  ("投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇通信骚扰、电信诈骗与电话非法改号",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇用户信息盗用冒用问题",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇号码被他人补卡过户、用户信息泄露问题",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇其他信息安全问题",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇电子交易诈骗、用户密码泄露等网络安全问题",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇非法使用用户信息、捆绑安装应用等APP安全问题",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇通信骚扰、电信诈骗与电话非法改号",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇用户信息盗用冒用问题",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇号码被他人补卡过户、用户信息泄露问题",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇其他信息安全问题",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇电子交易诈骗、用户密码泄露等网络安全问题",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇非法使用用户信息、捆绑安装应用等APP安全问题",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】产品及业务规则>>遭遇用户信息盗用冒用问题",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】产品及业务规则>>遭遇其他信息安全问题")
              and sheet_status not in ("8", "11")) a
               left join dc_dim.dim_pro_city_regoin b on a.compl_area = b.code_value
      group by b.prov_code, b.prov_name) a
         left join (select substr(prov_id, 2, 3) pro_id, prov_name, cast(sum(kpi_value) as bigint) n
                    from dc_dwd_cbss.dwd_m_user_info
                    where month_id in
                          ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                           "202303", "202304", "202305", "202306")
                      and kpi_code in ("CKP_66829", "CKP_11453")
                      and prov_id != "-1"
                    group by prov_id, prov_name) b on a.prov_code = b.pro_id and a.prov_name = b.prov_name
where a.prov_name is not null
  and b.prov_name is not null;
-- union all
select "FWBZ157"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "06"                                                                                  index_level_2_id,
       "关爱服务"                                                                            index_level_2_name,
       "20"                                                                                  index_level_3_id,
       "安全服务"                                                                            index_level_3_name,
       "25"                                                                                  index_level_4_id,
       "安全服务"                                                                            index_level_4_name,
       "高品质服务2.0安全风险投诉率"                                                         index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202210", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.51件/万户"                                                                        target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.51, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202210")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in
                  ("投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇通信骚扰、电信诈骗与电话非法改号",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇用户信息盗用冒用问题",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇号码被他人补卡过户、用户信息泄露问题",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇其他信息安全问题",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇电子交易诈骗、用户密码泄露等网络安全问题",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇非法使用用户信息、捆绑安装应用等APP安全问题",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇通信骚扰、电信诈骗与电话非法改号",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇用户信息盗用冒用问题",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇号码被他人补卡过户、用户信息泄露问题",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇其他信息安全问题",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇电子交易诈骗、用户密码泄露等网络安全问题",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇非法使用用户信息、捆绑安装应用等APP安全问题",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】产品及业务规则>>遭遇用户信息盗用冒用问题",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】产品及业务规则>>遭遇其他信息安全问题")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202210")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ157"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "06"                                                                                  index_level_2_id,
       "关爱服务"                                                                            index_level_2_name,
       "20"                                                                                  index_level_3_id,
       "安全服务"                                                                            index_level_3_name,
       "25"                                                                                  index_level_4_id,
       "安全服务"                                                                            index_level_4_name,
       "高品质服务2.0安全风险投诉率"                                                         index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202211", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.51件/万户"                                                                        target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.51, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202211")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in
                  ("投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇通信骚扰、电信诈骗与电话非法改号",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇用户信息盗用冒用问题",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇号码被他人补卡过户、用户信息泄露问题",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇其他信息安全问题",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇电子交易诈骗、用户密码泄露等网络安全问题",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇非法使用用户信息、捆绑安装应用等APP安全问题",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇通信骚扰、电信诈骗与电话非法改号",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇用户信息盗用冒用问题",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇号码被他人补卡过户、用户信息泄露问题",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇其他信息安全问题",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇电子交易诈骗、用户密码泄露等网络安全问题",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇非法使用用户信息、捆绑安装应用等APP安全问题",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】产品及业务规则>>遭遇用户信息盗用冒用问题",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】产品及业务规则>>遭遇其他信息安全问题")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202211")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ157"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "06"                                                                                  index_level_2_id,
       "关爱服务"                                                                            index_level_2_name,
       "20"                                                                                  index_level_3_id,
       "安全服务"                                                                            index_level_3_name,
       "25"                                                                                  index_level_4_id,
       "安全服务"                                                                            index_level_4_name,
       "高品质服务2.0安全风险投诉率"                                                         index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202212", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.51件/万户"                                                                        target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.51, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202212")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in
                  ("投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇通信骚扰、电信诈骗与电话非法改号",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇用户信息盗用冒用问题",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇号码被他人补卡过户、用户信息泄露问题",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇其他信息安全问题",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇电子交易诈骗、用户密码泄露等网络安全问题",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇非法使用用户信息、捆绑安装应用等APP安全问题",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇通信骚扰、电信诈骗与电话非法改号",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇用户信息盗用冒用问题",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇号码被他人补卡过户、用户信息泄露问题",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇其他信息安全问题",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇电子交易诈骗、用户密码泄露等网络安全问题",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇非法使用用户信息、捆绑安装应用等APP安全问题",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】产品及业务规则>>遭遇用户信息盗用冒用问题",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】产品及业务规则>>遭遇其他信息安全问题")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202212")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ157"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "06"                                                                                  index_level_2_id,
       "关爱服务"                                                                            index_level_2_name,
       "20"                                                                                  index_level_3_id,
       "安全服务"                                                                            index_level_3_name,
       "25"                                                                                  index_level_4_id,
       "安全服务"                                                                            index_level_4_name,
       "高品质服务2.0安全风险投诉率"                                                         index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202301", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.51件/万户"                                                                        target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.51, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202301")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in
                  ("投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇通信骚扰、电信诈骗与电话非法改号",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇用户信息盗用冒用问题",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇号码被他人补卡过户、用户信息泄露问题",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇其他信息安全问题",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇电子交易诈骗、用户密码泄露等网络安全问题",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇非法使用用户信息、捆绑安装应用等APP安全问题",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇通信骚扰、电信诈骗与电话非法改号",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇用户信息盗用冒用问题",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇号码被他人补卡过户、用户信息泄露问题",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇其他信息安全问题",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇电子交易诈骗、用户密码泄露等网络安全问题",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇非法使用用户信息、捆绑安装应用等APP安全问题",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】产品及业务规则>>遭遇用户信息盗用冒用问题",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】产品及业务规则>>遭遇其他信息安全问题")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202301")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ157"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "06"                                                                                  index_level_2_id,
       "关爱服务"                                                                            index_level_2_name,
       "20"                                                                                  index_level_3_id,
       "安全服务"                                                                            index_level_3_name,
       "25"                                                                                  index_level_4_id,
       "安全服务"                                                                            index_level_4_name,
       "高品质服务2.0安全风险投诉率"                                                         index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202302", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.51件/万户"                                                                        target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.51, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202302")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in
                  ("投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇通信骚扰、电信诈骗与电话非法改号",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇用户信息盗用冒用问题",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇号码被他人补卡过户、用户信息泄露问题",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇其他信息安全问题",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇电子交易诈骗、用户密码泄露等网络安全问题",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇非法使用用户信息、捆绑安装应用等APP安全问题",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇通信骚扰、电信诈骗与电话非法改号",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇用户信息盗用冒用问题",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇号码被他人补卡过户、用户信息泄露问题",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇其他信息安全问题",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇电子交易诈骗、用户密码泄露等网络安全问题",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇非法使用用户信息、捆绑安装应用等APP安全问题",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】产品及业务规则>>遭遇用户信息盗用冒用问题",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】产品及业务规则>>遭遇其他信息安全问题")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202302")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ157"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "06"                                                                                  index_level_2_id,
       "关爱服务"                                                                            index_level_2_name,
       "20"                                                                                  index_level_3_id,
       "安全服务"                                                                            index_level_3_name,
       "25"                                                                                  index_level_4_id,
       "安全服务"                                                                            index_level_4_name,
       "高品质服务2.0安全风险投诉率"                                                         index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202303", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.51件/万户"                                                                        target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.51, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202303")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in
                  ("投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇通信骚扰、电信诈骗与电话非法改号",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇用户信息盗用冒用问题",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇号码被他人补卡过户、用户信息泄露问题",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇其他信息安全问题",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇电子交易诈骗、用户密码泄露等网络安全问题",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇非法使用用户信息、捆绑安装应用等APP安全问题",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇通信骚扰、电信诈骗与电话非法改号",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇用户信息盗用冒用问题",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇号码被他人补卡过户、用户信息泄露问题",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇其他信息安全问题",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇电子交易诈骗、用户密码泄露等网络安全问题",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇非法使用用户信息、捆绑安装应用等APP安全问题",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】产品及业务规则>>遭遇用户信息盗用冒用问题",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】产品及业务规则>>遭遇其他信息安全问题")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202303")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ157"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "06"                                                                                  index_level_2_id,
       "关爱服务"                                                                            index_level_2_name,
       "20"                                                                                  index_level_3_id,
       "安全服务"                                                                            index_level_3_name,
       "25"                                                                                  index_level_4_id,
       "安全服务"                                                                            index_level_4_name,
       "高品质服务2.0安全风险投诉率"                                                         index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202304", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.51件/万户"                                                                        target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.51, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202304")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in
                  ("投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇通信骚扰、电信诈骗与电话非法改号",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇用户信息盗用冒用问题",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇号码被他人补卡过户、用户信息泄露问题",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇其他信息安全问题",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇电子交易诈骗、用户密码泄露等网络安全问题",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇非法使用用户信息、捆绑安装应用等APP安全问题",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇通信骚扰、电信诈骗与电话非法改号",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇用户信息盗用冒用问题",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇号码被他人补卡过户、用户信息泄露问题",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇其他信息安全问题",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇电子交易诈骗、用户密码泄露等网络安全问题",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇非法使用用户信息、捆绑安装应用等APP安全问题",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】产品及业务规则>>遭遇用户信息盗用冒用问题",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】产品及业务规则>>遭遇其他信息安全问题")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202304")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ157"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "06"                                                                                  index_level_2_id,
       "关爱服务"                                                                            index_level_2_name,
       "20"                                                                                  index_level_3_id,
       "安全服务"                                                                            index_level_3_name,
       "25"                                                                                  index_level_4_id,
       "安全服务"                                                                            index_level_4_name,
       "高品质服务2.0安全风险投诉率"                                                         index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202305", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.51件/万户"                                                                        target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.51, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202305")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in
                  ("投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇通信骚扰、电信诈骗与电话非法改号",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇用户信息盗用冒用问题",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇号码被他人补卡过户、用户信息泄露问题",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇其他信息安全问题",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇电子交易诈骗、用户密码泄露等网络安全问题",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇非法使用用户信息、捆绑安装应用等APP安全问题",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇通信骚扰、电信诈骗与电话非法改号",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇用户信息盗用冒用问题",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇号码被他人补卡过户、用户信息泄露问题",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇其他信息安全问题",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇电子交易诈骗、用户密码泄露等网络安全问题",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇非法使用用户信息、捆绑安装应用等APP安全问题",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】产品及业务规则>>遭遇用户信息盗用冒用问题",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】产品及业务规则>>遭遇其他信息安全问题")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202305")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ157"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "06"                                                                                  index_level_2_id,
       "关爱服务"                                                                            index_level_2_name,
       "20"                                                                                  index_level_3_id,
       "安全服务"                                                                            index_level_3_name,
       "25"                                                                                  index_level_4_id,
       "安全服务"                                                                            index_level_4_name,
       "高品质服务2.0安全风险投诉率"                                                         index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202306", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.51件/万户"                                                                        target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.51, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202306")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in
                  ("投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇通信骚扰、电信诈骗与电话非法改号",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇用户信息盗用冒用问题",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇号码被他人补卡过户、用户信息泄露问题",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇其他信息安全问题",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇电子交易诈骗、用户密码泄露等网络安全问题",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇非法使用用户信息、捆绑安装应用等APP安全问题",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇通信骚扰、电信诈骗与电话非法改号",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇用户信息盗用冒用问题",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇号码被他人补卡过户、用户信息泄露问题",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇其他信息安全问题",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇电子交易诈骗、用户密码泄露等网络安全问题",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇非法使用用户信息、捆绑安装应用等APP安全问题",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】产品及业务规则>>遭遇用户信息盗用冒用问题",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】产品及业务规则>>遭遇其他信息安全问题")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202306")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ157"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "06"                                                                                  index_level_2_id,
       "关爱服务"                                                                            index_level_2_name,
       "20"                                                                                  index_level_3_id,
       "安全服务"                                                                            index_level_3_name,
       "25"                                                                                  index_level_4_id,
       "安全服务"                                                                            index_level_4_name,
       "高品质服务2.0安全风险投诉率"                                                         index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202307", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.51件/万户"                                                                        target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.51, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202307")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in
                  ("投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇通信骚扰、电信诈骗与电话非法改号",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇用户信息盗用冒用问题",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇号码被他人补卡过户、用户信息泄露问题",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇其他信息安全问题",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇电子交易诈骗、用户密码泄露等网络安全问题",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇非法使用用户信息、捆绑安装应用等APP安全问题",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇通信骚扰、电信诈骗与电话非法改号",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇用户信息盗用冒用问题",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇号码被他人补卡过户、用户信息泄露问题",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇其他信息安全问题",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇电子交易诈骗、用户密码泄露等网络安全问题",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇非法使用用户信息、捆绑安装应用等APP安全问题",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】产品及业务规则>>遭遇用户信息盗用冒用问题",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】产品及业务规则>>遭遇其他信息安全问题")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202307")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ157"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "06"                                                                                  index_level_2_id,
       "关爱服务"                                                                            index_level_2_name,
       "20"                                                                                  index_level_3_id,
       "安全服务"                                                                            index_level_3_name,
       "25"                                                                                  index_level_4_id,
       "安全服务"                                                                            index_level_4_name,
       "高品质服务2.0安全风险投诉率"                                                         index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202308", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.51件/万户"                                                                        target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.51, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202308")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in
                  ("投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇通信骚扰、电信诈骗与电话非法改号",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇用户信息盗用冒用问题",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇号码被他人补卡过户、用户信息泄露问题",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇其他信息安全问题",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇电子交易诈骗、用户密码泄露等网络安全问题",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇非法使用用户信息、捆绑安装应用等APP安全问题",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇通信骚扰、电信诈骗与电话非法改号",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇用户信息盗用冒用问题",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇号码被他人补卡过户、用户信息泄露问题",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇其他信息安全问题",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇电子交易诈骗、用户密码泄露等网络安全问题",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇非法使用用户信息、捆绑安装应用等APP安全问题",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】产品及业务规则>>遭遇用户信息盗用冒用问题",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】产品及业务规则>>遭遇其他信息安全问题")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202308")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
union all
select "FWBZ157"                                                                             index_code,
       "ZY_"                                                                                 index_type,
       "GZ"                                                                                  index_level_1_id,
       "公众客户"                                                                            index_level_1_name,
       "06"                                                                                  index_level_2_id,
       "关爱服务"                                                                            index_level_2_name,
       "20"                                                                                  index_level_3_id,
       "安全服务"                                                                            index_level_3_name,
       "25"                                                                                  index_level_4_id,
       "安全服务"                                                                            index_level_4_name,
       "高品质服务2.0安全风险投诉率"                                                         index_name,
       "00"                                                                                  pro_id,
       "全国"                                                                                pro_name,
       "00"                                                                                  city_id,
       "全省"                                                                                city_name,
       substr("202309", 1, 6)                                                                month_id,
       ""                                                                                    day_id,
       "2"                                                                                   date_type,
       "<0.51件/万户"                                                                        target_value,
       if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) index_value,
       ""                                                                                    index_value_type,
       b.n                                                                                   index_value_denominator,
       a.n                                                                                   index_value_numerator,
       ""                                                                                    day_relative_ratio,
       ""                                                                                    month_relative_ratio,
       if(if(round(a.n / round(b.n / 10000), 4) is null, 0, round(a.n / round(b.n / 10000), 4)) < 0.51, "是",
          "否")                                                                              reach_standard,
       b.n                                                                                   refer_count,
       ""                                                                                    refer_count_10,
       ""                                                                                    refer_count_9,
       ""                                                                                    refer_count_8,
       ""                                                                                    refer_count_7,
       ""                                                                                    refer_count_6,
       ""                                                                                    refer_count_5,
       ""                                                                                    refer_count_4,
       ""                                                                                    refer_count_3,
       ""                                                                                    refer_count_2,
       ""                                                                                    refer_count_1,
       "关键"                                                                                index_value,
       "GJ"                                                                                  index_value_code
from (select count(1) n
      from (select sheet_id
            from dc_dwa.dwa_d_sheet_main_history_ex
            where month_id in
                  ("202309")
              and is_delete = "0"
              and (pro_id not in ("S1", "S2", "N1", "N2") or
                   (pro_id in ("S1", "S2", "N1", "N2") and catalog_path regexp "[0-9][0-9]?" = true and
                    nvl(rc_sheet_code, "") = ""))
              and serv_type_name in
                  ("投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇通信骚扰、电信诈骗与电话非法改号",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇用户信息盗用冒用问题",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇号码被他人补卡过户、用户信息泄露问题",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇其他信息安全问题",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇电子交易诈骗、用户密码泄露等网络安全问题",
                   "投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>遭遇非法使用用户信息、捆绑安装应用等APP安全问题",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇通信骚扰、电信诈骗与电话非法改号",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇用户信息盗用冒用问题",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇号码被他人补卡过户、用户信息泄露问题",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇其他信息安全问题",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇电子交易诈骗、用户密码泄露等网络安全问题",
                   "投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>遭遇非法使用用户信息、捆绑安装应用等APP安全问题",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】产品及业务规则>>遭遇用户信息盗用冒用问题",
                   "投诉工单（2021版）>>宽带>>【产品及计费使用】产品及业务规则>>遭遇其他信息安全问题")
              and sheet_status not in ("8", "11")) a) a
         join (select cast(sum(kpi_value) as bigint) n
               from dc_dwd_cbss.dwd_m_user_info
               where month_id in
                     ("202309")
                 and kpi_code in ("CKP_66829", "CKP_11453")
                 and prov_id = "111") b
;

-- todo 19 移网无覆盖投诉率 97 完成
select b.pro_id                                                                    pro_id,
       b.prov_name                                                                 pro_name,
       '00'                                                                        city_id,
       '全省'                                                                      city_name,
       '移网无覆盖投诉率'                                                          index_name,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select a.prov_name,
             a.prov_code,
             if(a.n is null, 0, a.n) n
      from (select b.prov_code prov_code,
                   b.prov_name prov_name,
                   count(1)    n
            from (select sheet_id,
                         compl_area
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                         "202303", "202304", "202305", "202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>移网>>【网络使用】移网上网>>无法上网/无覆盖',
                          '投诉工单（2021版）>>移网>>【网络使用】移网上网>>突发故障',
                          '投诉工单（2021版）>>移网>>【网络使用】移网语音>>2G退网关闭2G网络/网络无覆盖',
                          '投诉工单（2021版）>>移网>>【网络使用】移网语音>>无信号',
                          '投诉工单（2021版）>>融合>>【网络使用】移网上网>>无法上网/无覆盖',
                          '投诉工单（2021版）>>融合>>【网络使用】移网上网>>突发故障',
                          '投诉工单（2021版）>>融合>>【网络使用】移网语音>>无信号'
                            )
                    and sheet_status not in ('8', '11')) a
                     left join dc_dim.dim_pro_city_regoin_cb b on
                a.compl_area = b.code_value
            group by b.prov_code,
                     b.prov_name) a) a
         right join (select substr(prov_id, 2, 3)          pro_id,
                            prov_name,
                            cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                            "202303", "202304", "202305", "202306")
                       and kpi_code in ('CKP_66829', '-')
                       and city_id != '-1'
                     group by prov_id,
                              prov_name) b on
            a.prov_code = b.pro_id
        and a.prov_name = b.prov_name
where b.prov_name is not null;
-- union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '移网无覆盖投诉率'                                                          index_name,
       '202210'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202210")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>移网>>【网络使用】移网上网>>无法上网/无覆盖',
                          '投诉工单（2021版）>>移网>>【网络使用】移网上网>>突发故障',
                          '投诉工单（2021版）>>移网>>【网络使用】移网语音>>2G退网关闭2G网络/网络无覆盖',
                          '投诉工单（2021版）>>移网>>【网络使用】移网语音>>无信号',
                          '投诉工单（2021版）>>融合>>【网络使用】移网上网>>无法上网/无覆盖',
                          '投诉工单（2021版）>>融合>>【网络使用】移网上网>>突发故障',
                          '投诉工单（2021版）>>融合>>【网络使用】移网语音>>无信号'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202210")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '移网无覆盖投诉率'                                                          index_name,
       '202211'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202211")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>移网>>【网络使用】移网上网>>无法上网/无覆盖',
                          '投诉工单（2021版）>>移网>>【网络使用】移网上网>>突发故障',
                          '投诉工单（2021版）>>移网>>【网络使用】移网语音>>2G退网关闭2G网络/网络无覆盖',
                          '投诉工单（2021版）>>移网>>【网络使用】移网语音>>无信号',
                          '投诉工单（2021版）>>融合>>【网络使用】移网上网>>无法上网/无覆盖',
                          '投诉工单（2021版）>>融合>>【网络使用】移网上网>>突发故障',
                          '投诉工单（2021版）>>融合>>【网络使用】移网语音>>无信号'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202211")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '移网无覆盖投诉率'                                                          index_name,
       '202212'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202212")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>移网>>【网络使用】移网上网>>无法上网/无覆盖',
                          '投诉工单（2021版）>>移网>>【网络使用】移网上网>>突发故障',
                          '投诉工单（2021版）>>移网>>【网络使用】移网语音>>2G退网关闭2G网络/网络无覆盖',
                          '投诉工单（2021版）>>移网>>【网络使用】移网语音>>无信号',
                          '投诉工单（2021版）>>融合>>【网络使用】移网上网>>无法上网/无覆盖',
                          '投诉工单（2021版）>>融合>>【网络使用】移网上网>>突发故障',
                          '投诉工单（2021版）>>融合>>【网络使用】移网语音>>无信号'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202212")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '移网无覆盖投诉率'                                                          index_name,
       '202301'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202301")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>移网>>【网络使用】移网上网>>无法上网/无覆盖',
                          '投诉工单（2021版）>>移网>>【网络使用】移网上网>>突发故障',
                          '投诉工单（2021版）>>移网>>【网络使用】移网语音>>2G退网关闭2G网络/网络无覆盖',
                          '投诉工单（2021版）>>移网>>【网络使用】移网语音>>无信号',
                          '投诉工单（2021版）>>融合>>【网络使用】移网上网>>无法上网/无覆盖',
                          '投诉工单（2021版）>>融合>>【网络使用】移网上网>>突发故障',
                          '投诉工单（2021版）>>融合>>【网络使用】移网语音>>无信号'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202301")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '移网无覆盖投诉率'                                                          index_name,
       '202302'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202302")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>移网>>【网络使用】移网上网>>无法上网/无覆盖',
                          '投诉工单（2021版）>>移网>>【网络使用】移网上网>>突发故障',
                          '投诉工单（2021版）>>移网>>【网络使用】移网语音>>2G退网关闭2G网络/网络无覆盖',
                          '投诉工单（2021版）>>移网>>【网络使用】移网语音>>无信号',
                          '投诉工单（2021版）>>融合>>【网络使用】移网上网>>无法上网/无覆盖',
                          '投诉工单（2021版）>>融合>>【网络使用】移网上网>>突发故障',
                          '投诉工单（2021版）>>融合>>【网络使用】移网语音>>无信号'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202302")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '移网无覆盖投诉率'                                                          index_name,
       '202303'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202303")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>移网>>【网络使用】移网上网>>无法上网/无覆盖',
                          '投诉工单（2021版）>>移网>>【网络使用】移网上网>>突发故障',
                          '投诉工单（2021版）>>移网>>【网络使用】移网语音>>2G退网关闭2G网络/网络无覆盖',
                          '投诉工单（2021版）>>移网>>【网络使用】移网语音>>无信号',
                          '投诉工单（2021版）>>融合>>【网络使用】移网上网>>无法上网/无覆盖',
                          '投诉工单（2021版）>>融合>>【网络使用】移网上网>>突发故障',
                          '投诉工单（2021版）>>融合>>【网络使用】移网语音>>无信号'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202303")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '移网无覆盖投诉率'                                                          index_name,
       '202304'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202304")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>移网>>【网络使用】移网上网>>无法上网/无覆盖',
                          '投诉工单（2021版）>>移网>>【网络使用】移网上网>>突发故障',
                          '投诉工单（2021版）>>移网>>【网络使用】移网语音>>2G退网关闭2G网络/网络无覆盖',
                          '投诉工单（2021版）>>移网>>【网络使用】移网语音>>无信号',
                          '投诉工单（2021版）>>融合>>【网络使用】移网上网>>无法上网/无覆盖',
                          '投诉工单（2021版）>>融合>>【网络使用】移网上网>>突发故障',
                          '投诉工单（2021版）>>融合>>【网络使用】移网语音>>无信号'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202304")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '移网无覆盖投诉率'                                                          index_name,
       '202305'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202305")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>移网>>【网络使用】移网上网>>无法上网/无覆盖',
                          '投诉工单（2021版）>>移网>>【网络使用】移网上网>>突发故障',
                          '投诉工单（2021版）>>移网>>【网络使用】移网语音>>2G退网关闭2G网络/网络无覆盖',
                          '投诉工单（2021版）>>移网>>【网络使用】移网语音>>无信号',
                          '投诉工单（2021版）>>融合>>【网络使用】移网上网>>无法上网/无覆盖',
                          '投诉工单（2021版）>>融合>>【网络使用】移网上网>>突发故障',
                          '投诉工单（2021版）>>融合>>【网络使用】移网语音>>无信号'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202305")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '移网无覆盖投诉率'                                                          index_name,
       '202306'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>移网>>【网络使用】移网上网>>无法上网/无覆盖',
                          '投诉工单（2021版）>>移网>>【网络使用】移网上网>>突发故障',
                          '投诉工单（2021版）>>移网>>【网络使用】移网语音>>2G退网关闭2G网络/网络无覆盖',
                          '投诉工单（2021版）>>移网>>【网络使用】移网语音>>无信号',
                          '投诉工单（2021版）>>融合>>【网络使用】移网上网>>无法上网/无覆盖',
                          '投诉工单（2021版）>>融合>>【网络使用】移网上网>>突发故障',
                          '投诉工单（2021版）>>融合>>【网络使用】移网语音>>无信号'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202306")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '移网无覆盖投诉率'                                                          index_name,
       '202307'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202307")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>移网>>【网络使用】移网上网>>无法上网/无覆盖',
                          '投诉工单（2021版）>>移网>>【网络使用】移网上网>>突发故障',
                          '投诉工单（2021版）>>移网>>【网络使用】移网语音>>2G退网关闭2G网络/网络无覆盖',
                          '投诉工单（2021版）>>移网>>【网络使用】移网语音>>无信号',
                          '投诉工单（2021版）>>融合>>【网络使用】移网上网>>无法上网/无覆盖',
                          '投诉工单（2021版）>>融合>>【网络使用】移网上网>>突发故障',
                          '投诉工单（2021版）>>融合>>【网络使用】移网语音>>无信号'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202307")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '移网无覆盖投诉率'                                                          index_name,
       '202308'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202308")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>移网>>【网络使用】移网上网>>无法上网/无覆盖',
                          '投诉工单（2021版）>>移网>>【网络使用】移网上网>>突发故障',
                          '投诉工单（2021版）>>移网>>【网络使用】移网语音>>2G退网关闭2G网络/网络无覆盖',
                          '投诉工单（2021版）>>移网>>【网络使用】移网语音>>无信号',
                          '投诉工单（2021版）>>融合>>【网络使用】移网上网>>无法上网/无覆盖',
                          '投诉工单（2021版）>>融合>>【网络使用】移网上网>>突发故障',
                          '投诉工单（2021版）>>融合>>【网络使用】移网语音>>无信号'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202308")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '移网无覆盖投诉率'                                                          index_name,
       '202309'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202309")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>移网>>【网络使用】移网上网>>无法上网/无覆盖',
                          '投诉工单（2021版）>>移网>>【网络使用】移网上网>>突发故障',
                          '投诉工单（2021版）>>移网>>【网络使用】移网语音>>2G退网关闭2G网络/网络无覆盖',
                          '投诉工单（2021版）>>移网>>【网络使用】移网语音>>无信号',
                          '投诉工单（2021版）>>融合>>【网络使用】移网上网>>无法上网/无覆盖',
                          '投诉工单（2021版）>>融合>>【网络使用】移网上网>>突发故障',
                          '投诉工单（2021版）>>融合>>【网络使用】移网语音>>无信号'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202309")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
;

-- todo 20 移网网速慢投诉率 101 完成
select b.pro_id                                                                    pro_id,
       b.prov_name                                                                 pro_name,
       '00'                                                                        city_id,
       '全省'                                                                      city_name,
       '移网网速慢投诉率'                                                          index_name,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select a.prov_name,
             a.prov_code,
             if(a.n is null, 0, a.n) n
      from (select b.prov_code prov_code,
                   b.prov_name prov_name,
                   count(1)    n
            from (select sheet_id,
                         compl_area
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                         "202303", "202304", "202305", "202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>移网>>【网络使用】移网上网>>网速慢',
                          '投诉工单（2021版）>>融合>>【网络使用】移网上网>>网速慢',
                          '投诉工单（2021版）>>移网>>【网络使用】移网上网>>esim上网通讯问题',
                          '投诉工单（2021版）>>融合>>【网络使用】移网上网>>esim上网通讯问题'
                            )
                    and sheet_status not in ('8', '11')) a
                     left join dc_dim.dim_pro_city_regoin_cb b on
                a.compl_area = b.code_value
            group by b.prov_code,
                     b.prov_name) a) a
         right join (select substr(prov_id, 2, 3)          pro_id,
                            prov_name,
                            cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                            "202303", "202304", "202305", "202306")
                       and kpi_code in ('CKP_66829', '-')
                       and city_id != '-1'
                     group by prov_id,
                              prov_name) b on
            a.prov_code = b.pro_id
        and a.prov_name = b.prov_name
where b.prov_name is not null;
-- union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '移网网速慢投诉率'                                                          index_name,
       '202210'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202210")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>移网>>【网络使用】移网上网>>网速慢',
                          '投诉工单（2021版）>>融合>>【网络使用】移网上网>>网速慢',
                          '投诉工单（2021版）>>移网>>【网络使用】移网上网>>esim上网通讯问题',
                          '投诉工单（2021版）>>融合>>【网络使用】移网上网>>esim上网通讯问题'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202210")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,

       '移网网速慢投诉率'                                                          index_name,
       '202211'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202211")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>移网>>【网络使用】移网上网>>网速慢',
                          '投诉工单（2021版）>>融合>>【网络使用】移网上网>>网速慢',
                          '投诉工单（2021版）>>移网>>【网络使用】移网上网>>esim上网通讯问题',
                          '投诉工单（2021版）>>融合>>【网络使用】移网上网>>esim上网通讯问题'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202211")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,

       '移网网速慢投诉率'                                                          index_name,
       '202212'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202212")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>移网>>【网络使用】移网上网>>网速慢',
                          '投诉工单（2021版）>>融合>>【网络使用】移网上网>>网速慢',
                          '投诉工单（2021版）>>移网>>【网络使用】移网上网>>esim上网通讯问题',
                          '投诉工单（2021版）>>融合>>【网络使用】移网上网>>esim上网通讯问题'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202212")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,

       '移网网速慢投诉率'                                                          index_name,
       '202301'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202301")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>移网>>【网络使用】移网上网>>网速慢',
                          '投诉工单（2021版）>>融合>>【网络使用】移网上网>>网速慢',
                          '投诉工单（2021版）>>移网>>【网络使用】移网上网>>esim上网通讯问题',
                          '投诉工单（2021版）>>融合>>【网络使用】移网上网>>esim上网通讯问题'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202301")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,

       '移网网速慢投诉率'                                                          index_name,
       '202302'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202302")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>移网>>【网络使用】移网上网>>网速慢',
                          '投诉工单（2021版）>>融合>>【网络使用】移网上网>>网速慢',
                          '投诉工单（2021版）>>移网>>【网络使用】移网上网>>esim上网通讯问题',
                          '投诉工单（2021版）>>融合>>【网络使用】移网上网>>esim上网通讯问题'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202302")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,

       '移网网速慢投诉率'                                                          index_name,
       '202303'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202303")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>移网>>【网络使用】移网上网>>网速慢',
                          '投诉工单（2021版）>>融合>>【网络使用】移网上网>>网速慢',
                          '投诉工单（2021版）>>移网>>【网络使用】移网上网>>esim上网通讯问题',
                          '投诉工单（2021版）>>融合>>【网络使用】移网上网>>esim上网通讯问题'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202303")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,

       '移网网速慢投诉率'                                                          index_name,
       '202304'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202304")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>移网>>【网络使用】移网上网>>网速慢',
                          '投诉工单（2021版）>>融合>>【网络使用】移网上网>>网速慢',
                          '投诉工单（2021版）>>移网>>【网络使用】移网上网>>esim上网通讯问题',
                          '投诉工单（2021版）>>融合>>【网络使用】移网上网>>esim上网通讯问题'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202304")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,

       '移网网速慢投诉率'                                                          index_name,
       '202305'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202305")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>移网>>【网络使用】移网上网>>网速慢',
                          '投诉工单（2021版）>>融合>>【网络使用】移网上网>>网速慢',
                          '投诉工单（2021版）>>移网>>【网络使用】移网上网>>esim上网通讯问题',
                          '投诉工单（2021版）>>融合>>【网络使用】移网上网>>esim上网通讯问题'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202305")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,

       '移网网速慢投诉率'                                                          index_name,
       '202306'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>移网>>【网络使用】移网上网>>网速慢',
                          '投诉工单（2021版）>>融合>>【网络使用】移网上网>>网速慢',
                          '投诉工单（2021版）>>移网>>【网络使用】移网上网>>esim上网通讯问题',
                          '投诉工单（2021版）>>融合>>【网络使用】移网上网>>esim上网通讯问题'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202306")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,

       '移网网速慢投诉率'                                                          index_name,
       '202307'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202307")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>移网>>【网络使用】移网上网>>网速慢',
                          '投诉工单（2021版）>>融合>>【网络使用】移网上网>>网速慢',
                          '投诉工单（2021版）>>移网>>【网络使用】移网上网>>esim上网通讯问题',
                          '投诉工单（2021版）>>融合>>【网络使用】移网上网>>esim上网通讯问题'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202307")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,

       '移网网速慢投诉率'                                                          index_name,
       '202308'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202308")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>移网>>【网络使用】移网上网>>网速慢',
                          '投诉工单（2021版）>>融合>>【网络使用】移网上网>>网速慢',
                          '投诉工单（2021版）>>移网>>【网络使用】移网上网>>esim上网通讯问题',
                          '投诉工单（2021版）>>融合>>【网络使用】移网上网>>esim上网通讯问题'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202308")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,

       '移网网速慢投诉率'                                                          index_name,
       '202309'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202309")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>移网>>【网络使用】移网上网>>网速慢',
                          '投诉工单（2021版）>>融合>>【网络使用】移网上网>>网速慢',
                          '投诉工单（2021版）>>移网>>【网络使用】移网上网>>esim上网通讯问题',
                          '投诉工单（2021版）>>融合>>【网络使用】移网上网>>esim上网通讯问题'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202309")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b;

-- todo 21 移网无法通话投诉率 102 完成
select b.pro_id                                                                    pro_id,
       b.prov_name                                                                 pro_name,
       '00'                                                                        city_id,
       '全省'                                                                      city_name,
       '移网无法通话投诉率'                                                        index_name,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select a.prov_name,
             a.prov_code,
             if(a.n is null, 0, a.n) n
      from (select b.prov_code prov_code,
                   b.prov_name prov_name,
                   count(1)    n
            from (select sheet_id,
                         compl_area
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                         "202303", "202304", "202305", "202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>融合>>【网络使用】移网语音>>移网无法通话',
                          '投诉工单（2021版）>>移网>>【网络使用】移网语音>>移网无法通话'
                            )
                    and sheet_status not in ('8', '11')) a
                     left join dc_dim.dim_pro_city_regoin_cb b on
                a.compl_area = b.code_value
            group by b.prov_code,
                     b.prov_name) a) a
         right join (select substr(prov_id, 2, 3)          pro_id,
                            prov_name,
                            cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                            "202303", "202304", "202305", "202306")
                       and kpi_code in ('CKP_66829', '-')
                       and city_id != '-1'
                     group by prov_id,
                              prov_name) b on
            a.prov_code = b.pro_id
        and a.prov_name = b.prov_name
where b.prov_name is not null;
-- union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '移网无法通话投诉率'                                                        index_name,
       '202210'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202210")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>融合>>【网络使用】移网语音>>移网无法通话',
                          '投诉工单（2021版）>>移网>>【网络使用】移网语音>>移网无法通话'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202210")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '移网无法通话投诉率'                                                        index_name,
       '202211'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202211")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>融合>>【网络使用】移网语音>>移网无法通话',
                          '投诉工单（2021版）>>移网>>【网络使用】移网语音>>移网无法通话'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202211")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '移网无法通话投诉率'                                                        index_name,
       '202212'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202212")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>融合>>【网络使用】移网语音>>移网无法通话',
                          '投诉工单（2021版）>>移网>>【网络使用】移网语音>>移网无法通话'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202212")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '移网无法通话投诉率'                                                        index_name,
       '202301'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202301")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>融合>>【网络使用】移网语音>>移网无法通话',
                          '投诉工单（2021版）>>移网>>【网络使用】移网语音>>移网无法通话'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202301")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '移网无法通话投诉率'                                                        index_name,
       '202302'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202302")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>融合>>【网络使用】移网语音>>移网无法通话',
                          '投诉工单（2021版）>>移网>>【网络使用】移网语音>>移网无法通话'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202302")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '移网无法通话投诉率'                                                        index_name,
       '202303'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202303")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>融合>>【网络使用】移网语音>>移网无法通话',
                          '投诉工单（2021版）>>移网>>【网络使用】移网语音>>移网无法通话'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202303")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '移网无法通话投诉率'                                                        index_name,
       '202304'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202304")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>融合>>【网络使用】移网语音>>移网无法通话',
                          '投诉工单（2021版）>>移网>>【网络使用】移网语音>>移网无法通话'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202304")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '移网无法通话投诉率'                                                        index_name,
       '202305'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202305")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>融合>>【网络使用】移网语音>>移网无法通话',
                          '投诉工单（2021版）>>移网>>【网络使用】移网语音>>移网无法通话'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202305")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '移网无法通话投诉率'                                                        index_name,
       '202306'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>融合>>【网络使用】移网语音>>移网无法通话',
                          '投诉工单（2021版）>>移网>>【网络使用】移网语音>>移网无法通话'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202306")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '移网无法通话投诉率'                                                        index_name,
       '202307'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202307")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>融合>>【网络使用】移网语音>>移网无法通话',
                          '投诉工单（2021版）>>移网>>【网络使用】移网语音>>移网无法通话'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202307")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '移网无法通话投诉率'                                                        index_name,
       '202308'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202308")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>融合>>【网络使用】移网语音>>移网无法通话',
                          '投诉工单（2021版）>>移网>>【网络使用】移网语音>>移网无法通话'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202308")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '移网无法通话投诉率'                                                        index_name,
       '202309'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202309")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>融合>>【网络使用】移网语音>>移网无法通话',
                          '投诉工单（2021版）>>移网>>【网络使用】移网语音>>移网无法通话'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202309")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
;

-- todo 22 固话投诉率-无法通话 111 完成
select b.pro_id                                                                    pro_id,
       b.prov_name                                                                 pro_name,
       '00'                                                                        city_id,
       '全省'                                                                      city_name,
       '固话投诉率-无法通话'                                                       index_name,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select a.prov_name,
             a.prov_code,
             if(a.n is null, 0, a.n) n
      from (select b.prov_code prov_code,
                   b.prov_name prov_name,
                   count(1)    n
            from (select sheet_id,
                         compl_area
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                         "202303", "202304", "202305", "202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>宽带>>【网络使用】固话>>固话无法通话',
                          '投诉工单（2021版）>>融合>>【网络使用】固话>>固话无法通话',
                          '故障工单（2021版）>>融合>>【网络使用】固话>>固话无法通话',
                          '故障工单（2021版）>>宽带>>【网络使用】固话>>固话无法通话',
                          '故障工单（2021版）>>全语音门户自助报障>>固定电话障碍los灯亮红',
                          '故障工单（2021版）>>IVR自助报障>>固定电话障碍los灯亮红',
                          '故障工单（2021版）>>全语音门户自助报障>>固定电话障碍',
                          '故障工单（2021版）>>IVR自助报障>>固定电话障碍'
                            )
                    and sheet_status not in ('8', '11')) a
                     left join dc_dim.dim_pro_city_regoin_cb b on
                a.compl_area = b.code_value
            group by b.prov_code,
                     b.prov_name) a) a
         right join (select substr(prov_id, 2, 3)          pro_id,
                            prov_name,
                            cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                            "202303", "202304", "202305", "202306")
                       and kpi_code in ('CKP_66829', '-')
                       and city_id != '-1'
                     group by prov_id,
                              prov_name) b on
            a.prov_code = b.pro_id
        and a.prov_name = b.prov_name
where b.prov_name is not null;
-- union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '固话投诉率-无法通话'                                                       index_name,
       '202210'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202210")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>宽带>>【网络使用】固话>>固话无法通话',
                          '投诉工单（2021版）>>融合>>【网络使用】固话>>固话无法通话',
                          '故障工单（2021版）>>融合>>【网络使用】固话>>固话无法通话',
                          '故障工单（2021版）>>宽带>>【网络使用】固话>>固话无法通话',
                          '故障工单（2021版）>>全语音门户自助报障>>固定电话障碍los灯亮红',
                          '故障工单（2021版）>>IVR自助报障>>固定电话障碍los灯亮红',
                          '故障工单（2021版）>>全语音门户自助报障>>固定电话障碍',
                          '故障工单（2021版）>>IVR自助报障>>固定电话障碍'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202210")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '固话投诉率-无法通话'                                                       index_name,
       '202211'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202211")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>宽带>>【网络使用】固话>>固话无法通话',
                          '投诉工单（2021版）>>融合>>【网络使用】固话>>固话无法通话',
                          '故障工单（2021版）>>融合>>【网络使用】固话>>固话无法通话',
                          '故障工单（2021版）>>宽带>>【网络使用】固话>>固话无法通话',
                          '故障工单（2021版）>>全语音门户自助报障>>固定电话障碍los灯亮红',
                          '故障工单（2021版）>>IVR自助报障>>固定电话障碍los灯亮红',
                          '故障工单（2021版）>>全语音门户自助报障>>固定电话障碍',
                          '故障工单（2021版）>>IVR自助报障>>固定电话障碍'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202211")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '固话投诉率-无法通话'                                                       index_name,
       '202212'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202212")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>宽带>>【网络使用】固话>>固话无法通话',
                          '投诉工单（2021版）>>融合>>【网络使用】固话>>固话无法通话',
                          '故障工单（2021版）>>融合>>【网络使用】固话>>固话无法通话',
                          '故障工单（2021版）>>宽带>>【网络使用】固话>>固话无法通话',
                          '故障工单（2021版）>>全语音门户自助报障>>固定电话障碍los灯亮红',
                          '故障工单（2021版）>>IVR自助报障>>固定电话障碍los灯亮红',
                          '故障工单（2021版）>>全语音门户自助报障>>固定电话障碍',
                          '故障工单（2021版）>>IVR自助报障>>固定电话障碍'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202212")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '固话投诉率-无法通话'                                                       index_name,
       '202301'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202301")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>宽带>>【网络使用】固话>>固话无法通话',
                          '投诉工单（2021版）>>融合>>【网络使用】固话>>固话无法通话',
                          '故障工单（2021版）>>融合>>【网络使用】固话>>固话无法通话',
                          '故障工单（2021版）>>宽带>>【网络使用】固话>>固话无法通话',
                          '故障工单（2021版）>>全语音门户自助报障>>固定电话障碍los灯亮红',
                          '故障工单（2021版）>>IVR自助报障>>固定电话障碍los灯亮红',
                          '故障工单（2021版）>>全语音门户自助报障>>固定电话障碍',
                          '故障工单（2021版）>>IVR自助报障>>固定电话障碍'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202301")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '固话投诉率-无法通话'                                                       index_name,
       '202302'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202302")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>宽带>>【网络使用】固话>>固话无法通话',
                          '投诉工单（2021版）>>融合>>【网络使用】固话>>固话无法通话',
                          '故障工单（2021版）>>融合>>【网络使用】固话>>固话无法通话',
                          '故障工单（2021版）>>宽带>>【网络使用】固话>>固话无法通话',
                          '故障工单（2021版）>>全语音门户自助报障>>固定电话障碍los灯亮红',
                          '故障工单（2021版）>>IVR自助报障>>固定电话障碍los灯亮红',
                          '故障工单（2021版）>>全语音门户自助报障>>固定电话障碍',
                          '故障工单（2021版）>>IVR自助报障>>固定电话障碍'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202302")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '固话投诉率-无法通话'                                                       index_name,
       '202303'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202303")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>宽带>>【网络使用】固话>>固话无法通话',
                          '投诉工单（2021版）>>融合>>【网络使用】固话>>固话无法通话',
                          '故障工单（2021版）>>融合>>【网络使用】固话>>固话无法通话',
                          '故障工单（2021版）>>宽带>>【网络使用】固话>>固话无法通话',
                          '故障工单（2021版）>>全语音门户自助报障>>固定电话障碍los灯亮红',
                          '故障工单（2021版）>>IVR自助报障>>固定电话障碍los灯亮红',
                          '故障工单（2021版）>>全语音门户自助报障>>固定电话障碍',
                          '故障工单（2021版）>>IVR自助报障>>固定电话障碍'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202303")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '固话投诉率-无法通话'                                                       index_name,
       '202304'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202304")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>宽带>>【网络使用】固话>>固话无法通话',
                          '投诉工单（2021版）>>融合>>【网络使用】固话>>固话无法通话',
                          '故障工单（2021版）>>融合>>【网络使用】固话>>固话无法通话',
                          '故障工单（2021版）>>宽带>>【网络使用】固话>>固话无法通话',
                          '故障工单（2021版）>>全语音门户自助报障>>固定电话障碍los灯亮红',
                          '故障工单（2021版）>>IVR自助报障>>固定电话障碍los灯亮红',
                          '故障工单（2021版）>>全语音门户自助报障>>固定电话障碍',
                          '故障工单（2021版）>>IVR自助报障>>固定电话障碍'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202304")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '固话投诉率-无法通话'                                                       index_name,
       '202305'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202305")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>宽带>>【网络使用】固话>>固话无法通话',
                          '投诉工单（2021版）>>融合>>【网络使用】固话>>固话无法通话',
                          '故障工单（2021版）>>融合>>【网络使用】固话>>固话无法通话',
                          '故障工单（2021版）>>宽带>>【网络使用】固话>>固话无法通话',
                          '故障工单（2021版）>>全语音门户自助报障>>固定电话障碍los灯亮红',
                          '故障工单（2021版）>>IVR自助报障>>固定电话障碍los灯亮红',
                          '故障工单（2021版）>>全语音门户自助报障>>固定电话障碍',
                          '故障工单（2021版）>>IVR自助报障>>固定电话障碍'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202305")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '固话投诉率-无法通话'                                                       index_name,
       '202306'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>宽带>>【网络使用】固话>>固话无法通话',
                          '投诉工单（2021版）>>融合>>【网络使用】固话>>固话无法通话',
                          '故障工单（2021版）>>融合>>【网络使用】固话>>固话无法通话',
                          '故障工单（2021版）>>宽带>>【网络使用】固话>>固话无法通话',
                          '故障工单（2021版）>>全语音门户自助报障>>固定电话障碍los灯亮红',
                          '故障工单（2021版）>>IVR自助报障>>固定电话障碍los灯亮红',
                          '故障工单（2021版）>>全语音门户自助报障>>固定电话障碍',
                          '故障工单（2021版）>>IVR自助报障>>固定电话障碍'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202306")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '固话投诉率-无法通话'                                                       index_name,
       '202307'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202307")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>宽带>>【网络使用】固话>>固话无法通话',
                          '投诉工单（2021版）>>融合>>【网络使用】固话>>固话无法通话',
                          '故障工单（2021版）>>融合>>【网络使用】固话>>固话无法通话',
                          '故障工单（2021版）>>宽带>>【网络使用】固话>>固话无法通话',
                          '故障工单（2021版）>>全语音门户自助报障>>固定电话障碍los灯亮红',
                          '故障工单（2021版）>>IVR自助报障>>固定电话障碍los灯亮红',
                          '故障工单（2021版）>>全语音门户自助报障>>固定电话障碍',
                          '故障工单（2021版）>>IVR自助报障>>固定电话障碍'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202307")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '固话投诉率-无法通话'                                                       index_name,
       '202308'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202308")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>宽带>>【网络使用】固话>>固话无法通话',
                          '投诉工单（2021版）>>融合>>【网络使用】固话>>固话无法通话',
                          '故障工单（2021版）>>融合>>【网络使用】固话>>固话无法通话',
                          '故障工单（2021版）>>宽带>>【网络使用】固话>>固话无法通话',
                          '故障工单（2021版）>>全语音门户自助报障>>固定电话障碍los灯亮红',
                          '故障工单（2021版）>>IVR自助报障>>固定电话障碍los灯亮红',
                          '故障工单（2021版）>>全语音门户自助报障>>固定电话障碍',
                          '故障工单（2021版）>>IVR自助报障>>固定电话障碍'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202308")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '固话投诉率-无法通话'                                                       index_name,
       '202309'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202309")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>宽带>>【网络使用】固话>>固话无法通话',
                          '投诉工单（2021版）>>融合>>【网络使用】固话>>固话无法通话',
                          '故障工单（2021版）>>融合>>【网络使用】固话>>固话无法通话',
                          '故障工单（2021版）>>宽带>>【网络使用】固话>>固话无法通话',
                          '故障工单（2021版）>>全语音门户自助报障>>固定电话障碍los灯亮红',
                          '故障工单（2021版）>>IVR自助报障>>固定电话障碍los灯亮红',
                          '故障工单（2021版）>>全语音门户自助报障>>固定电话障碍',
                          '故障工单（2021版）>>IVR自助报障>>固定电话障碍'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202309")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b;

-- todo 固话投诉率-杂音断话 112 完成
select b.pro_id                                                                    pro_id,
       b.prov_name                                                                 pro_name,
       '00'                                                                        city_id,
       '全省'                                                                      city_name,
       '固话投诉率-杂音断话'                                                       index_name,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select a.prov_name,
             a.prov_code,
             if(a.n is null, 0, a.n) n
      from (select b.prov_code prov_code,
                   b.prov_name prov_name,
                   count(1)    n
            from (select sheet_id,
                         compl_area
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                         "202303", "202304", "202305", "202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>宽带>>【网络使用】固话>>固话回音/杂音/串线/断断续续/不稳定/掉话/单通',
                          '投诉工单（2021版）>>融合>>【网络使用】固话>>固话回音/杂音/串线/断断续续/不稳定/掉话/单通',
                          '故障工单（2021版）>>融合>>【网络使用】固话>>固话回音/杂音/串线/断断续续/不稳定/掉话/单通',
                          '故障工单（2021版）>>宽带>>【网络使用】固话>>固话回音/杂音/串线/断断续续/不稳定/掉话/单通'
                            )
                    and sheet_status not in ('8', '11')) a
                     left join dc_dim.dim_pro_city_regoin_cb b on
                a.compl_area = b.code_value
            group by b.prov_code,
                     b.prov_name) a) a
         right join (select substr(prov_id, 2, 3)          pro_id,
                            prov_name,
                            cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                            "202303", "202304", "202305", "202306")
                       and kpi_code in ('CKP_66829', '-')
                       and city_id != '-1'
                     group by prov_id,
                              prov_name) b on
            a.prov_code = b.pro_id
        and a.prov_name = b.prov_name
where b.prov_name is not null;
-- union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '固话投诉率-杂音断话'                                                       index_name,
       '202210'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202210")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>宽带>>【网络使用】固话>>固话回音/杂音/串线/断断续续/不稳定/掉话/单通',
                          '投诉工单（2021版）>>融合>>【网络使用】固话>>固话回音/杂音/串线/断断续续/不稳定/掉话/单通',
                          '故障工单（2021版）>>融合>>【网络使用】固话>>固话回音/杂音/串线/断断续续/不稳定/掉话/单通',
                          '故障工单（2021版）>>宽带>>【网络使用】固话>>固话回音/杂音/串线/断断续续/不稳定/掉话/单通'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202210")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '固话投诉率-杂音断话'                                                       index_name,
       '202211'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202211")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>宽带>>【网络使用】固话>>固话回音/杂音/串线/断断续续/不稳定/掉话/单通',
                          '投诉工单（2021版）>>融合>>【网络使用】固话>>固话回音/杂音/串线/断断续续/不稳定/掉话/单通',
                          '故障工单（2021版）>>融合>>【网络使用】固话>>固话回音/杂音/串线/断断续续/不稳定/掉话/单通',
                          '故障工单（2021版）>>宽带>>【网络使用】固话>>固话回音/杂音/串线/断断续续/不稳定/掉话/单通'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202211")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '固话投诉率-杂音断话'                                                       index_name,
       '202212'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202212")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>宽带>>【网络使用】固话>>固话回音/杂音/串线/断断续续/不稳定/掉话/单通',
                          '投诉工单（2021版）>>融合>>【网络使用】固话>>固话回音/杂音/串线/断断续续/不稳定/掉话/单通',
                          '故障工单（2021版）>>融合>>【网络使用】固话>>固话回音/杂音/串线/断断续续/不稳定/掉话/单通',
                          '故障工单（2021版）>>宽带>>【网络使用】固话>>固话回音/杂音/串线/断断续续/不稳定/掉话/单通'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202212")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '固话投诉率-杂音断话'                                                       index_name,
       '202301'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202301")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>宽带>>【网络使用】固话>>固话回音/杂音/串线/断断续续/不稳定/掉话/单通',
                          '投诉工单（2021版）>>融合>>【网络使用】固话>>固话回音/杂音/串线/断断续续/不稳定/掉话/单通',
                          '故障工单（2021版）>>融合>>【网络使用】固话>>固话回音/杂音/串线/断断续续/不稳定/掉话/单通',
                          '故障工单（2021版）>>宽带>>【网络使用】固话>>固话回音/杂音/串线/断断续续/不稳定/掉话/单通'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202301")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '固话投诉率-杂音断话'                                                       index_name,
       '202302'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202302")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>宽带>>【网络使用】固话>>固话回音/杂音/串线/断断续续/不稳定/掉话/单通',
                          '投诉工单（2021版）>>融合>>【网络使用】固话>>固话回音/杂音/串线/断断续续/不稳定/掉话/单通',
                          '故障工单（2021版）>>融合>>【网络使用】固话>>固话回音/杂音/串线/断断续续/不稳定/掉话/单通',
                          '故障工单（2021版）>>宽带>>【网络使用】固话>>固话回音/杂音/串线/断断续续/不稳定/掉话/单通'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202302")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '固话投诉率-杂音断话'                                                       index_name,
       '202303'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202303")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>宽带>>【网络使用】固话>>固话回音/杂音/串线/断断续续/不稳定/掉话/单通',
                          '投诉工单（2021版）>>融合>>【网络使用】固话>>固话回音/杂音/串线/断断续续/不稳定/掉话/单通',
                          '故障工单（2021版）>>融合>>【网络使用】固话>>固话回音/杂音/串线/断断续续/不稳定/掉话/单通',
                          '故障工单（2021版）>>宽带>>【网络使用】固话>>固话回音/杂音/串线/断断续续/不稳定/掉话/单通'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202303")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '固话投诉率-杂音断话'                                                       index_name,
       '202304'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202304")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>宽带>>【网络使用】固话>>固话回音/杂音/串线/断断续续/不稳定/掉话/单通',
                          '投诉工单（2021版）>>融合>>【网络使用】固话>>固话回音/杂音/串线/断断续续/不稳定/掉话/单通',
                          '故障工单（2021版）>>融合>>【网络使用】固话>>固话回音/杂音/串线/断断续续/不稳定/掉话/单通',
                          '故障工单（2021版）>>宽带>>【网络使用】固话>>固话回音/杂音/串线/断断续续/不稳定/掉话/单通'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202304")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '固话投诉率-杂音断话'                                                       index_name,
       '202305'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202305")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>宽带>>【网络使用】固话>>固话回音/杂音/串线/断断续续/不稳定/掉话/单通',
                          '投诉工单（2021版）>>融合>>【网络使用】固话>>固话回音/杂音/串线/断断续续/不稳定/掉话/单通',
                          '故障工单（2021版）>>融合>>【网络使用】固话>>固话回音/杂音/串线/断断续续/不稳定/掉话/单通',
                          '故障工单（2021版）>>宽带>>【网络使用】固话>>固话回音/杂音/串线/断断续续/不稳定/掉话/单通'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202305")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '固话投诉率-杂音断话'                                                       index_name,
       '202306'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>宽带>>【网络使用】固话>>固话回音/杂音/串线/断断续续/不稳定/掉话/单通',
                          '投诉工单（2021版）>>融合>>【网络使用】固话>>固话回音/杂音/串线/断断续续/不稳定/掉话/单通',
                          '故障工单（2021版）>>融合>>【网络使用】固话>>固话回音/杂音/串线/断断续续/不稳定/掉话/单通',
                          '故障工单（2021版）>>宽带>>【网络使用】固话>>固话回音/杂音/串线/断断续续/不稳定/掉话/单通'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202306")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '固话投诉率-杂音断话'                                                       index_name,
       '202307'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202307")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>宽带>>【网络使用】固话>>固话回音/杂音/串线/断断续续/不稳定/掉话/单通',
                          '投诉工单（2021版）>>融合>>【网络使用】固话>>固话回音/杂音/串线/断断续续/不稳定/掉话/单通',
                          '故障工单（2021版）>>融合>>【网络使用】固话>>固话回音/杂音/串线/断断续续/不稳定/掉话/单通',
                          '故障工单（2021版）>>宽带>>【网络使用】固话>>固话回音/杂音/串线/断断续续/不稳定/掉话/单通'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202307")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '固话投诉率-杂音断话'                                                       index_name,
       '202308'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202308")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>宽带>>【网络使用】固话>>固话回音/杂音/串线/断断续续/不稳定/掉话/单通',
                          '投诉工单（2021版）>>融合>>【网络使用】固话>>固话回音/杂音/串线/断断续续/不稳定/掉话/单通',
                          '故障工单（2021版）>>融合>>【网络使用】固话>>固话回音/杂音/串线/断断续续/不稳定/掉话/单通',
                          '故障工单（2021版）>>宽带>>【网络使用】固话>>固话回音/杂音/串线/断断续续/不稳定/掉话/单通'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202308")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '固话投诉率-杂音断话'                                                       index_name,
       '202309'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202309")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>宽带>>【网络使用】固话>>固话回音/杂音/串线/断断续续/不稳定/掉话/单通',
                          '投诉工单（2021版）>>融合>>【网络使用】固话>>固话回音/杂音/串线/断断续续/不稳定/掉话/单通',
                          '故障工单（2021版）>>融合>>【网络使用】固话>>固话回音/杂音/串线/断断续续/不稳定/掉话/单通',
                          '故障工单（2021版）>>宽带>>【网络使用】固话>>固话回音/杂音/串线/断断续续/不稳定/掉话/单通'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202309")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
;

-- todo IPTV投诉率-无法观看 113 完成
select b.pro_id                                                                    pro_id,
       b.prov_name                                                                 pro_name,
       '00'                                                                        city_id,
       '全省'                                                                      city_name,
       'IPTV投诉率-无法观看'                                                       index_name,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select a.prov_name,
             a.prov_code,
             if(a.n is null, 0, a.n) n
      from (select b.prov_code prov_code,
                   b.prov_name prov_name,
                   count(1)    n
            from (select sheet_id,
                         compl_area
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                         "202303", "202304", "202305", "202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>宽带>>【IPTV使用】IPTV>>IPTV无法观看',
                          '投诉工单（2021版）>>宽带>>【IPTV使用】IPTV>>TV设备故障',
                          '投诉工单（2021版）>>融合>>【IPTV使用】IPTV>>IPTV无法观看',
                          '投诉工单（2021版）>>融合>>【IPTV使用】IPTV>>TV设备故障',
                          '故障工单（2021版）>>融合>>【IPTV使用】IPTV>>IPTV无法观看',
                          '故障工单（2021版）>>融合>>【IPTV使用】IPTV>>设备故障',
                          '故障工单（2021版）>>宽带>>【IPTV使用】IPTV>>IPTV无法观看',
                          '故障工单（2021版）>>宽带>>【IPTV使用】IPTV>>设备故障',
                          '故障工单（2021版）>>全语音门户自助报障>>沃家电视障碍los灯亮红',
                          '故障工单（2021版）>>全语音门户自助报障>>沃家电视障碍',
                          '故障工单（2021版）>>IVR自助报障>>沃家电视障碍los灯亮红',
                          '故障工单（2021版）>>IVR自助报障>>沃家电视障碍',
                          '故障工单>>IPTV>>宽带可以上网，联通电视看不了'
                            )
                    and sheet_status not in ('8', '11')) a
                     left join dc_dim.dim_pro_city_regoin_cb b on
                a.compl_area = b.code_value
            group by b.prov_code,
                     b.prov_name) a) a
         right join (select substr(prov_id, 2, 3)          pro_id,
                            prov_name,
                            cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                            "202303", "202304", "202305", "202306")
                       and kpi_code in ('CKP_66829', '-')
                       and city_id != '-1'
                     group by prov_id,
                              prov_name) b on
            a.prov_code = b.pro_id
        and a.prov_name = b.prov_name
where b.prov_name is not null;
-- union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       'IPTV投诉率-无法观看'                                                       index_name,
       '202210'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202210")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>宽带>>【IPTV使用】IPTV>>IPTV无法观看',
                          '投诉工单（2021版）>>宽带>>【IPTV使用】IPTV>>TV设备故障',
                          '投诉工单（2021版）>>融合>>【IPTV使用】IPTV>>IPTV无法观看',
                          '投诉工单（2021版）>>融合>>【IPTV使用】IPTV>>TV设备故障',
                          '故障工单（2021版）>>融合>>【IPTV使用】IPTV>>IPTV无法观看',
                          '故障工单（2021版）>>融合>>【IPTV使用】IPTV>>设备故障',
                          '故障工单（2021版）>>宽带>>【IPTV使用】IPTV>>IPTV无法观看',
                          '故障工单（2021版）>>宽带>>【IPTV使用】IPTV>>设备故障',
                          '故障工单（2021版）>>全语音门户自助报障>>沃家电视障碍los灯亮红',
                          '故障工单（2021版）>>全语音门户自助报障>>沃家电视障碍',
                          '故障工单（2021版）>>IVR自助报障>>沃家电视障碍los灯亮红',
                          '故障工单（2021版）>>IVR自助报障>>沃家电视障碍',
                          '故障工单>>IPTV>>宽带可以上网，联通电视看不了'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202210")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       'IPTV投诉率-无法观看'                                                       index_name,
       '202211'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202211")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>宽带>>【IPTV使用】IPTV>>IPTV无法观看',
                          '投诉工单（2021版）>>宽带>>【IPTV使用】IPTV>>TV设备故障',
                          '投诉工单（2021版）>>融合>>【IPTV使用】IPTV>>IPTV无法观看',
                          '投诉工单（2021版）>>融合>>【IPTV使用】IPTV>>TV设备故障',
                          '故障工单（2021版）>>融合>>【IPTV使用】IPTV>>IPTV无法观看',
                          '故障工单（2021版）>>融合>>【IPTV使用】IPTV>>设备故障',
                          '故障工单（2021版）>>宽带>>【IPTV使用】IPTV>>IPTV无法观看',
                          '故障工单（2021版）>>宽带>>【IPTV使用】IPTV>>设备故障',
                          '故障工单（2021版）>>全语音门户自助报障>>沃家电视障碍los灯亮红',
                          '故障工单（2021版）>>全语音门户自助报障>>沃家电视障碍',
                          '故障工单（2021版）>>IVR自助报障>>沃家电视障碍los灯亮红',
                          '故障工单（2021版）>>IVR自助报障>>沃家电视障碍',
                          '故障工单>>IPTV>>宽带可以上网，联通电视看不了'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202211")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       'IPTV投诉率-无法观看'                                                       index_name,
       '202212'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202212")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>宽带>>【IPTV使用】IPTV>>IPTV无法观看',
                          '投诉工单（2021版）>>宽带>>【IPTV使用】IPTV>>TV设备故障',
                          '投诉工单（2021版）>>融合>>【IPTV使用】IPTV>>IPTV无法观看',
                          '投诉工单（2021版）>>融合>>【IPTV使用】IPTV>>TV设备故障',
                          '故障工单（2021版）>>融合>>【IPTV使用】IPTV>>IPTV无法观看',
                          '故障工单（2021版）>>融合>>【IPTV使用】IPTV>>设备故障',
                          '故障工单（2021版）>>宽带>>【IPTV使用】IPTV>>IPTV无法观看',
                          '故障工单（2021版）>>宽带>>【IPTV使用】IPTV>>设备故障',
                          '故障工单（2021版）>>全语音门户自助报障>>沃家电视障碍los灯亮红',
                          '故障工单（2021版）>>全语音门户自助报障>>沃家电视障碍',
                          '故障工单（2021版）>>IVR自助报障>>沃家电视障碍los灯亮红',
                          '故障工单（2021版）>>IVR自助报障>>沃家电视障碍',
                          '故障工单>>IPTV>>宽带可以上网，联通电视看不了'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202212")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       'IPTV投诉率-无法观看'                                                       index_name,
       '202301'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202301")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>宽带>>【IPTV使用】IPTV>>IPTV无法观看',
                          '投诉工单（2021版）>>宽带>>【IPTV使用】IPTV>>TV设备故障',
                          '投诉工单（2021版）>>融合>>【IPTV使用】IPTV>>IPTV无法观看',
                          '投诉工单（2021版）>>融合>>【IPTV使用】IPTV>>TV设备故障',
                          '故障工单（2021版）>>融合>>【IPTV使用】IPTV>>IPTV无法观看',
                          '故障工单（2021版）>>融合>>【IPTV使用】IPTV>>设备故障',
                          '故障工单（2021版）>>宽带>>【IPTV使用】IPTV>>IPTV无法观看',
                          '故障工单（2021版）>>宽带>>【IPTV使用】IPTV>>设备故障',
                          '故障工单（2021版）>>全语音门户自助报障>>沃家电视障碍los灯亮红',
                          '故障工单（2021版）>>全语音门户自助报障>>沃家电视障碍',
                          '故障工单（2021版）>>IVR自助报障>>沃家电视障碍los灯亮红',
                          '故障工单（2021版）>>IVR自助报障>>沃家电视障碍',
                          '故障工单>>IPTV>>宽带可以上网，联通电视看不了'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202301")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       'IPTV投诉率-无法观看'                                                       index_name,
       '202302'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202302")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>宽带>>【IPTV使用】IPTV>>IPTV无法观看',
                          '投诉工单（2021版）>>宽带>>【IPTV使用】IPTV>>TV设备故障',
                          '投诉工单（2021版）>>融合>>【IPTV使用】IPTV>>IPTV无法观看',
                          '投诉工单（2021版）>>融合>>【IPTV使用】IPTV>>TV设备故障',
                          '故障工单（2021版）>>融合>>【IPTV使用】IPTV>>IPTV无法观看',
                          '故障工单（2021版）>>融合>>【IPTV使用】IPTV>>设备故障',
                          '故障工单（2021版）>>宽带>>【IPTV使用】IPTV>>IPTV无法观看',
                          '故障工单（2021版）>>宽带>>【IPTV使用】IPTV>>设备故障',
                          '故障工单（2021版）>>全语音门户自助报障>>沃家电视障碍los灯亮红',
                          '故障工单（2021版）>>全语音门户自助报障>>沃家电视障碍',
                          '故障工单（2021版）>>IVR自助报障>>沃家电视障碍los灯亮红',
                          '故障工单（2021版）>>IVR自助报障>>沃家电视障碍',
                          '故障工单>>IPTV>>宽带可以上网，联通电视看不了'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202302")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       'IPTV投诉率-无法观看'                                                       index_name,
       '202303'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202303")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>宽带>>【IPTV使用】IPTV>>IPTV无法观看',
                          '投诉工单（2021版）>>宽带>>【IPTV使用】IPTV>>TV设备故障',
                          '投诉工单（2021版）>>融合>>【IPTV使用】IPTV>>IPTV无法观看',
                          '投诉工单（2021版）>>融合>>【IPTV使用】IPTV>>TV设备故障',
                          '故障工单（2021版）>>融合>>【IPTV使用】IPTV>>IPTV无法观看',
                          '故障工单（2021版）>>融合>>【IPTV使用】IPTV>>设备故障',
                          '故障工单（2021版）>>宽带>>【IPTV使用】IPTV>>IPTV无法观看',
                          '故障工单（2021版）>>宽带>>【IPTV使用】IPTV>>设备故障',
                          '故障工单（2021版）>>全语音门户自助报障>>沃家电视障碍los灯亮红',
                          '故障工单（2021版）>>全语音门户自助报障>>沃家电视障碍',
                          '故障工单（2021版）>>IVR自助报障>>沃家电视障碍los灯亮红',
                          '故障工单（2021版）>>IVR自助报障>>沃家电视障碍',
                          '故障工单>>IPTV>>宽带可以上网，联通电视看不了'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202303")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       'IPTV投诉率-无法观看'                                                       index_name,
       '202304'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202304")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>宽带>>【IPTV使用】IPTV>>IPTV无法观看',
                          '投诉工单（2021版）>>宽带>>【IPTV使用】IPTV>>TV设备故障',
                          '投诉工单（2021版）>>融合>>【IPTV使用】IPTV>>IPTV无法观看',
                          '投诉工单（2021版）>>融合>>【IPTV使用】IPTV>>TV设备故障',
                          '故障工单（2021版）>>融合>>【IPTV使用】IPTV>>IPTV无法观看',
                          '故障工单（2021版）>>融合>>【IPTV使用】IPTV>>设备故障',
                          '故障工单（2021版）>>宽带>>【IPTV使用】IPTV>>IPTV无法观看',
                          '故障工单（2021版）>>宽带>>【IPTV使用】IPTV>>设备故障',
                          '故障工单（2021版）>>全语音门户自助报障>>沃家电视障碍los灯亮红',
                          '故障工单（2021版）>>全语音门户自助报障>>沃家电视障碍',
                          '故障工单（2021版）>>IVR自助报障>>沃家电视障碍los灯亮红',
                          '故障工单（2021版）>>IVR自助报障>>沃家电视障碍',
                          '故障工单>>IPTV>>宽带可以上网，联通电视看不了'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202304")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       'IPTV投诉率-无法观看'                                                       index_name,
       '202305'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202305")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>宽带>>【IPTV使用】IPTV>>IPTV无法观看',
                          '投诉工单（2021版）>>宽带>>【IPTV使用】IPTV>>TV设备故障',
                          '投诉工单（2021版）>>融合>>【IPTV使用】IPTV>>IPTV无法观看',
                          '投诉工单（2021版）>>融合>>【IPTV使用】IPTV>>TV设备故障',
                          '故障工单（2021版）>>融合>>【IPTV使用】IPTV>>IPTV无法观看',
                          '故障工单（2021版）>>融合>>【IPTV使用】IPTV>>设备故障',
                          '故障工单（2021版）>>宽带>>【IPTV使用】IPTV>>IPTV无法观看',
                          '故障工单（2021版）>>宽带>>【IPTV使用】IPTV>>设备故障',
                          '故障工单（2021版）>>全语音门户自助报障>>沃家电视障碍los灯亮红',
                          '故障工单（2021版）>>全语音门户自助报障>>沃家电视障碍',
                          '故障工单（2021版）>>IVR自助报障>>沃家电视障碍los灯亮红',
                          '故障工单（2021版）>>IVR自助报障>>沃家电视障碍',
                          '故障工单>>IPTV>>宽带可以上网，联通电视看不了'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202305")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       'IPTV投诉率-无法观看'                                                       index_name,
       '202306'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>宽带>>【IPTV使用】IPTV>>IPTV无法观看',
                          '投诉工单（2021版）>>宽带>>【IPTV使用】IPTV>>TV设备故障',
                          '投诉工单（2021版）>>融合>>【IPTV使用】IPTV>>IPTV无法观看',
                          '投诉工单（2021版）>>融合>>【IPTV使用】IPTV>>TV设备故障',
                          '故障工单（2021版）>>融合>>【IPTV使用】IPTV>>IPTV无法观看',
                          '故障工单（2021版）>>融合>>【IPTV使用】IPTV>>设备故障',
                          '故障工单（2021版）>>宽带>>【IPTV使用】IPTV>>IPTV无法观看',
                          '故障工单（2021版）>>宽带>>【IPTV使用】IPTV>>设备故障',
                          '故障工单（2021版）>>全语音门户自助报障>>沃家电视障碍los灯亮红',
                          '故障工单（2021版）>>全语音门户自助报障>>沃家电视障碍',
                          '故障工单（2021版）>>IVR自助报障>>沃家电视障碍los灯亮红',
                          '故障工单（2021版）>>IVR自助报障>>沃家电视障碍',
                          '故障工单>>IPTV>>宽带可以上网，联通电视看不了'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202306")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       'IPTV投诉率-无法观看'                                                       index_name,
       '202307'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202307")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>宽带>>【IPTV使用】IPTV>>IPTV无法观看',
                          '投诉工单（2021版）>>宽带>>【IPTV使用】IPTV>>TV设备故障',
                          '投诉工单（2021版）>>融合>>【IPTV使用】IPTV>>IPTV无法观看',
                          '投诉工单（2021版）>>融合>>【IPTV使用】IPTV>>TV设备故障',
                          '故障工单（2021版）>>融合>>【IPTV使用】IPTV>>IPTV无法观看',
                          '故障工单（2021版）>>融合>>【IPTV使用】IPTV>>设备故障',
                          '故障工单（2021版）>>宽带>>【IPTV使用】IPTV>>IPTV无法观看',
                          '故障工单（2021版）>>宽带>>【IPTV使用】IPTV>>设备故障',
                          '故障工单（2021版）>>全语音门户自助报障>>沃家电视障碍los灯亮红',
                          '故障工单（2021版）>>全语音门户自助报障>>沃家电视障碍',
                          '故障工单（2021版）>>IVR自助报障>>沃家电视障碍los灯亮红',
                          '故障工单（2021版）>>IVR自助报障>>沃家电视障碍',
                          '故障工单>>IPTV>>宽带可以上网，联通电视看不了'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202307")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       'IPTV投诉率-无法观看'                                                       index_name,
       '202308'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202308")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>宽带>>【IPTV使用】IPTV>>IPTV无法观看',
                          '投诉工单（2021版）>>宽带>>【IPTV使用】IPTV>>TV设备故障',
                          '投诉工单（2021版）>>融合>>【IPTV使用】IPTV>>IPTV无法观看',
                          '投诉工单（2021版）>>融合>>【IPTV使用】IPTV>>TV设备故障',
                          '故障工单（2021版）>>融合>>【IPTV使用】IPTV>>IPTV无法观看',
                          '故障工单（2021版）>>融合>>【IPTV使用】IPTV>>设备故障',
                          '故障工单（2021版）>>宽带>>【IPTV使用】IPTV>>IPTV无法观看',
                          '故障工单（2021版）>>宽带>>【IPTV使用】IPTV>>设备故障',
                          '故障工单（2021版）>>全语音门户自助报障>>沃家电视障碍los灯亮红',
                          '故障工单（2021版）>>全语音门户自助报障>>沃家电视障碍',
                          '故障工单（2021版）>>IVR自助报障>>沃家电视障碍los灯亮红',
                          '故障工单（2021版）>>IVR自助报障>>沃家电视障碍',
                          '故障工单>>IPTV>>宽带可以上网，联通电视看不了'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202308")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       'IPTV投诉率-无法观看'                                                       index_name,
       '202309'                                                                    month_id,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202309")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>宽带>>【IPTV使用】IPTV>>IPTV无法观看',
                          '投诉工单（2021版）>>宽带>>【IPTV使用】IPTV>>TV设备故障',
                          '投诉工单（2021版）>>融合>>【IPTV使用】IPTV>>IPTV无法观看',
                          '投诉工单（2021版）>>融合>>【IPTV使用】IPTV>>TV设备故障',
                          '故障工单（2021版）>>融合>>【IPTV使用】IPTV>>IPTV无法观看',
                          '故障工单（2021版）>>融合>>【IPTV使用】IPTV>>设备故障',
                          '故障工单（2021版）>>宽带>>【IPTV使用】IPTV>>IPTV无法观看',
                          '故障工单（2021版）>>宽带>>【IPTV使用】IPTV>>设备故障',
                          '故障工单（2021版）>>全语音门户自助报障>>沃家电视障碍los灯亮红',
                          '故障工单（2021版）>>全语音门户自助报障>>沃家电视障碍',
                          '故障工单（2021版）>>IVR自助报障>>沃家电视障碍los灯亮红',
                          '故障工单（2021版）>>IVR自助报障>>沃家电视障碍',
                          '故障工单>>IPTV>>宽带可以上网，联通电视看不了'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202309")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b
;


-- todo IPTV投诉率-操作复杂 114 完成
select b.pro_id                                                                    pro_id,
       b.prov_name                                                                 pro_name,
       '00'                                                                        city_id,
       '全省'                                                                      city_name,
       'IPTV投诉率-操作复杂'                                                       index_name,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select a.prov_name,
             a.prov_code,
             if(a.n is null, 0, a.n) n
      from (select b.prov_code prov_code,
                   b.prov_name prov_name,
                   count(1)    n
            from (select sheet_id,
                         compl_area
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                         "202303", "202304", "202305", "202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>宽带>>【IPTV使用】IPTV>>TV操作太复杂，用户不会操作，缺乏必要指导',
                          '投诉工单（2021版）>>融合>>【IPTV使用】IPTV>>TV操作太复杂，用户不会操作，缺乏必要指导'
                            )
                    and sheet_status not in ('8', '11')) a
                     left join dc_dim.dim_pro_city_regoin_cb b on
                a.compl_area = b.code_value
            group by b.prov_code,
                     b.prov_name) a) a
         right join (select substr(prov_id, 2, 3)          pro_id,
                            prov_name,
                            cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                            "202303", "202304", "202305", "202306")
                       and kpi_code in ('CKP_66829', '-')
                       and city_id != '-1'
                     group by prov_id,
                              prov_name) b on
            a.prov_code = b.pro_id
        and a.prov_name = b.prov_name
where b.prov_name is not null;
-- union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       'IPTV投诉率-操作复杂'                                                       index_name,
       month_id,
    ,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id,month_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                         "202303", "202304", "202305", "202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>宽带>>【IPTV使用】IPTV>>TV操作太复杂，用户不会操作，缺乏必要指导',
                          '投诉工单（2021版）>>融合>>【IPTV使用】IPTV>>TV操作太复杂，用户不会操作，缺乏必要指导'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                            "202303", "202304", "202305", "202306")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b;

-- todo IPTV投诉率-播放卡顿 115 完成
select b.pro_id                                                                    pro_id,
       b.prov_name                                                                 pro_name,
       '00'                                                                        city_id,
       '全省'                                                                      city_name,
       'IPTV投诉率-播放卡顿'                                                       index_name,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select a.prov_name,
             a.prov_code,
             if(a.n is null, 0, a.n) n
      from (select b.prov_code prov_code,
                   b.prov_name prov_name,
                   count(1)    n
            from (select sheet_id,
                         compl_area
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                         "202303", "202304", "202305", "202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>宽带>>【IPTV使用】IPTV>>IPTV播放卡顿',
                          '投诉工单（2021版）>>融合>>【IPTV使用】IPTV>>IPTV播放卡顿',
                          '故障工单（2021版）>>融合>>【IPTV使用】IPTV>>IPTV播放卡顿',
                          '故障工单（2021版）>>宽带>>【IPTV使用】IPTV>>IPTV播放卡顿'
                            )
                    and sheet_status not in ('8', '11')) a
                     left join dc_dim.dim_pro_city_regoin_cb b on
                a.compl_area = b.code_value
            group by b.prov_code,
                     b.prov_name) a) a
         right join (select substr(prov_id, 2, 3)          pro_id,
                            prov_name,
                            cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                            "202303", "202304", "202305", "202306")
                       and kpi_code in ('CKP_66829', '-')
                       and city_id != '-1'
                     group by prov_id,
                              prov_name) b on
            a.prov_code = b.pro_id
        and a.prov_name = b.prov_name
where b.prov_name is not null
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       'IPTV投诉率-播放卡顿'                                                       index_name,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                         "202303", "202304", "202305", "202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>宽带>>【IPTV使用】IPTV>>IPTV播放卡顿',
                          '投诉工单（2021版）>>融合>>【IPTV使用】IPTV>>IPTV播放卡顿',
                          '故障工单（2021版）>>融合>>【IPTV使用】IPTV>>IPTV播放卡顿',
                          '故障工单（2021版）>>宽带>>【IPTV使用】IPTV>>IPTV播放卡顿'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                            "202303", "202304", "202305", "202306")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b;

-- todo 宽带网速慢投诉率 179 完成
select b.pro_id                                                                    pro_id,
       b.prov_name                                                                 pro_name,
       '00'                                                                        city_id,
       '全省'                                                                      city_name,
       '宽带网速慢投诉率'                                                          index_name,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select a.prov_name,
             a.prov_code,
             if(a.n is null, 0, a.n) n
      from (select b.prov_code prov_code,
                   b.prov_name prov_name,
                   count(1)    n
            from (select sheet_id,
                         compl_area
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                         "202303", "202304", "202305", "202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>宽带>>【网络使用】宽带网络>>宽带限速、一拖N',
                          '投诉工单（2021版）>>宽带>>【网络使用】宽带网络>>网络速率与光猫路由不匹配',
                          '投诉工单（2021版）>>宽带>>【网络使用】宽带网络>>网速慢',
                          '投诉工单（2021版）>>融合>>【网络使用】宽带网络>>宽带限速、一拖N',
                          '投诉工单（2021版）>>融合>>【网络使用】宽带网络>>网络速率与光猫路由不匹配',
                          '投诉工单（2021版）>>融合>>【网络使用】宽带网络>>网速慢',
                          '故障工单（2021版）>>融合>>【网络使用】宽带网络>>网速慢',
                          '故障工单（2021版）>>宽带>>【网络使用】宽带网络>>网速慢'
                            )
                    and sheet_status not in ('8', '11')) a
                     left join dc_dim.dim_pro_city_regoin_cb b on
                a.compl_area = b.code_value
            group by b.prov_code,
                     b.prov_name) a) a
         right join (select substr(prov_id, 2, 3)          pro_id,
                            prov_name,
                            cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                            "202303", "202304", "202305", "202306")
                       and kpi_code in ('CKP_66829', '-')
                       and city_id != '-1'
                     group by prov_id,
                              prov_name) b on
            a.prov_code = b.pro_id
        and a.prov_name = b.prov_name
where b.prov_name is not null
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '宽带网速慢投诉率'                                                          index_name,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                         "202303", "202304", "202305", "202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>宽带>>【网络使用】宽带网络>>宽带限速、一拖N',
                          '投诉工单（2021版）>>宽带>>【网络使用】宽带网络>>网络速率与光猫路由不匹配',
                          '投诉工单（2021版）>>宽带>>【网络使用】宽带网络>>网速慢',
                          '投诉工单（2021版）>>融合>>【网络使用】宽带网络>>宽带限速、一拖N',
                          '投诉工单（2021版）>>融合>>【网络使用】宽带网络>>网络速率与光猫路由不匹配',
                          '投诉工单（2021版）>>融合>>【网络使用】宽带网络>>网速慢',
                          '故障工单（2021版）>>融合>>【网络使用】宽带网络>>网速慢',
                          '故障工单（2021版）>>宽带>>【网络使用】宽带网络>>网速慢'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                            "202303", "202304", "202305", "202306")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b;

-- todo 宽带上网卡顿投诉率 180 完成
select b.pro_id                                                                    pro_id,
       b.prov_name                                                                 pro_name,
       '00'                                                                        city_id,
       '全省'                                                                      city_name,
       '宽带上网卡顿投诉率'                                                        index_name,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select a.prov_name,
             a.prov_code,
             if(a.n is null, 0, a.n) n
      from (select b.prov_code prov_code,
                   b.prov_name prov_name,
                   count(1)    n
            from (select sheet_id,
                         compl_area
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                         "202303", "202304", "202305", "202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>宽带>>【网络使用】宽带网络>>上网卡顿/掉线/延时/信号弱/不稳定/网页无法打开',
                          '投诉工单（2021版）>>融合>>【网络使用】宽带网络>>上网卡顿/掉线/延时/信号弱/不稳定/网页无法打开',
                          '故障工单（2021版）>>融合>>【网络使用】宽带网络>>上网卡顿/掉线/延时/信号弱/不稳定/网页无法打开',
                          '故障工单（2021版）>>宽带>>【网络使用】宽带网络>>上网卡顿/掉线/延时/信号弱/不稳定/网页无法打开'
                            )
                    and sheet_status not in ('8', '11')) a
                     left join dc_dim.dim_pro_city_regoin_cb b on
                a.compl_area = b.code_value
            group by b.prov_code,
                     b.prov_name) a) a
         right join (select substr(prov_id, 2, 3)          pro_id,
                            prov_name,
                            cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                            "202303", "202304", "202305", "202306")
                       and kpi_code in ('CKP_66829', '-')
                       and city_id != '-1'
                     group by prov_id,
                              prov_name) b on
            a.prov_code = b.pro_id
        and a.prov_name = b.prov_name
where b.prov_name is not null
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '宽带上网卡顿投诉率'                                                        index_name,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                         "202303", "202304", "202305", "202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>宽带>>【网络使用】宽带网络>>上网卡顿/掉线/延时/信号弱/不稳定/网页无法打开',
                          '投诉工单（2021版）>>融合>>【网络使用】宽带网络>>上网卡顿/掉线/延时/信号弱/不稳定/网页无法打开',
                          '故障工单（2021版）>>融合>>【网络使用】宽带网络>>上网卡顿/掉线/延时/信号弱/不稳定/网页无法打开',
                          '故障工单（2021版）>>宽带>>【网络使用】宽带网络>>上网卡顿/掉线/延时/信号弱/不稳定/网页无法打开'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                            "202303", "202304", "202305", "202306")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b;

-- todo WiFi使用问题投诉率 181 完成
select b.pro_id                                                                    pro_id,
       b.prov_name                                                                 pro_name,
       '00'                                                                        city_id,
       '全省'                                                                      city_name,
       'WiFi使用问题投诉率'                                                        index_name,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select a.prov_name,
             a.prov_code,
             if(a.n is null, 0, a.n) n
      from (select b.prov_code prov_code,
                   b.prov_name prov_name,
                   count(1)    n
            from (select sheet_id,
                         compl_area
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                         "202303", "202304", "202305", "202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>宽带>>【网络使用】宽带网络>>家庭WIFI信号弱/ 无法使用WIFI',
                          '投诉工单（2021版）>>融合>>【网络使用】宽带网络>>家庭WIFI信号弱/ 无法使用WIFI',
                          '故障工单（2021版）>>融合>>【网络使用】宽带网络>>家庭WIFI信号弱/ 无法使用WIFI',
                          '故障工单（2021版）>>宽带>>【网络使用】宽带网络>>家庭WIFI信号弱/ 无法使用WIFI'
                            )
                    and sheet_status not in ('8', '11')) a
                     left join dc_dim.dim_pro_city_regoin_cb b on
                a.compl_area = b.code_value
            group by b.prov_code,
                     b.prov_name) a) a
         right join (select substr(prov_id, 2, 3)          pro_id,
                            prov_name,
                            cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                            "202303", "202304", "202305", "202306")
                       and kpi_code in ('CKP_66829', '-')
                       and city_id != '-1'
                     group by prov_id,
                              prov_name) b on
            a.prov_code = b.pro_id
        and a.prov_name = b.prov_name
where b.prov_name is not null
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       'WiFi使用问题投诉率'                                                        index_name,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                         "202303", "202304", "202305", "202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>宽带>>【网络使用】宽带网络>>家庭WIFI信号弱/ 无法使用WIFI',
                          '投诉工单（2021版）>>融合>>【网络使用】宽带网络>>家庭WIFI信号弱/ 无法使用WIFI',
                          '故障工单（2021版）>>融合>>【网络使用】宽带网络>>家庭WIFI信号弱/ 无法使用WIFI',
                          '故障工单（2021版）>>宽带>>【网络使用】宽带网络>>家庭WIFI信号弱/ 无法使用WIFI'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                            "202303", "202304", "202305", "202306")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b;

-- todo 移网通话质量投诉率 211 完成
select b.pro_id                                                                    pro_id,
       b.prov_name                                                                 pro_name,
       '00'                                                                        city_id,
       '全省'                                                                      city_name,
       '移网通话质量投诉率'                                                        index_name,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select a.prov_name,
             a.prov_code,
             if(a.n is null, 0, a.n) n
      from (select b.prov_code prov_code,
                   b.prov_name prov_name,
                   count(1)    n
            from (select sheet_id,
                         compl_area
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                         "202303", "202304", "202305", "202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>移网>>【网络使用】移网语音>>voLte语音通讯问题',
                          '投诉工单（2021版）>>移网>>【网络使用】移网语音>>回音/杂音/串线/断断续续/信号弱/不稳定/掉话/单通',
                          '投诉工单（2021版）>>融合>>【网络使用】移网语音>>voLte语音通讯问题',
                          '投诉工单（2021版）>>融合>>【网络使用】移网语音>>回音/杂音/串线/断断续续/信号弱/不稳定/掉话/单通'
                            )
                    and sheet_status not in ('8', '11')) a
                     left join dc_dim.dim_pro_city_regoin_cb b on
                a.compl_area = b.code_value
            group by b.prov_code,
                     b.prov_name) a) a
         right join (select substr(prov_id, 2, 3)          pro_id,
                            prov_name,
                            cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                            "202303", "202304", "202305", "202306")
                       and kpi_code in ('CKP_66829', '-')
                       and city_id != '-1'
                     group by prov_id,
                              prov_name) b on
            a.prov_code = b.pro_id
        and a.prov_name = b.prov_name
where b.prov_name is not null
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '移网通话质量投诉率'                                                        index_name,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                         "202303", "202304", "202305", "202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>移网>>【网络使用】移网语音>>voLte语音通讯问题',
                          '投诉工单（2021版）>>移网>>【网络使用】移网语音>>回音/杂音/串线/断断续续/信号弱/不稳定/掉话/单通',
                          '投诉工单（2021版）>>融合>>【网络使用】移网语音>>voLte语音通讯问题',
                          '投诉工单（2021版）>>融合>>【网络使用】移网语音>>回音/杂音/串线/断断续续/信号弱/不稳定/掉话/单通'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                            "202303", "202304", "202305", "202306")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b;

-- todo 短信收发投诉率 213 完成
select b.pro_id                                                                    pro_id,
       b.prov_name                                                                 pro_name,
       '00'                                                                        city_id,
       '全省'                                                                      city_name,
       '短信收发投诉率'                                                            index_name,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select a.prov_name,
             a.prov_code,
             if(a.n is null, 0, a.n) n
      from (select b.prov_code prov_code,
                   b.prov_name prov_name,
                   count(1)    n
            from (select sheet_id,
                         compl_area
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                         "202303", "202304", "202305", "202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>融合>>【网络使用】移网上网>>短彩信收发异常',
                          '投诉工单（2021版）>>移网>>【网络使用】移网上网>>短彩信收发异常'
                            )
                    and sheet_status not in ('8', '11')) a
                     left join dc_dim.dim_pro_city_regoin_cb b on
                a.compl_area = b.code_value
            group by b.prov_code,
                     b.prov_name) a) a
         right join (select substr(prov_id, 2, 3)          pro_id,
                            prov_name,
                            cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                            "202303", "202304", "202305", "202306")
                       and kpi_code in ('CKP_66829', '-')
                       and city_id != '-1'
                     group by prov_id,
                              prov_name) b on
            a.prov_code = b.pro_id
        and a.prov_name = b.prov_name
where b.prov_name is not null
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '短信收发投诉率'                                                            index_name,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                         "202303", "202304", "202305", "202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>融合>>【网络使用】移网上网>>短彩信收发异常',
                          '投诉工单（2021版）>>移网>>【网络使用】移网上网>>短彩信收发异常'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                            "202303", "202304", "202305", "202306")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b;

-- todo 宽带无资源投诉率 214 完成
select b.pro_id                                                                    pro_id,
       b.prov_name                                                                 pro_name,
       '00'                                                                        city_id,
       '全省'                                                                      city_name,
       '宽带无资源投诉率'                                                          index_name,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select a.prov_name,
             a.prov_code,
             if(a.n is null, 0, a.n) n
      from (select b.prov_code prov_code,
                   b.prov_name prov_name,
                   count(1)    n
            from (select sheet_id,
                         compl_area
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                         "202303", "202304", "202305", "202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>宽带>>【入网】办理>>宽带不具备资源无法办理',
                          '投诉工单（2021版）>>宽带>>【入网】装机>>固网网络资源不可查/查不到',
                          '投诉工单（2021版）>>宽带>>【入网】装机>>无固网资源/资源不足',
                          '投诉工单（2021版）>>融合>>【入网】办理>>宽带不具备资源无法办理',
                          '投诉工单（2021版）>>融合>>【入网】装机>>固网网络资源不可查/查不到',
                          '投诉工单（2021版）>>融合>>【入网】装机>>无固网资源/资源不足'
                            )
                    and sheet_status not in ('8', '11')) a
                     left join dc_dim.dim_pro_city_regoin_cb b on
                a.compl_area = b.code_value
            group by b.prov_code,
                     b.prov_name) a) a
         right join (select substr(prov_id, 2, 3)          pro_id,
                            prov_name,
                            cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                            "202303", "202304", "202305", "202306")
                       and kpi_code in ('CKP_66829', '-')
                       and city_id != '-1'
                     group by prov_id,
                              prov_name) b on
            a.prov_code = b.pro_id
        and a.prov_name = b.prov_name
where b.prov_name is not null
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '宽带无资源投诉率'                                                          index_name,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                         "202303", "202304", "202305", "202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>宽带>>【入网】办理>>宽带不具备资源无法办理',
                          '投诉工单（2021版）>>宽带>>【入网】装机>>固网网络资源不可查/查不到',
                          '投诉工单（2021版）>>宽带>>【入网】装机>>无固网资源/资源不足',
                          '投诉工单（2021版）>>融合>>【入网】办理>>宽带不具备资源无法办理',
                          '投诉工单（2021版）>>融合>>【入网】装机>>固网网络资源不可查/查不到',
                          '投诉工单（2021版）>>融合>>【入网】装机>>无固网资源/资源不足'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                            "202303", "202304", "202305", "202306")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b;

-- todo 宽带无法上网投诉率 217 完成
select b.pro_id                                                                    pro_id,
       b.prov_name                                                                 pro_name,
       '00'                                                                        city_id,
       '全省'                                                                      city_name,
       '宽带无法上网投诉率'                                                        index_name,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select a.prov_name,
             a.prov_code,
             if(a.n is null, 0, a.n) n
      from (select b.prov_code prov_code,
                   b.prov_name prov_name,
                   count(1)    n
            from (select sheet_id,
                         compl_area
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                         "202303", "202304", "202305", "202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>宽带>>【网络使用】宽带网络>>宽带无法上网',
                          '投诉工单（2021版）>>宽带>>【网络使用】宽带网络>>突发故障',
                          '投诉工单（2021版）>>融合>>【网络使用】宽带网络>>宽带无法上网',
                          '投诉工单（2021版）>>融合>>【网络使用】宽带网络>>突发故障',
                          '故障工单（2021版）>>融合>>【网络使用】宽带网络>>宽带无法上网',
                          '故障工单（2021版）>>融合>>【网络使用】宽带网络>>突发故障',
                          '故障工单（2021版）>>宽带>>【网络使用】宽带网络>>宽带无法上网',
                          '故障工单（2021版）>>宽带>>【网络使用】宽带网络>>突发故障',
                          '故障工单（2021版）>>全语音门户自助报障',
                          '故障工单（2021版）>>全语音门户自助报障los红灯',
                          '故障工单（2021版）>>全语音门户自助报障>>宽带障碍los灯亮红',
                          '故障工单（2021版）>>全语音门户自助报障>>宽带障碍',
                          '故障工单（2021版）>>IVR自助报障',
                          '故障工单（2021版）>>IVR自助报障>>宽带障碍los灯亮红',
                          '故障工单（2021版）>>IVR自助报障>>宽带障碍',
                          '故障工单>>北京报障>>普通公众报障（北京专用）',
                          '故障工单（2021版）>>全语音门户自助报障>>全语音门户自助报障',
                          '故障工单（2021版）>>IVR自助报障>>IVR自助报障',
                          '故障工单（2021版）>>全语音门户自助报障los红灯>>全语音门户自助报障los红灯',
                          '故障工单>>宽带报障>>无法上网，LOS灯长亮'
                            )
                    and sheet_status not in ('8', '11')) a
                     left join dc_dim.dim_pro_city_regoin_cb b on
                a.compl_area = b.code_value
            group by b.prov_code,
                     b.prov_name) a) a
         right join (select substr(prov_id, 2, 3)          pro_id,
                            prov_name,
                            cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                            "202303", "202304", "202305", "202306")
                       and kpi_code in ('CKP_66829', '-')
                       and city_id != '-1'
                     group by prov_id,
                              prov_name) b on
            a.prov_code = b.pro_id
        and a.prov_name = b.prov_name
where b.prov_name is not null
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '宽带无法上网投诉率'                                                        index_name,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                         "202303", "202304", "202305", "202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>宽带>>【网络使用】宽带网络>>宽带无法上网',
                          '投诉工单（2021版）>>宽带>>【网络使用】宽带网络>>突发故障',
                          '投诉工单（2021版）>>融合>>【网络使用】宽带网络>>宽带无法上网',
                          '投诉工单（2021版）>>融合>>【网络使用】宽带网络>>突发故障',
                          '故障工单（2021版）>>融合>>【网络使用】宽带网络>>宽带无法上网',
                          '故障工单（2021版）>>融合>>【网络使用】宽带网络>>突发故障',
                          '故障工单（2021版）>>宽带>>【网络使用】宽带网络>>宽带无法上网',
                          '故障工单（2021版）>>宽带>>【网络使用】宽带网络>>突发故障',
                          '故障工单（2021版）>>全语音门户自助报障',
                          '故障工单（2021版）>>全语音门户自助报障los红灯',
                          '故障工单（2021版）>>全语音门户自助报障>>宽带障碍los灯亮红',
                          '故障工单（2021版）>>全语音门户自助报障>>宽带障碍',
                          '故障工单（2021版）>>IVR自助报障',
                          '故障工单（2021版）>>IVR自助报障>>宽带障碍los灯亮红',
                          '故障工单（2021版）>>IVR自助报障>>宽带障碍',
                          '故障工单>>北京报障>>普通公众报障（北京专用）',
                          '故障工单（2021版）>>全语音门户自助报障>>全语音门户自助报障',
                          '故障工单（2021版）>>IVR自助报障>>IVR自助报障',
                          '故障工单（2021版）>>全语音门户自助报障los红灯>>全语音门户自助报障los红灯',
                          '故障工单>>宽带报障>>无法上网，LOS灯长亮'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                            "202303", "202304", "202305", "202306")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b;

-- todo 10010-服务态度差投诉率  226 完成
select b.pro_id                                                                    pro_id,
       b.prov_name                                                                 pro_name,
       '00'                                                                        city_id,
       '全省'                                                                      city_name,
       '10010-服务态度差投诉率'                                                    index_name,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select a.prov_name,
             a.prov_code,
             if(a.n is null, 0, a.n) n
      from (select b.prov_code prov_code,
                   b.prov_name prov_name,
                   count(1)    n
            from (select sheet_id,
                         compl_area
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                         "202303", "202304", "202305", "202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>移网>>【变更及服务】渠道服务>>客服热线人员态度差/时效性差',
                          '投诉工单（2021版）>>融合>>【变更及服务】渠道服务>>客服热线人员态度差/时效性差',
                          '投诉工单（2021版）>>宽带>>【变更及服务】渠道服务>>客服热线人员态度差/时效性差'
                            )
                    and sheet_status not in ('8', '11')) a
                     left join dc_dim.dim_pro_city_regoin_cb b on
                a.compl_area = b.code_value
            group by b.prov_code,
                     b.prov_name) a) a
         right join (select substr(prov_id, 2, 3)          pro_id,
                            prov_name,
                            cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                            "202303", "202304", "202305", "202306")
                       and kpi_code in ('CKP_66829', '-')
                       and city_id != '-1'
                     group by prov_id,
                              prov_name) b on
            a.prov_code = b.pro_id
        and a.prov_name = b.prov_name
where b.prov_name is not null
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '10010-服务态度差投诉率'                                                    index_name,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                         "202303", "202304", "202305", "202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>移网>>【变更及服务】渠道服务>>客服热线人员态度差/时效性差',
                          '投诉工单（2021版）>>融合>>【变更及服务】渠道服务>>客服热线人员态度差/时效性差',
                          '投诉工单（2021版）>>宽带>>【变更及服务】渠道服务>>客服热线人员态度差/时效性差'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                            "202303", "202304", "202305", "202306")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b;


-- todo 联通APP-服务能力不足办理不成功投诉率 228 完成
select b.pro_id                                                                    pro_id,
       b.prov_name                                                                 pro_name,
       '00'                                                                        city_id,
       '全省'                                                                      city_name,
       '联通APP-服务能力不足办理不成功投诉率'                                      index_name,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select a.prov_name,
             a.prov_code,
             if(a.n is null, 0, a.n) n
      from (select b.prov_code prov_code,
                   b.prov_name prov_name,
                   count(1)    n
            from (select sheet_id,
                         compl_area
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                         "202303", "202304", "202305", "202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>移网>>【入网】办理>>手、网、短、微厅（含公众号）办理差错/不成功',
                          '投诉工单（2021版）>>移网>>【变更及服务】业务变更>>无法在手网厅办理业务变更',
                          '投诉工单（2021版）>>移网>>【变更及服务】渠道服务>>手、网、短、微厅（含公众号）办理不成功',
                          '投诉工单（2021版）>>融合>>【入网】咨询>>手、网、短、微厅（含公众号）办理进度无法查询',
                          '投诉工单（2021版）>>融合>>【入网】办理>>手、网、短、微厅（含公众号）办理差错/不成功',
                          '投诉工单（2021版）>>融合>>【变更及服务】业务变更>>无法在手网厅办理业务变更',
                          '投诉工单（2021版）>>融合>>【变更及服务】渠道服务>>手、网、短、微厅（含公众号）办理不成功',
                          '投诉工单（2021版）>>宽带>>【入网】咨询>>手、网、短、微厅（含公众号）办理进度无法查询',
                          '投诉工单（2021版）>>宽带>>【入网】办理>>手、网、短、微厅（含公众号）办理差错/不成功',
                          '投诉工单（2021版）>>宽带>>【变更及服务】业务变更>>无法在手网厅办理业务变更',
                          '投诉工单（2021版）>>宽带>>【变更及服务】渠道服务>>手、网、短、微厅（含公众号）办理不成功',
                          '投诉工单（2021版）>>移网>>【变更及服务】渠道服务>>热线转人工困难',
                          '投诉工单（2021版）>>融合>>【变更及服务】渠道服务>>热线转人工困难',
                          '投诉工单（2021版）>>宽带>>【变更及服务】渠道服务>>热线转人工困难'
                            )
                    and sheet_status not in ('8', '11')) a
                     left join dc_dim.dim_pro_city_regoin_cb b on
                a.compl_area = b.code_value
            group by b.prov_code,
                     b.prov_name) a) a
         right join (select substr(prov_id, 2, 3)          pro_id,
                            prov_name,
                            cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                            "202303", "202304", "202305", "202306")
                       and kpi_code in ('CKP_66829', '-')
                       and city_id != '-1'
                     group by prov_id,
                              prov_name) b on
            a.prov_code = b.pro_id
        and a.prov_name = b.prov_name
where b.prov_name is not null
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '联通APP-服务能力不足办理不成功投诉率'                                      index_name,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                         "202303", "202304", "202305", "202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>移网>>【入网】办理>>手、网、短、微厅（含公众号）办理差错/不成功',
                          '投诉工单（2021版）>>移网>>【变更及服务】业务变更>>无法在手网厅办理业务变更',
                          '投诉工单（2021版）>>移网>>【变更及服务】渠道服务>>手、网、短、微厅（含公众号）办理不成功',
                          '投诉工单（2021版）>>融合>>【入网】咨询>>手、网、短、微厅（含公众号）办理进度无法查询',
                          '投诉工单（2021版）>>融合>>【入网】办理>>手、网、短、微厅（含公众号）办理差错/不成功',
                          '投诉工单（2021版）>>融合>>【变更及服务】业务变更>>无法在手网厅办理业务变更',
                          '投诉工单（2021版）>>融合>>【变更及服务】渠道服务>>手、网、短、微厅（含公众号）办理不成功',
                          '投诉工单（2021版）>>宽带>>【入网】咨询>>手、网、短、微厅（含公众号）办理进度无法查询',
                          '投诉工单（2021版）>>宽带>>【入网】办理>>手、网、短、微厅（含公众号）办理差错/不成功',
                          '投诉工单（2021版）>>宽带>>【变更及服务】业务变更>>无法在手网厅办理业务变更',
                          '投诉工单（2021版）>>宽带>>【变更及服务】渠道服务>>手、网、短、微厅（含公众号）办理不成功',
                          '投诉工单（2021版）>>移网>>【变更及服务】渠道服务>>热线转人工困难',
                          '投诉工单（2021版）>>融合>>【变更及服务】渠道服务>>热线转人工困难',
                          '投诉工单（2021版）>>宽带>>【变更及服务】渠道服务>>热线转人工困难'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                            "202303", "202304", "202305", "202306")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b;

-- todo 资费整体投诉率 229 完成
select b.pro_id                                                                    pro_id,
       b.prov_name                                                                 pro_name,
       '00'                                                                        city_id,
       '全省'                                                                      city_name,
       '资费整体投诉率'                                                            index_name,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select a.prov_name,
             a.prov_code,
             if(a.n is null, 0, a.n) n
      from (select b.prov_code prov_code,
                   b.prov_name prov_name,
                   count(1)    n
            from (select sheet_id,
                         compl_area
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                         "202303", "202304", "202305", "202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>移网>>【入网】宣传>>活动、资费宣传不清晰/模糊宣传',
                          '投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>套餐资费不优惠',
                          '投诉工单（2021版）>>移网>>【入网】咨询>>资费政策不清晰/不便于理解',
                          '投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>套餐资费不优惠',
                          '投诉工单（2021版）>>融合>>【入网】宣传>>活动、资费宣传不清晰/模糊宣传',
                          '投诉工单（2021版）>>移网>>【入网】宣传>>资费未明示',
                          '投诉工单（2021版）>>融合>>【入网】咨询>>资费政策不清晰/不便于理解',
                          '投诉工单（2021版）>>宽带>>【入网】咨询>>资费政策不清晰/不便于理解',
                          '投诉工单（2021版）>>宽带>>【产品及计费使用】产品及业务规则>>套餐资费不优惠',
                          '投诉工单（2021版）>>宽带>>【入网】宣传>>活动、资费宣传不清晰/模糊宣传',
                          '投诉工单（2021版）>>融合>>【入网】装机>>资费不优惠',
                          '投诉工单（2021版）>>宽带>>【入网】装机>>资费不优惠',
                          '投诉工单（2021版）>>融合>>【入网】宣传>>资费未明示',
                          '投诉工单（2021版）>>宽带>>【入网】宣传>>资费未明示'
                            )
                    and sheet_status not in ('8', '11')) a
                     left join dc_dim.dim_pro_city_regoin_cb b on
                a.compl_area = b.code_value
            group by b.prov_code,
                     b.prov_name) a) a
         right join (select substr(prov_id, 2, 3)          pro_id,
                            prov_name,
                            cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                            "202303", "202304", "202305", "202306")
                       and kpi_code in ('CKP_66829', '-')
                       and city_id != '-1'
                     group by prov_id,
                              prov_name) b on
            a.prov_code = b.pro_id
        and a.prov_name = b.prov_name
where b.prov_name is not null
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '资费整体投诉率'                                                            index_name,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                         "202303", "202304", "202305", "202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>移网>>【入网】宣传>>活动、资费宣传不清晰/模糊宣传',
                          '投诉工单（2021版）>>移网>>【产品及计费使用】产品及业务规则>>套餐资费不优惠',
                          '投诉工单（2021版）>>移网>>【入网】咨询>>资费政策不清晰/不便于理解',
                          '投诉工单（2021版）>>融合>>【产品及计费使用】产品及业务规则>>套餐资费不优惠',
                          '投诉工单（2021版）>>融合>>【入网】宣传>>活动、资费宣传不清晰/模糊宣传',
                          '投诉工单（2021版）>>移网>>【入网】宣传>>资费未明示',
                          '投诉工单（2021版）>>融合>>【入网】咨询>>资费政策不清晰/不便于理解',
                          '投诉工单（2021版）>>宽带>>【入网】咨询>>资费政策不清晰/不便于理解',
                          '投诉工单（2021版）>>宽带>>【产品及计费使用】产品及业务规则>>套餐资费不优惠',
                          '投诉工单（2021版）>>宽带>>【入网】宣传>>活动、资费宣传不清晰/模糊宣传',
                          '投诉工单（2021版）>>融合>>【入网】装机>>资费不优惠',
                          '投诉工单（2021版）>>宽带>>【入网】装机>>资费不优惠',
                          '投诉工单（2021版）>>融合>>【入网】宣传>>资费未明示',
                          '投诉工单（2021版）>>宽带>>【入网】宣传>>资费未明示'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                            "202303", "202304", "202305", "202306")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b;

-- todo 计收费投诉率 231 完成
select b.pro_id                                                                    pro_id,
       b.prov_name                                                                 pro_name,
       '00'                                                                        city_id,
       '全省'                                                                      city_name,
       '计收费投诉率'                                                              index_name,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select a.prov_name,
             a.prov_code,
             if(a.n is null, 0, a.n) n
      from (select b.prov_code prov_code,
                   b.prov_name prov_name,
                   count(1)    n
            from (select sheet_id,
                         compl_area
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                         "202303", "202304", "202305", "202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>移网>>【产品及计费使用】计交费及发票>>套内外流量费用争议',
                          '投诉工单（2021版）>>移网>>【产品及计费使用】计交费及发票>>增值业务计费争议',
                          '投诉工单（2021版）>>移网>>【产品及计费使用】计交费及发票>>对套餐/月租费不认可',
                          '投诉工单（2021版）>>移网>>【产品及计费使用】计交费及发票>>流量包费用争议',
                          '投诉工单（2021版）>>融合>>【产品及计费使用】计交费及发票>>套内外流量费用争议',
                          '投诉工单（2021版）>>融合>>【产品及计费使用】计交费及发票>>增值业务计费争议',
                          '投诉工单（2021版）>>融合>>【产品及计费使用】计交费及发票>>对套餐/月租费不认可',
                          '投诉工单（2021版）>>移网>>【产品及计费使用】计交费及发票>>交费未到账或到账不及时（含错充）',
                          '投诉工单（2021版）>>宽带>>【产品及计费使用】计交费及发票>>宽带资费争议',
                          '投诉工单（2021版）>>移网>>【产品及计费使用】计交费及发票>>合约赠款或返费不及时/未到账',
                          '投诉工单（2021版）>>移网>>【产品及计费使用】计交费及发票>>对滞纳金/历史欠费/违约金有争议',
                          '投诉工单（2021版）>>融合>>【产品及计费使用】计交费及发票>>流量包费用争议',
                          '投诉工单（2021版）>>移网>>【产品及计费使用】计交费及发票>>亲情网（亲情号）/小区优惠/VPN虚拟网（含集团网）的计费异议',
                          '投诉工单（2021版）>>宽带>>【产品及计费使用】计交费及发票>>增值业务计费争议',
                          '投诉工单（2021版）>>融合>>【产品及计费使用】计交费及发票>>合约赠款或返费不及时/未到账',
                          '投诉工单（2021版）>>融合>>【产品及计费使用】计交费及发票>>交费未到账或到账不及时（含错充）',
                          '投诉工单（2021版）>>融合>>【产品及计费使用】计交费及发票>>对滞纳金/历史欠费/违约金有争议',
                          '投诉工单（2021版）>>移网>>【产品及计费使用】计交费及发票>>一次性费用争议（开户费/补卡费/初装费/调测费/押金等）',
                          '投诉工单（2021版）>>融合>>【产品及计费使用】计交费及发票>>一次性费用争议（开户费/补卡费/初装费/调测费/押金等）',
                          '投诉工单（2021版）>>移网>>【产品及计费使用】计交费及发票>>国际业务计费争议',
                          '投诉工单（2021版）>>宽带>>【产品及计费使用】计交费及发票>>一次性费用争议（开户费/补卡费/初装费/调测费/押金等）',
                          '投诉工单（2021版）>>宽带>>【产品及计费使用】计交费及发票>>对滞纳金/历史欠费/违约金有争议',
                          '投诉工单（2021版）>>宽带>>【产品及计费使用】计交费及发票>>对趸交包年到期转包月费用不认可',
                          '投诉工单（2021版）>>宽带>>【产品及计费使用】计交费及发票>>交费未到账或到账不及时（含错充）',
                          '投诉工单（2021版）>>融合>>【产品及计费使用】计交费及发票>>国际业务计费争议',
                          '投诉工单（2021版）>>融合>>【IPTV使用】IPTV>>IPTV收费争议',
                          '投诉工单（2021版）>>宽带>>【IPTV使用】IPTV>>IPTV收费争议'
                            )
                    and sheet_status not in ('8', '11')) a
                     left join dc_dim.dim_pro_city_regoin_cb b on
                a.compl_area = b.code_value
            group by b.prov_code,
                     b.prov_name) a) a
         right join (select substr(prov_id, 2, 3)          pro_id,
                            prov_name,
                            cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                            "202303", "202304", "202305", "202306")
                       and kpi_code in ('CKP_66829', '-')
                       and city_id != '-1'
                     group by prov_id,
                              prov_name) b on
            a.prov_code = b.pro_id
        and a.prov_name = b.prov_name
where b.prov_name is not null
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '计收费投诉率'                                                              index_name,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                         "202303", "202304", "202305", "202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>移网>>【产品及计费使用】计交费及发票>>套内外流量费用争议',
                          '投诉工单（2021版）>>移网>>【产品及计费使用】计交费及发票>>增值业务计费争议',
                          '投诉工单（2021版）>>移网>>【产品及计费使用】计交费及发票>>对套餐/月租费不认可',
                          '投诉工单（2021版）>>移网>>【产品及计费使用】计交费及发票>>流量包费用争议',
                          '投诉工单（2021版）>>融合>>【产品及计费使用】计交费及发票>>套内外流量费用争议',
                          '投诉工单（2021版）>>融合>>【产品及计费使用】计交费及发票>>增值业务计费争议',
                          '投诉工单（2021版）>>融合>>【产品及计费使用】计交费及发票>>对套餐/月租费不认可',
                          '投诉工单（2021版）>>移网>>【产品及计费使用】计交费及发票>>交费未到账或到账不及时（含错充）',
                          '投诉工单（2021版）>>宽带>>【产品及计费使用】计交费及发票>>宽带资费争议',
                          '投诉工单（2021版）>>移网>>【产品及计费使用】计交费及发票>>合约赠款或返费不及时/未到账',
                          '投诉工单（2021版）>>移网>>【产品及计费使用】计交费及发票>>对滞纳金/历史欠费/违约金有争议',
                          '投诉工单（2021版）>>融合>>【产品及计费使用】计交费及发票>>流量包费用争议',
                          '投诉工单（2021版）>>移网>>【产品及计费使用】计交费及发票>>亲情网（亲情号）/小区优惠/VPN虚拟网（含集团网）的计费异议',
                          '投诉工单（2021版）>>宽带>>【产品及计费使用】计交费及发票>>增值业务计费争议',
                          '投诉工单（2021版）>>融合>>【产品及计费使用】计交费及发票>>合约赠款或返费不及时/未到账',
                          '投诉工单（2021版）>>融合>>【产品及计费使用】计交费及发票>>交费未到账或到账不及时（含错充）',
                          '投诉工单（2021版）>>融合>>【产品及计费使用】计交费及发票>>对滞纳金/历史欠费/违约金有争议',
                          '投诉工单（2021版）>>移网>>【产品及计费使用】计交费及发票>>一次性费用争议（开户费/补卡费/初装费/调测费/押金等）',
                          '投诉工单（2021版）>>融合>>【产品及计费使用】计交费及发票>>一次性费用争议（开户费/补卡费/初装费/调测费/押金等）',
                          '投诉工单（2021版）>>移网>>【产品及计费使用】计交费及发票>>国际业务计费争议',
                          '投诉工单（2021版）>>宽带>>【产品及计费使用】计交费及发票>>一次性费用争议（开户费/补卡费/初装费/调测费/押金等）',
                          '投诉工单（2021版）>>宽带>>【产品及计费使用】计交费及发票>>对滞纳金/历史欠费/违约金有争议',
                          '投诉工单（2021版）>>宽带>>【产品及计费使用】计交费及发票>>对趸交包年到期转包月费用不认可',
                          '投诉工单（2021版）>>宽带>>【产品及计费使用】计交费及发票>>交费未到账或到账不及时（含错充）',
                          '投诉工单（2021版）>>融合>>【产品及计费使用】计交费及发票>>国际业务计费争议',
                          '投诉工单（2021版）>>融合>>【IPTV使用】IPTV>>IPTV收费争议',
                          '投诉工单（2021版）>>宽带>>【IPTV使用】IPTV>>IPTV收费争议'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                            "202303", "202304", "202305", "202306")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b;

-- todo 账单投诉率 233 完成
select b.pro_id                                                                    pro_id,
       b.prov_name                                                                 pro_name,
       '00'                                                                        city_id,
       '全省'                                                                      city_name,
       '账单投诉率'                                                                index_name,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select a.prov_name,
             a.prov_code,
             if(a.n is null, 0, a.n) n
      from (select b.prov_code prov_code,
                   b.prov_name prov_name,
                   count(1)    n
            from (select sheet_id,
                         compl_area
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                         "202303", "202304", "202305", "202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>移网>>【产品及计费使用】账单>>账详单内容不清晰/看不懂',
                          '投诉工单（2021版）>>融合>>【产品及计费使用】账单>>账详单内容不清晰/看不懂',
                          '投诉工单（2021版）>>移网>>【产品及计费使用】账单>>内容有误/查询结果不一致',
                          '投诉工单（2021版）>>移网>>【产品及计费使用】账单>>账单信息告知不及时/未收到',
                          '投诉工单（2021版）>>宽带>>【产品及计费使用】账单>>账详单内容不清晰/看不懂',
                          '投诉工单（2021版）>>融合>>【产品及计费使用】账单>>内容有误/查询结果不一致',
                          '投诉工单（2021版）>>移网>>【产品及计费使用】账单>>对出账期无法查询账详单不满',
                          '投诉工单（2021版）>>移网>>【产品及计费使用】账单>>获取不便捷/不成功',
                          '投诉工单（2021版）>>融合>>【产品及计费使用】账单>>对出账期无法查询账详单不满',
                          '投诉工单（2021版）>>融合>>【产品及计费使用】账单>>账单信息告知不及时/未收到',
                          '投诉工单（2021版）>>宽带>>【产品及计费使用】账单>>内容有误/查询结果不一致',
                          '投诉工单（2021版）>>融合>>【产品及计费使用】账单>>获取不便捷/不成功',
                          '投诉工单（2021版）>>宽带>>【产品及计费使用】账单>>账单信息告知不及时/未收到'
                            )
                    and sheet_status not in ('8', '11')) a
                     left join dc_dim.dim_pro_city_regoin_cb b on
                a.compl_area = b.code_value
            group by b.prov_code,
                     b.prov_name) a) a
         right join (select substr(prov_id, 2, 3)          pro_id,
                            prov_name,
                            cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                            "202303", "202304", "202305", "202306")
                       and kpi_code in ('CKP_66829', '-')
                       and city_id != '-1'
                     group by prov_id,
                              prov_name) b on
            a.prov_code = b.pro_id
        and a.prov_name = b.prov_name
where b.prov_name is not null
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '账单投诉率'                                                                index_name,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                         "202303", "202304", "202305", "202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>移网>>【产品及计费使用】账单>>账详单内容不清晰/看不懂',
                          '投诉工单（2021版）>>融合>>【产品及计费使用】账单>>账详单内容不清晰/看不懂',
                          '投诉工单（2021版）>>移网>>【产品及计费使用】账单>>内容有误/查询结果不一致',
                          '投诉工单（2021版）>>移网>>【产品及计费使用】账单>>账单信息告知不及时/未收到',
                          '投诉工单（2021版）>>宽带>>【产品及计费使用】账单>>账详单内容不清晰/看不懂',
                          '投诉工单（2021版）>>融合>>【产品及计费使用】账单>>内容有误/查询结果不一致',
                          '投诉工单（2021版）>>移网>>【产品及计费使用】账单>>对出账期无法查询账详单不满',
                          '投诉工单（2021版）>>移网>>【产品及计费使用】账单>>获取不便捷/不成功',
                          '投诉工单（2021版）>>融合>>【产品及计费使用】账单>>对出账期无法查询账详单不满',
                          '投诉工单（2021版）>>融合>>【产品及计费使用】账单>>账单信息告知不及时/未收到',
                          '投诉工单（2021版）>>宽带>>【产品及计费使用】账单>>内容有误/查询结果不一致',
                          '投诉工单（2021版）>>融合>>【产品及计费使用】账单>>获取不便捷/不成功',
                          '投诉工单（2021版）>>宽带>>【产品及计费使用】账单>>账单信息告知不及时/未收到'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                            "202303", "202304", "202305", "202306")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b;

-- todo 发票投诉率 234 完成
select b.pro_id                                                                    pro_id,
       b.prov_name                                                                 pro_name,
       '00'                                                                        city_id,
       '全省'                                                                      city_name,
       '发票投诉率'                                                                index_name,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select a.prov_name,
             a.prov_code,
             if(a.n is null, 0, a.n) n
      from (select b.prov_code prov_code,
                   b.prov_name prov_name,
                   count(1)    n
            from (select sheet_id,
                         compl_area
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                         "202303", "202304", "202305", "202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>移网>>【产品及计费使用】计交费及发票>>电子发票获取不便捷/不成功',
                          '投诉工单（2021版）>>移网>>【产品及计费使用】计交费及发票>>无法打印发票、额度不足等',
                          '投诉工单（2021版）>>融合>>【产品及计费使用】计交费及发票>>电子发票获取不便捷/不成功',
                          '投诉工单（2021版）>>融合>>【产品及计费使用】计交费及发票>>无法打印发票、额度不足等',
                          '投诉工单（2021版）>>宽带>>【产品及计费使用】计交费及发票>>电子发票获取不便捷/不成功',
                          '投诉工单（2021版）>>移网>>【产品及计费使用】计交费及发票>>发票不明晰看不懂',
                          '投诉工单（2021版）>>移网>>【产品及计费使用】计交费及发票>>手厅无法打开发票页面',
                          '投诉工单（2021版）>>宽带>>【产品及计费使用】计交费及发票>>无法打印发票、额度不足等',
                          '投诉工单（2021版）>>融合>>【产品及计费使用】计交费及发票>>发票不明晰看不懂',
                          '投诉工单（2021版）>>融合>>【产品及计费使用】计交费及发票>>手厅无法打开发票页面',
                          '投诉工单（2021版）>>宽带>>【产品及计费使用】计交费及发票>>发票不明晰看不懂',
                          '投诉工单（2021版）>>宽带>>【产品及计费使用】计交费及发票>>手厅无法打开发票页面'
                            )
                    and sheet_status not in ('8', '11')) a
                     left join dc_dim.dim_pro_city_regoin_cb b on
                a.compl_area = b.code_value
            group by b.prov_code,
                     b.prov_name) a) a
         right join (select substr(prov_id, 2, 3)          pro_id,
                            prov_name,
                            cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                            "202303", "202304", "202305", "202306")
                       and kpi_code in ('CKP_66829', '-')
                       and city_id != '-1'
                     group by prov_id,
                              prov_name) b on
            a.prov_code = b.pro_id
        and a.prov_name = b.prov_name
where b.prov_name is not null
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '发票投诉率'                                                                index_name,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                         "202303", "202304", "202305", "202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>移网>>【产品及计费使用】计交费及发票>>电子发票获取不便捷/不成功',
                          '投诉工单（2021版）>>移网>>【产品及计费使用】计交费及发票>>无法打印发票、额度不足等',
                          '投诉工单（2021版）>>融合>>【产品及计费使用】计交费及发票>>电子发票获取不便捷/不成功',
                          '投诉工单（2021版）>>融合>>【产品及计费使用】计交费及发票>>无法打印发票、额度不足等',
                          '投诉工单（2021版）>>宽带>>【产品及计费使用】计交费及发票>>电子发票获取不便捷/不成功',
                          '投诉工单（2021版）>>移网>>【产品及计费使用】计交费及发票>>发票不明晰看不懂',
                          '投诉工单（2021版）>>移网>>【产品及计费使用】计交费及发票>>手厅无法打开发票页面',
                          '投诉工单（2021版）>>宽带>>【产品及计费使用】计交费及发票>>无法打印发票、额度不足等',
                          '投诉工单（2021版）>>融合>>【产品及计费使用】计交费及发票>>发票不明晰看不懂',
                          '投诉工单（2021版）>>融合>>【产品及计费使用】计交费及发票>>手厅无法打开发票页面',
                          '投诉工单（2021版）>>宽带>>【产品及计费使用】计交费及发票>>发票不明晰看不懂',
                          '投诉工单（2021版）>>宽带>>【产品及计费使用】计交费及发票>>手厅无法打开发票页面'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                            "202303", "202304", "202305", "202306")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b;

-- todo 交费后不开机/无法使用投诉率 236 完成
select b.pro_id                                                                    pro_id,
       b.prov_name                                                                 pro_name,
       '00'                                                                        city_id,
       '全省'                                                                      city_name,
       '交费后不开机/无法使用投诉率'                                               index_name,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select a.prov_name,
             a.prov_code,
             if(a.n is null, 0, a.n) n
      from (select b.prov_code prov_code,
                   b.prov_name prov_name,
                   count(1)    n
            from (select sheet_id,
                         compl_area
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                         "202303", "202304", "202305", "202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>移网>>【产品及计费使用】计交费及发票>>突发故障',
                          '投诉工单（2021版）>>融合>>【产品及计费使用】计交费及发票>>突发故障',
                          '投诉工单（2021版）>>宽带>>【产品及计费使用】计交费及发票>>宽带欠费停机缴费后仍无法使用',
                          '投诉工单（2021版）>>融合>>【产品及计费使用】计交费及发票>>宽带欠费停机缴费后仍无法使用'
                            )
                    and sheet_status not in ('8', '11')) a
                     left join dc_dim.dim_pro_city_regoin_cb b on
                a.compl_area = b.code_value
            group by b.prov_code,
                     b.prov_name) a) a
         right join (select substr(prov_id, 2, 3)          pro_id,
                            prov_name,
                            cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                            "202303", "202304", "202305", "202306")
                       and kpi_code in ('CKP_66829', '-')
                       and city_id != '-1'
                     group by prov_id,
                              prov_name) b on
            a.prov_code = b.pro_id
        and a.prov_name = b.prov_name
where b.prov_name is not null
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '交费后不开机/无法使用投诉率'                                               index_name,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                         "202303", "202304", "202305", "202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>移网>>【产品及计费使用】计交费及发票>>突发故障',
                          '投诉工单（2021版）>>融合>>【产品及计费使用】计交费及发票>>突发故障',
                          '投诉工单（2021版）>>宽带>>【产品及计费使用】计交费及发票>>宽带欠费停机缴费后仍无法使用',
                          '投诉工单（2021版）>>融合>>【产品及计费使用】计交费及发票>>宽带欠费停机缴费后仍无法使用'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                            "202303", "202304", "202305", "202306")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b;

-- todo 销户拆机投诉率 237 完成
select b.pro_id                                                                    pro_id,
       b.prov_name                                                                 pro_name,
       '00'                                                                        city_id,
       '全省'                                                                      city_name,
       '销户拆机投诉率'                                                            index_name,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select a.prov_name,
             a.prov_code,
             if(a.n is null, 0, a.n) n
      from (select b.prov_code prov_code,
                   b.prov_name prov_name,
                   count(1)    n
            from (select sheet_id,
                         compl_area
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                         "202303", "202304", "202305", "202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>移网>>【离网】离网（离网+拆机+销户）>>无法销户',
                          '投诉工单（2021版）>>移网>>【离网】离网（离网+拆机+销户）>>销户无法退费/无法当时退费',
                          '投诉工单（2021版）>>融合>>【离网】离网（离网+拆机+销户）>>无法销户',
                          '投诉工单（2021版）>>移网>>【离网】离网（离网+拆机+销户）>>对滞纳金/历史欠费/违约金有争议',
                          '投诉工单（2021版）>>移网>>【离网】离网（离网+拆机+销户）>>无法线上办理销户',
                          '投诉工单（2021版）>>宽带>>【离网】离网（离网+拆机+销户）>>无法销户',
                          '投诉工单（2021版）>>移网>>【离网】离网（离网+拆机+销户）>>销户时未结清欠费',
                          '投诉工单（2021版）>>移网>>【离网】离网（离网+拆机+销户）>>被销户不知情',
                          '投诉工单（2021版）>>融合>>【离网】离网（离网+拆机+销户）>>无法线上办理销户/拆机',
                          '投诉工单（2021版）>>移网>>【离网】离网（离网+拆机+销户）>>对销户无法复装不满',
                          '投诉工单（2021版）>>融合>>【离网】离网（离网+拆机+销户）>>对滞纳金/历史欠费/违约金有争议',
                          '投诉工单（2021版）>>宽带>>【离网】离网（离网+拆机+销户）>>对滞纳金/历史欠费/违约金有争议',
                          '投诉工单（2021版）>>宽带>>【离网】离网（离网+拆机+销户）>>无法线上办理拆机',
                          '投诉工单（2021版）>>融合>>【离网】离网（离网+拆机+销户）>>被销户不知情',
                          '投诉工单（2021版）>>融合>>【离网】离网（离网+拆机+销户）>>拆机需交还设备',
                          '投诉工单（2021版）>>融合>>【离网】离网（离网+拆机+销户）>>销户无法退费/无法当时退费',
                          '投诉工单（2021版）>>宽带>>【离网】离网（离网+拆机+销户）>>被销户不知情',
                          '投诉工单（2021版）>>宽带>>【离网】离网（离网+拆机+销户）>>销户无法退费/无法当时退费',
                          '投诉工单（2021版）>>移网>>【离网】离网（离网+拆机+销户）>>销户必须回号卡归属地办理',
                          '投诉工单（2021版）>>融合>>【离网】离网（离网+拆机+销户）>>销户必须回号卡归属地办理',
                          '投诉工单（2021版）>>移网>>【离网】离网（离网+拆机+销户）>>对手厅单卡销户时长不满',
                          '投诉工单（2021版）>>宽带>>【离网】离网（离网+拆机+销户）>>拆机需交还设备',
                          '投诉工单（2021版）>>融合>>【离网】离网（离网+拆机+销户）>>销户时未结清欠费',
                          '投诉工单（2021版）>>移网>>【离网】离网（离网+拆机+销户）>>销户拆机状态播报与实际不符',
                          '投诉工单（2021版）>>宽带>>【离网】离网（离网+拆机+销户）>>销户时未结清欠费',
                          '投诉工单（2021版）>>移网>>【离网】离网（离网+拆机+销户）>>esim销户问题',
                          '投诉工单（2021版）>>融合>>【离网】离网（离网+拆机+销户）>>对销户无法复装不满',
                          '投诉工单（2021版）>>融合>>【离网】离网（离网+拆机+销户）>>宽带拆机当月收取整月费用不认可',
                          '投诉工单（2021版）>>宽带>>【离网】离网（离网+拆机+销户）>>宽带拆机当月收取整月费用不认可',
                          '投诉工单（2021版）>>融合>>【离网】离网（离网+拆机+销户）>>跨域不能取消融合业务',
                          '投诉工单（2021版）>>融合>>【离网】离网（离网+拆机+销户）>>销户拆机状态播报与实际不符',
                          '投诉工单（2021版）>>融合>>【离网】离网（离网+拆机+销户）>>esim销户问题'
                            )
                    and sheet_status not in ('8', '11')) a
                     left join dc_dim.dim_pro_city_regoin_cb b on
                a.compl_area = b.code_value
            group by b.prov_code,
                     b.prov_name) a) a
         right join (select substr(prov_id, 2, 3)          pro_id,
                            prov_name,
                            cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                            "202303", "202304", "202305", "202306")
                       and kpi_code in ('CKP_66829', '-')
                       and city_id != '-1'
                     group by prov_id,
                              prov_name) b on
            a.prov_code = b.pro_id
        and a.prov_name = b.prov_name
where b.prov_name is not null
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '销户拆机投诉率'                                                            index_name,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                         "202303", "202304", "202305", "202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>移网>>【离网】离网（离网+拆机+销户）>>无法销户',
                          '投诉工单（2021版）>>移网>>【离网】离网（离网+拆机+销户）>>销户无法退费/无法当时退费',
                          '投诉工单（2021版）>>融合>>【离网】离网（离网+拆机+销户）>>无法销户',
                          '投诉工单（2021版）>>移网>>【离网】离网（离网+拆机+销户）>>对滞纳金/历史欠费/违约金有争议',
                          '投诉工单（2021版）>>移网>>【离网】离网（离网+拆机+销户）>>无法线上办理销户',
                          '投诉工单（2021版）>>宽带>>【离网】离网（离网+拆机+销户）>>无法销户',
                          '投诉工单（2021版）>>移网>>【离网】离网（离网+拆机+销户）>>销户时未结清欠费',
                          '投诉工单（2021版）>>移网>>【离网】离网（离网+拆机+销户）>>被销户不知情',
                          '投诉工单（2021版）>>融合>>【离网】离网（离网+拆机+销户）>>无法线上办理销户/拆机',
                          '投诉工单（2021版）>>移网>>【离网】离网（离网+拆机+销户）>>对销户无法复装不满',
                          '投诉工单（2021版）>>融合>>【离网】离网（离网+拆机+销户）>>对滞纳金/历史欠费/违约金有争议',
                          '投诉工单（2021版）>>宽带>>【离网】离网（离网+拆机+销户）>>对滞纳金/历史欠费/违约金有争议',
                          '投诉工单（2021版）>>宽带>>【离网】离网（离网+拆机+销户）>>无法线上办理拆机',
                          '投诉工单（2021版）>>融合>>【离网】离网（离网+拆机+销户）>>被销户不知情',
                          '投诉工单（2021版）>>融合>>【离网】离网（离网+拆机+销户）>>拆机需交还设备',
                          '投诉工单（2021版）>>融合>>【离网】离网（离网+拆机+销户）>>销户无法退费/无法当时退费',
                          '投诉工单（2021版）>>宽带>>【离网】离网（离网+拆机+销户）>>被销户不知情',
                          '投诉工单（2021版）>>宽带>>【离网】离网（离网+拆机+销户）>>销户无法退费/无法当时退费',
                          '投诉工单（2021版）>>移网>>【离网】离网（离网+拆机+销户）>>销户必须回号卡归属地办理',
                          '投诉工单（2021版）>>融合>>【离网】离网（离网+拆机+销户）>>销户必须回号卡归属地办理',
                          '投诉工单（2021版）>>移网>>【离网】离网（离网+拆机+销户）>>对手厅单卡销户时长不满',
                          '投诉工单（2021版）>>宽带>>【离网】离网（离网+拆机+销户）>>拆机需交还设备',
                          '投诉工单（2021版）>>融合>>【离网】离网（离网+拆机+销户）>>销户时未结清欠费',
                          '投诉工单（2021版）>>移网>>【离网】离网（离网+拆机+销户）>>销户拆机状态播报与实际不符',
                          '投诉工单（2021版）>>宽带>>【离网】离网（离网+拆机+销户）>>销户时未结清欠费',
                          '投诉工单（2021版）>>移网>>【离网】离网（离网+拆机+销户）>>esim销户问题',
                          '投诉工单（2021版）>>融合>>【离网】离网（离网+拆机+销户）>>对销户无法复装不满',
                          '投诉工单（2021版）>>融合>>【离网】离网（离网+拆机+销户）>>宽带拆机当月收取整月费用不认可',
                          '投诉工单（2021版）>>宽带>>【离网】离网（离网+拆机+销户）>>宽带拆机当月收取整月费用不认可',
                          '投诉工单（2021版）>>融合>>【离网】离网（离网+拆机+销户）>>跨域不能取消融合业务',
                          '投诉工单（2021版）>>融合>>【离网】离网（离网+拆机+销户）>>销户拆机状态播报与实际不符',
                          '投诉工单（2021版）>>融合>>【离网】离网（离网+拆机+销户）>>esim销户问题'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                            "202303", "202304", "202305", "202306")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b;

-- todo 携出投诉率 238 完成
select b.pro_id                                                                    pro_id,
       b.prov_name                                                                 pro_name,
       '00'                                                                        city_id,
       '全省'                                                                      city_name,
       '携出投诉率'                                                                index_name,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select a.prov_name,
             a.prov_code,
             if(a.n is null, 0, a.n) n
      from (select b.prov_code prov_code,
                   b.prov_name prov_name,
                   count(1)    n
            from (select sheet_id,
                         compl_area
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                         "202303", "202304", "202305", "202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>移网>>【离网】携出>>因合约/业务/套餐限制携出',
                          '投诉工单（2021版）>>移网>>【离网】携出>>办理携出过程中发现有不知情绑定业务',
                          '投诉工单（2021版）>>移网>>【离网】携出>>收不到携转码',
                          '投诉工单（2021版）>>融合>>【离网】携出>>因合约/业务/套餐限制携出',
                          '投诉工单（2021版）>>移网>>【离网】携出>>携出后余额争议问题',
                          '投诉工单（2021版）>>移网>>【离网】携出>>无法线上办理携出',
                          '投诉工单（2021版）>>融合>>【离网】携出>>办理携出过程中发现有不知情绑定业务',
                          '投诉工单（2021版）>>移网>>【离网】携出>>对携出必须本人到指定授权营业厅不满',
                          '投诉工单（2021版）>>融合>>【离网】携出>>对携出必须本人到指定授权营业厅不满',
                          '投诉工单（2021版）>>移网>>【离网】携出>>过度维系挽留',
                          '投诉工单（2021版）>>移网>>【离网】携出>>携出后需满120天后才能重新携转的规则不满',
                          '投诉工单（2021版）>>融合>>【离网】携出>>携出后余额争议问题',
                          '投诉工单（2021版）>>融合>>【离网】携出>>无法线上办理携出',
                          '投诉工单（2021版）>>移网>>【离网】携出>>携出后无法查询历史信息',
                          '投诉工单（2021版）>>融合>>【离网】携出>>携出后需满120天后才能重新携转的规则不满',
                          '投诉工单（2021版）>>融合>>【离网】携出>>携出后无法查询历史信息'
                            )
                    and sheet_status not in ('8', '11')) a
                     left join dc_dim.dim_pro_city_regoin_cb b on
                a.compl_area = b.code_value
            group by b.prov_code,
                     b.prov_name) a) a
         right join (select substr(prov_id, 2, 3)          pro_id,
                            prov_name,
                            cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                            "202303", "202304", "202305", "202306")
                       and kpi_code in ('CKP_66829', '-')
                       and city_id != '-1'
                     group by prov_id,
                              prov_name) b on
            a.prov_code = b.pro_id
        and a.prov_name = b.prov_name
where b.prov_name is not null
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '携出投诉率'                                                                index_name,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                         "202303", "202304", "202305", "202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>移网>>【离网】携出>>因合约/业务/套餐限制携出',
                          '投诉工单（2021版）>>移网>>【离网】携出>>办理携出过程中发现有不知情绑定业务',
                          '投诉工单（2021版）>>移网>>【离网】携出>>收不到携转码',
                          '投诉工单（2021版）>>融合>>【离网】携出>>因合约/业务/套餐限制携出',
                          '投诉工单（2021版）>>移网>>【离网】携出>>携出后余额争议问题',
                          '投诉工单（2021版）>>移网>>【离网】携出>>无法线上办理携出',
                          '投诉工单（2021版）>>融合>>【离网】携出>>办理携出过程中发现有不知情绑定业务',
                          '投诉工单（2021版）>>移网>>【离网】携出>>对携出必须本人到指定授权营业厅不满',
                          '投诉工单（2021版）>>融合>>【离网】携出>>对携出必须本人到指定授权营业厅不满',
                          '投诉工单（2021版）>>移网>>【离网】携出>>过度维系挽留',
                          '投诉工单（2021版）>>移网>>【离网】携出>>携出后需满120天后才能重新携转的规则不满',
                          '投诉工单（2021版）>>融合>>【离网】携出>>携出后余额争议问题',
                          '投诉工单（2021版）>>融合>>【离网】携出>>无法线上办理携出',
                          '投诉工单（2021版）>>移网>>【离网】携出>>携出后无法查询历史信息',
                          '投诉工单（2021版）>>融合>>【离网】携出>>携出后需满120天后才能重新携转的规则不满',
                          '投诉工单（2021版）>>融合>>【离网】携出>>携出后无法查询历史信息'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                            "202303", "202304", "202305", "202306")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b;

-- todo  群发短信投诉率 240

-- todo 移网网络卡顿投诉率 241 完成
select b.pro_id                                                                    pro_id,
       b.prov_name                                                                 pro_name,
       '00'                                                                        city_id,
       '全省'                                                                      city_name,
       '移网网络卡顿投诉率'                                                        index_name,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select a.prov_name,
             a.prov_code,
             if(a.n is null, 0, a.n) n
      from (select b.prov_code prov_code,
                   b.prov_name prov_name,
                   count(1)    n
            from (select sheet_id,
                         compl_area
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                         "202303", "202304", "202305", "202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>移网>>【网络使用】移网上网>>上网卡顿/掉线/延时/信号弱/不稳定/网页无法打开',
                          '投诉工单（2021版）>>融合>>【网络使用】移网上网>>上网卡顿/掉线/延时/信号弱/不稳定/网页无法打开'
                            )
                    and sheet_status not in ('8', '11')) a
                     left join dc_dim.dim_pro_city_regoin_cb b on
                a.compl_area = b.code_value
            group by b.prov_code,
                     b.prov_name) a) a
         right join (select substr(prov_id, 2, 3)          pro_id,
                            prov_name,
                            cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                            "202303", "202304", "202305", "202306")
                       and kpi_code in ('CKP_66829', '-')
                       and city_id != '-1'
                     group by prov_id,
                              prov_name) b on
            a.prov_code = b.pro_id
        and a.prov_name = b.prov_name
where b.prov_name is not null
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '移网网络卡顿投诉率'                                                        index_name,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                         "202303", "202304", "202305", "202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>移网>>【网络使用】移网上网>>上网卡顿/掉线/延时/信号弱/不稳定/网页无法打开',
                          '投诉工单（2021版）>>融合>>【网络使用】移网上网>>上网卡顿/掉线/延时/信号弱/不稳定/网页无法打开'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                            "202303", "202304", "202305", "202306")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b;

-- todo 电话外呼本地投诉率 244 完成
-- 电话外呼投诉率（剔除申诉工单+升级投诉工单）（按办结时间统计）
with t1 as (select bus_pro_id,
                   accu_10010,
                   cz_userscnt / 10000 cz_userscnt
            from (select nvl(compl_prov_name, '全国') bus_pro_id,
                         sum(accu_10010)              accu_10010,
                         sum(accu_10015)              accu_10015
                  from (select sheet_pro_name compl_prov_name,
                               count(
                                       distinct case
                                                    when channel_id in ('01', '02') then sheet_id
                                   end
                                   )          accu_10010, --  日累10010热线投诉  
                               count(
                                       distinct case
                                                    when channel_id = '03' then sheet_id
                                   end
                                   )          accu_10015
                        from dc_dm.dm_d_de_gpzfw_yxcs_acc
                        where month_id in
                              ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                               "202303", "202304", "202305", "202306")
                          and nvl(sheet_pro_name, '') != ''
                          and sheet_type_code in ('01', '04')                     -- 限制工单类型
                          and nvl(serv_content, '') not like '%软研院自动化测试%' -- 剔除掉测试数据
                          and serv_type_name in (
                                                 '投诉工单（2021版）>>移网>>【变更及服务】渠道服务>>电话营销服务人员服务态度/解释不到位',
                                                 '投诉工单（2021版）>>融合>>【变更及服务】渠道服务>>电话营销诱导定制/不知情定制',
                                                 '投诉工单（2021版）>>融合>>【变更及服务】渠道服务>>电话营销服务人员服务态度/解释不到位',
                                                 '投诉工单（2021版）>>宽带>>【变更及服务】渠道服务>>电话营销诱导定制/不知情定制',
                                                 '投诉工单（2021版）>>宽带>>【变更及服务】渠道服务>>电话营销服务人员服务态度/解释不到位',
                                                 '投诉工单（2021版）>>移网>>【变更及服务】增值或权益业务使用>>营销无故开通',
                                                 '投诉工单（2021版）>>融合>>【变更及服务】增值或权益业务使用>>营销无故开通',
                                                 '投诉工单（2021版）>>移网>>【变更及服务】渠道服务>>被联通营销行为骚扰',
                                                 '投诉工单（2021版）>>融合>>【变更及服务】渠道服务>>被联通营销行为骚扰',
                                                 '投诉工单（2021版）>>移网>>【变更及服务】渠道服务>>电话营销诱导定制/不知情定制'
                            )
                        group by sheet_pro_name) t
                  group by compl_prov_name grouping sets ((), ( compl_prov_name))) tab
                     left join (select *
                                from dc_dm.dm_m_gpzfw_cz_users_type_amount
                                where month_id in
                                      ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                                       "202303", "202304", "202305", "202306")
                                  and cz_type_id = 'CZ07'
                                  and area_name = '全部') tab1 on tab.bus_pro_id = tab1.pro_name)
select bus_pro_id, sum(accu_10010), sum(cz_userscnt), '电话外呼本地投诉率' as zb_name
from t1
group by bus_pro_id;

-- todo 电话外呼升级投诉量 245
-- 电话外呼升级投诉量；电话外呼10类投诉标签工单类型名称：
select nvl(compl_prov_name, '全国') bus_pro_id,
       sum(accu_10015)              accu_10015
from (select sheet_pro_name compl_prov_name,
             count(
                     distinct case
                                  when channel_id in ('01', '02') then sheet_id
                 end
                 )          accu_10010, --  日累10010热线投诉  
             count(
                     distinct case
                                  when channel_id = '03' then sheet_id
                 end
                 )          accu_10015
      from dc_dm.dm_d_de_gpzfw_yxcs_acc
      where month_id in
            ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
             "202303", "202304", "202305", "202306")
        and nvl(sheet_pro_name, '') != ''
        and sheet_type_code in ('01', '04')                     -- 限制工单类型
        and nvl(serv_content, '') not like '%软研院自动化测试%' -- 剔除掉测试数据
        and serv_type_name in (
                               '投诉工单（2021版）>>移网>>【变更及服务】渠道服务>>电话营销服务人员服务态度/解释不到位',
                               '投诉工单（2021版）>>融合>>【变更及服务】渠道服务>>电话营销诱导定制/不知情定制',
                               '投诉工单（2021版）>>融合>>【变更及服务】渠道服务>>电话营销服务人员服务态度/解释不到位',
                               '投诉工单（2021版）>>宽带>>【变更及服务】渠道服务>>电话营销诱导定制/不知情定制',
                               '投诉工单（2021版）>>宽带>>【变更及服务】渠道服务>>电话营销服务人员服务态度/解释不到位',
                               '投诉工单（2021版）>>移网>>【变更及服务】增值或权益业务使用>>营销无故开通',
                               '投诉工单（2021版）>>融合>>【变更及服务】增值或权益业务使用>>营销无故开通',
                               '投诉工单（2021版）>>移网>>【变更及服务】渠道服务>>被联通营销行为骚扰',
                               '投诉工单（2021版）>>融合>>【变更及服务】渠道服务>>被联通营销行为骚扰',
                               '投诉工单（2021版）>>移网>>【变更及服务】渠道服务>>电话营销诱导定制/不知情定制'
          )
      group by sheet_pro_name) t
group by compl_prov_name;

-- todo 外呼打扰投诉率 247 完成
select b.pro_id                                                                    pro_id,
       b.prov_name                                                                 pro_name,
       '00'                                                                        city_id,
       '全省'                                                                      city_name,
       '外呼打扰投诉率'                                                            index_name,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select a.prov_name,
             a.prov_code,
             if(a.n is null, 0, a.n) n
      from (select b.prov_code prov_code,
                   b.prov_name prov_name,
                   count(1)    n
            from (select sheet_id,
                         compl_area
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                         "202303", "202304", "202305", "202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>移网>>【变更及服务】渠道服务>>被联通营销行为骚扰',
                          '投诉工单（2021版）>>融合>>【变更及服务】渠道服务>>被联通营销行为骚扰'
                            )
                    and sheet_status not in ('8', '11')) a
                     left join dc_dim.dim_pro_city_regoin_cb b on
                a.compl_area = b.code_value
            group by b.prov_code,
                     b.prov_name) a) a
         right join (select substr(prov_id, 2, 3)          pro_id,
                            prov_name,
                            cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                            "202303", "202304", "202305", "202306")
                       and kpi_code in ('CKP_66829', '-')
                       and city_id != '-1'
                     group by prov_id,
                              prov_name) b on
            a.prov_code = b.pro_id
        and a.prov_name = b.prov_name
where b.prov_name is not null
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '外呼打扰投诉率'                                                            index_name,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                         "202303", "202304", "202305", "202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>移网>>【变更及服务】渠道服务>>被联通营销行为骚扰',
                          '投诉工单（2021版）>>融合>>【变更及服务】渠道服务>>被联通营销行为骚扰'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                            "202303", "202304", "202305", "202306")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b;

-- todo  外呼时间不合规率 248
-- A：外呼时间不合规量：
-- 1、法定节日期间当天24小时内
-- 2、工作日和公休日合规外呼时间规范：
-- 1）西藏外呼营销时间，具体如下，
-- 工作日：9:00~13:30，14:50~19:00；公休日：9:30~13:30，14:50~18:30。
-- 2）新疆外呼营销时间：分为冬夏两个时段进行设置，具体如下，冬季：10月至4月 工作日：10:30~14:00，15:30~21:00，公休日：11:00~14:00，15:30~20:30；夏季：工作日：5月至9月10:30~14:00 16:00~21:30，公休日：11:00~14:00 16:00~21:00。
-- 3）剩余29省：工作日：8：30-12：00，14：00-19：00；公休日：9：00-12：00，14：00-18:30。
select meaning bus_pro_id,
       sum(
               case
                   when bus_pro_id = '79'
                       and src in ('1', '3')
                       and (
                                (
                                            b.states = '1'
                                        and (
                                                        substr(starttime, 12, 5) < '09:30'
                                                    or substr(starttime, 12, 5) between '13:30' and '14:50'
                                                    or substr(starttime, 12, 5) > '18:30'
                                                )
                                    )
                                or (
                                            b.states = '0'
                                        and (
                                                        substr(starttime, 12, 5) < '09:00'
                                                    or substr(starttime, 12, 5) between '13:30' and '14:50'
                                                    or substr(starttime, 12, 5) > '19:00'
                                                )
                                    )
                            ) then 1
                   when bus_pro_id = '89'
                       and src in ('1', '3')
                       and (
                                (
                                            substr(a.dt_id, 5, 2) in ('05', '06', '07', '08', '09')
                                        and (
                                                    (
                                                                b.states = '1'
                                                            and (
                                                                            substr(starttime, 12, 5) < '11:00'
                                                                        or
                                                                            substr(starttime, 12, 5) between '14:00' and '16:00'
                                                                        or substr(starttime, 12, 5) > '21:00'
                                                                    )
                                                        )
                                                    or (
                                                                b.states = '0'
                                                            and (
                                                                            substr(starttime, 12, 5) < '10:30'
                                                                        or
                                                                            substr(starttime, 12, 5) between '14:00' and '16:00'
                                                                        or substr(starttime, 12, 5) > '21:30'
                                                                    )
                                                        )
                                                )
                                    )
                                or (
                                            substr(a.dt_id, 5, 2) in ('01', '02', '03', '04', '10', '11', '12')
                                        and (
                                                    (
                                                                b.states = '1'
                                                            and (
                                                                            substr(starttime, 12, 5) < '11:00'
                                                                        or
                                                                            substr(starttime, 12, 5) between '14:00' and '15:30'
                                                                        or substr(starttime, 12, 5) > '20:30'
                                                                    )
                                                        )
                                                    or (
                                                                b.states = '0'
                                                            and (
                                                                            substr(starttime, 12, 5) < '10:30'
                                                                        or
                                                                            substr(starttime, 12, 5) between '14:00' and '15:30'
                                                                        or substr(starttime, 12, 5) > '21:00'
                                                                    )
                                                        )
                                                )
                                    )
                            ) then 1
                   when bus_pro_id not in ('79', '89')
                       and src in ('1', '3')
                       and (
                                (
                                            b.states = '1'
                                        and (
                                                        substr(starttime, 12, 5) < '09:00'
                                                    or substr(starttime, 12, 5) between '12:00' and '14:00'
                                                    or substr(starttime, 12, 5) > '18:30'
                                                )
                                    )
                                or (
                                            b.states = '0'
                                        and (
                                                        substr(starttime, 12, 5) < '08:30'
                                                    or substr(starttime, 12, 5) between '12:00' and '14:00'
                                                    or substr(starttime, 12, 5) > '18:30'
                                                )
                                    )
                            ) then 1
                   else 0
                   end
           )   xkf_molecule,
       sum(
               case
                   when src in ('1', '3') then 1
                   else 0
                   end
           )   xkf_denominator,
       sum(
               case
                   when bus_pro_id = '79'
                       and src in ('2')
                       and (
                                (
                                            b.states = '1'
                                        and (
                                                        substr(starttime, 12, 5) < '09:30'
                                                    or substr(starttime, 12, 5) between '13:30' and '14:50'
                                                    or substr(starttime, 12, 5) > '18:30'
                                                )
                                    )
                                or (
                                            b.states = '0'
                                        and (
                                                        substr(starttime, 12, 5) < '09:00'
                                                    or substr(starttime, 12, 5) between '13:30' and '14:50'
                                                    or substr(starttime, 12, 5) > '19:00'
                                                )
                                    )
                            ) then 1
                   when bus_pro_id = '89'
                       and src in ('2')
                       and (
                                (
                                            substr(a.dt_id, 5, 2) in ('05', '06', '07', '08', '09')
                                        and (
                                                    (
                                                                b.states = '1'
                                                            and (
                                                                            substr(starttime, 12, 5) < '11:00'
                                                                        or
                                                                            substr(starttime, 12, 5) between '14:00' and '16:00'
                                                                        or substr(starttime, 12, 5) > '21:00'
                                                                    )
                                                        )
                                                    or (
                                                                b.states = '0'
                                                            and (
                                                                            substr(starttime, 12, 5) < '10:30'
                                                                        or
                                                                            substr(starttime, 12, 5) between '14:00' and '16:00'
                                                                        or substr(starttime, 12, 5) > '21:30'
                                                                    )
                                                        )
                                                )
                                    )
                                or (
                                            substr(a.dt_id, 5, 2) in ('01', '02', '03', '04', '10', '11', '12')
                                        and (
                                                    (
                                                                b.states = '1'
                                                            and (
                                                                            substr(starttime, 12, 5) < '11:00'
                                                                        or
                                                                            substr(starttime, 12, 5) between '14:00' and '15:30'
                                                                        or substr(starttime, 12, 5) > '20:30'
                                                                    )
                                                        )
                                                    or (
                                                                b.states = '0'
                                                            and (
                                                                            substr(starttime, 12, 5) < '10:30'
                                                                        or
                                                                            substr(starttime, 12, 5) between '14:00' and '15:30'
                                                                        or substr(starttime, 12, 5) > '21:00'
                                                                    )
                                                        )
                                                )
                                    )
                            ) then 1
                   when bus_pro_id not in ('79', '89')
                       and src in ('2')
                       and (
                                (
                                            b.states = '1'
                                        and (
                                                        substr(starttime, 12, 5) < '09:00'
                                                    or substr(starttime, 12, 5) between '12:00' and '14:00'
                                                    or substr(starttime, 12, 5) > '18:30'
                                                )
                                    )
                                or (
                                            b.states = '0'
                                        and (
                                                        substr(starttime, 12, 5) < '08:30'
                                                    or substr(starttime, 12, 5) between '12:00' and '14:00'
                                                    or substr(starttime, 12, 5) > '18:30'
                                                )
                                    )
                            ) then 1
                   else 0
                   end
           )   sfss_molecule,
       sum(
               case
                   when src in ('2') then 1
                   else 0
                   end
           )   sfss_denominator
from (select case
                 when pro_id = '279' then '13'
                 when pro_id = '1003' then '97'
                 when pro_id = '290' then '34'
                 else pro_id
                 end                  bus_pro_id,
             id,
             concat(month_id, day_id) dt_id,
             called,
             starttime,
             src,
             substr(starttime, 12, 5) hour_time
      from dc_dwa.dwa_d_callout_marketing_detail
      where month_id in
            ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
             "202303", "202304", "202305", "202306")
        and dir = '0'
        and (
              (
                          src in ('1', '2')
                      and pro_id <> '70'
                  )
              or (
                          src = '3'
                      and pro_id = '70'
                  )
          )
        and length(called) >= 7
        and called <> nvl(workno, '')) a
         left join dc_dim.dim_legal_holidays_code b on a.dt_id = b.dt_id
         inner join dc_dim.dim_province_code c on a.bus_pro_id = c.code
group by meaning;

-- todo 外呼服务态度投诉率 249 完成
select b.pro_id                                                                    pro_id,
       b.prov_name                                                                 pro_name,
       '00'                                                                        city_id,
       '全省'                                                                      city_name,
       '外呼服务态度投诉率'                                                        index_name,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select a.prov_name,
             a.prov_code,
             if(a.n is null, 0, a.n) n
      from (select b.prov_code prov_code,
                   b.prov_name prov_name,
                   count(1)    n
            from (select sheet_id,
                         compl_area
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                         "202303", "202304", "202305", "202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>移网>>【变更及服务】渠道服务>>电话营销服务人员服务态度/解释不到位',
                          '投诉工单（2021版）>>融合>>【变更及服务】渠道服务>>电话营销服务人员服务态度/解释不到位',
                          '投诉工单（2021版）>>宽带>>【变更及服务】渠道服务>>电话营销服务人员服务态度/解释不到位'
                            )
                    and sheet_status not in ('8', '11')) a
                     left join dc_dim.dim_pro_city_regoin_cb b on
                a.compl_area = b.code_value
            group by b.prov_code,
                     b.prov_name) a) a
         right join (select substr(prov_id, 2, 3)          pro_id,
                            prov_name,
                            cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                            "202303", "202304", "202305", "202306")
                       and kpi_code in ('CKP_66829', '-')
                       and city_id != '-1'
                     group by prov_id,
                              prov_name) b on
            a.prov_code = b.pro_id
        and a.prov_name = b.prov_name
where b.prov_name is not null
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '外呼服务态度投诉率'                                                        index_name,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                         "202303", "202304", "202305", "202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>移网>>【变更及服务】渠道服务>>电话营销服务人员服务态度/解释不到位',
                          '投诉工单（2021版）>>融合>>【变更及服务】渠道服务>>电话营销服务人员服务态度/解释不到位',
                          '投诉工单（2021版）>>宽带>>【变更及服务】渠道服务>>电话营销服务人员服务态度/解释不到位'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                            "202303", "202304", "202305", "202306")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b;

-- todo 诱导/不知情订购投诉率 251 完成
select b.pro_id                                                                    pro_id,
       b.prov_name                                                                 pro_name,
       '00'                                                                        city_id,
       '全省'                                                                      city_name,
       '诱导/不知情订购投诉率'                                                     index_name,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select a.prov_name,
             a.prov_code,
             if(a.n is null, 0, a.n) n
      from (select b.prov_code prov_code,
                   b.prov_name prov_name,
                   count(1)    n
            from (select sheet_id,
                         compl_area
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                         "202303", "202304", "202305", "202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>融合>>【变更及服务】渠道服务>>电话营销诱导定制/不知情定制',
                          '投诉工单（2021版）>>宽带>>【变更及服务】渠道服务>>电话营销诱导定制/不知情定制',
                          '投诉工单（2021版）>>移网>>【变更及服务】增值或权益业务使用>>营销无故开通',
                          '投诉工单（2021版）>>融合>>【变更及服务】增值或权益业务使用>>营销无故开通',
                          '投诉工单（2021版）>>移网>>【变更及服务】渠道服务>>电话营销诱导定制/不知情定制'
                            )
                    and sheet_status not in ('8', '11')) a
                     left join dc_dim.dim_pro_city_regoin_cb b on
                a.compl_area = b.code_value
            group by b.prov_code,
                     b.prov_name) a) a
         right join (select substr(prov_id, 2, 3)          pro_id,
                            prov_name,
                            cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                            "202303", "202304", "202305", "202306")
                       and kpi_code in ('CKP_66829', '-')
                       and city_id != '-1'
                     group by prov_id,
                              prov_name) b on
            a.prov_code = b.pro_id
        and a.prov_name = b.prov_name
where b.prov_name is not null
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '诱导/不知情订购投诉率'                                                     index_name,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                         "202303", "202304", "202305", "202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>融合>>【变更及服务】渠道服务>>电话营销诱导定制/不知情定制',
                          '投诉工单（2021版）>>宽带>>【变更及服务】渠道服务>>电话营销诱导定制/不知情定制',
                          '投诉工单（2021版）>>移网>>【变更及服务】增值或权益业务使用>>营销无故开通',
                          '投诉工单（2021版）>>融合>>【变更及服务】增值或权益业务使用>>营销无故开通',
                          '投诉工单（2021版）>>移网>>【变更及服务】渠道服务>>电话营销诱导定制/不知情定制'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                            "202303", "202304", "202305", "202306")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b;

-- todo 双线业务开通投诉率 258 完成
select b.pro_id                                                                    pro_id,
       b.prov_name                                                                 pro_name,
       '00'                                                                        city_id,
       '全省'                                                                      city_name,
       '双线业务开通投诉率'                                                        index_name,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select a.prov_name,
             a.prov_code,
             if(a.n is null, 0, a.n) n
      from (select b.prov_code prov_code,
                   b.prov_name prov_name,
                   count(1)    n
            from (select sheet_id,
                         compl_area
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                         "202303", "202304", "202305", "202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '10019投诉工单>>业务开通问题>>业务开通进度提前',
                          '10019投诉工单>>业务开通问题>>业务开通进度滞后',
                          '10019投诉工单>>业务开通问题>>欠停要求开通',
                          '10019投诉工单>>业务开通问题>>要求提前开通'
                            )
                    and sheet_status not in ('8', '11')) a
                     left join dc_dim.dim_pro_city_regoin_cb b on
                a.compl_area = b.code_value
            group by b.prov_code,
                     b.prov_name) a) a
         right join (select substr(prov_id, 2, 3)          pro_id,
                            prov_name,
                            cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                            "202303", "202304", "202305", "202306")
                       and kpi_code in ('CKP_66829', '-')
                       and city_id != '-1'
                     group by prov_id,
                              prov_name) b on
            a.prov_code = b.pro_id
        and a.prov_name = b.prov_name
where b.prov_name is not null
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '双线业务开通投诉率'                                                        index_name,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                         "202303", "202304", "202305", "202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '10019投诉工单>>业务开通问题>>业务开通进度提前',
                          '10019投诉工单>>业务开通问题>>业务开通进度滞后',
                          '10019投诉工单>>业务开通问题>>欠停要求开通',
                          '10019投诉工单>>业务开通问题>>要求提前开通'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                            "202303", "202304", "202305", "202306")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b;

-- todo 服务经理投诉率 260 完成
select b.pro_id                                                                    pro_id,
       b.prov_name                                                                 pro_name,
       '00'                                                                        city_id,
       '全省'                                                                      city_name,
       '服务经理投诉率'                                                            index_name,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select a.prov_name,
             a.prov_code,
             if(a.n is null, 0, a.n) n
      from (select b.prov_code prov_code,
                   b.prov_name prov_name,
                   count(1)    n
            from (select sheet_id,
                         compl_area
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                         "202303", "202304", "202305", "202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                            '10019投诉工单>>人员服务问题>>客户经理服务问题'
                            )
                    and sheet_status not in ('8', '11')) a
                     left join dc_dim.dim_pro_city_regoin_cb b on
                a.compl_area = b.code_value
            group by b.prov_code,
                     b.prov_name) a) a
         right join (select substr(prov_id, 2, 3)          pro_id,
                            prov_name,
                            cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                            "202303", "202304", "202305", "202306")
                       and kpi_code in ('CKP_66829', '-')
                       and city_id != '-1'
                     group by prov_id,
                              prov_name) b on
            a.prov_code = b.pro_id
        and a.prov_name = b.prov_name
where b.prov_name is not null
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '服务经理投诉率'                                                            index_name,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                         "202303", "202304", "202305", "202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                            '10019投诉工单>>人员服务问题>>客户经理服务问题'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                            "202303", "202304", "202305", "202306")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b;

-- todo 10010-业务办理有差错，推诿办理投诉率 263 完成
select b.pro_id                                                                    pro_id,
       b.prov_name                                                                 pro_name,
       '00'                                                                        city_id,
       '全省'                                                                      city_name,
       '10010-业务办理有差错，推诿办理投诉率'                                       index_name,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select a.prov_name,
             a.prov_code,
             if(a.n is null, 0, a.n) n
      from (select b.prov_code prov_code,
                   b.prov_name prov_name,
                   count(1)    n
            from (select sheet_id,
                         compl_area
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                         "202303", "202304", "202305", "202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>移网>>【入网】办理>>客服热线人员办理差错/不成功',
                          '投诉工单（2021版）>>移网>>【变更及服务】渠道服务>>客服热线业务办理错误/操作不熟练',
                          '投诉工单（2021版）>>融合>>【入网】办理>>客服热线人员办理差错/不成功',
                          '投诉工单（2021版）>>融合>>【变更及服务】渠道服务>>客服热线业务办理错误/操作不熟练',
                          '投诉工单（2021版）>>宽带>>【入网】办理>>客服热线人员办理差错/不成功',
                          '投诉工单（2021版）>>宽带>>【变更及服务】渠道服务>>客服热线业务办理错误/操作不熟练',
                          '投诉工单（2021版）>>移网>>【入网】办理>>推诿办理业务',
                          '投诉工单（2021版）>>移网>>【变更及服务】产品查询>>查询受限',
                          '投诉工单（2021版）>>移网>>【变更及服务】业务变更>>渠道限制业务变更',
                          '投诉工单（2021版）>>移网>>【变更及服务】业务变更>>渠道推诿业务变更',
                          '投诉工单（2021版）>>融合>>【入网】办理>>推诿办理业务',
                          '投诉工单（2021版）>>融合>>【变更及服务】产品查询>>查询受限',
                          '投诉工单（2021版）>>融合>>【变更及服务】业务变更>>渠道限制业务变更',
                          '投诉工单（2021版）>>融合>>【变更及服务】业务变更>>渠道推诿业务变更',
                          '投诉工单（2021版）>>宽带>>【变更及服务】业务变更>>渠道限制业务变更',
                          '投诉工单（2021版）>>宽带>>【变更及服务】业务变更>>渠道推诿业务变更',
                          '10019投诉工单>>热线服务>>业务办理差错',
                          '10019投诉工单>>热线服务>>在用户投诉或咨询业务时反问或推诿客户'
                            )
                    and sheet_status not in ('8', '11')) a
                     left join dc_dim.dim_pro_city_regoin_cb b on
                a.compl_area = b.code_value
            group by b.prov_code,
                     b.prov_name) a) a
         right join (select substr(prov_id, 2, 3)          pro_id,
                            prov_name,
                            cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                            "202303", "202304", "202305", "202306")
                       and kpi_code in ('CKP_66829', '-')
                       and city_id != '-1'
                     group by prov_id,
                              prov_name) b on
            a.prov_code = b.pro_id
        and a.prov_name = b.prov_name
where b.prov_name is not null
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '10010-业务办理有差错，推诿办理投诉率'                                       index_name,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                         "202303", "202304", "202305", "202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>移网>>【入网】办理>>客服热线人员办理差错/不成功',
                          '投诉工单（2021版）>>移网>>【变更及服务】渠道服务>>客服热线业务办理错误/操作不熟练',
                          '投诉工单（2021版）>>融合>>【入网】办理>>客服热线人员办理差错/不成功',
                          '投诉工单（2021版）>>融合>>【变更及服务】渠道服务>>客服热线业务办理错误/操作不熟练',
                          '投诉工单（2021版）>>宽带>>【入网】办理>>客服热线人员办理差错/不成功',
                          '投诉工单（2021版）>>宽带>>【变更及服务】渠道服务>>客服热线业务办理错误/操作不熟练',
                          '投诉工单（2021版）>>移网>>【入网】办理>>推诿办理业务',
                          '投诉工单（2021版）>>移网>>【变更及服务】产品查询>>查询受限',
                          '投诉工单（2021版）>>移网>>【变更及服务】业务变更>>渠道限制业务变更',
                          '投诉工单（2021版）>>移网>>【变更及服务】业务变更>>渠道推诿业务变更',
                          '投诉工单（2021版）>>融合>>【入网】办理>>推诿办理业务',
                          '投诉工单（2021版）>>融合>>【变更及服务】产品查询>>查询受限',
                          '投诉工单（2021版）>>融合>>【变更及服务】业务变更>>渠道限制业务变更',
                          '投诉工单（2021版）>>融合>>【变更及服务】业务变更>>渠道推诿业务变更',
                          '投诉工单（2021版）>>宽带>>【变更及服务】业务变更>>渠道限制业务变更',
                          '投诉工单（2021版）>>宽带>>【变更及服务】业务变更>>渠道推诿业务变更',
                          '10019投诉工单>>热线服务>>业务办理差错',
                          '10019投诉工单>>热线服务>>在用户投诉或咨询业务时反问或推诿客户'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                            "202303", "202304", "202305", "202306")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b;

-- todo 政企计收费投诉率 265 完成
select b.pro_id                                                                    pro_id,
       b.prov_name                                                                 pro_name,
       '00'                                                                        city_id,
       '全省'                                                                      city_name,
       '政企计收费投诉率'                                                          index_name,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select a.prov_name,
             a.prov_code,
             if(a.n is null, 0, a.n) n
      from (select b.prov_code prov_code,
                   b.prov_name prov_name,
                   count(1)    n
            from (select sheet_id,
                         compl_area
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                         "202303", "202304", "202305", "202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '10019投诉工单>>计收费问题>>协议到期产生费用争议',
                          '10019投诉工单>>计收费问题>>实际扣费情况与商机宣传不一致',
                          '10019投诉工单>>计收费问题>>延迟销户',
                          '10019投诉工单>>计收费问题>>托收问题',
                          '10019投诉工单>>计收费问题>>拆户、报停后仍产生各种费用',
                          '10019投诉工单>>计收费问题>>未使用但产生费用',
                          '10019投诉工单>>计收费问题>>未按合同标准资费计收',
                          '10019投诉工单>>计收费问题>>线路应有的优惠或免费资源未享受',
                          '10019投诉工单>>计收费问题>>线路月租计收不正确',
                          '10019投诉工单>>计收费问题>>退费问题',
                          '10019投诉工单>>计收费问题>>销账问题'
                            )
                    and sheet_status not in ('8', '11')) a
                     left join dc_dim.dim_pro_city_regoin_cb b on
                a.compl_area = b.code_value
            group by b.prov_code,
                     b.prov_name) a) a
         right join (select substr(prov_id, 2, 3)          pro_id,
                            prov_name,
                            cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                            "202303", "202304", "202305", "202306")
                       and kpi_code in ('CKP_66829', '-')
                       and city_id != '-1'
                     group by prov_id,
                              prov_name) b on
            a.prov_code = b.pro_id
        and a.prov_name = b.prov_name
where b.prov_name is not null
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '政企计收费投诉率'                                                          index_name,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                         "202303", "202304", "202305", "202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '10019投诉工单>>计收费问题>>协议到期产生费用争议',
                          '10019投诉工单>>计收费问题>>实际扣费情况与商机宣传不一致',
                          '10019投诉工单>>计收费问题>>延迟销户',
                          '10019投诉工单>>计收费问题>>托收问题',
                          '10019投诉工单>>计收费问题>>拆户、报停后仍产生各种费用',
                          '10019投诉工单>>计收费问题>>未使用但产生费用',
                          '10019投诉工单>>计收费问题>>未按合同标准资费计收',
                          '10019投诉工单>>计收费问题>>线路应有的优惠或免费资源未享受',
                          '10019投诉工单>>计收费问题>>线路月租计收不正确',
                          '10019投诉工单>>计收费问题>>退费问题',
                          '10019投诉工单>>计收费问题>>销账问题'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                            "202303", "202304", "202305", "202306")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b;

-- todo 政企账单投诉率 266 完成
select b.pro_id                                                                    pro_id,
       b.prov_name                                                                 pro_name,
       '00'                                                                        city_id,
       '全省'                                                                      city_name,
       '政企账单投诉率'                                                            index_name,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select a.prov_name,
             a.prov_code,
             if(a.n is null, 0, a.n) n
      from (select b.prov_code prov_code,
                   b.prov_name prov_name,
                   count(1)    n
            from (select sheet_id,
                         compl_area
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                         "202303", "202304", "202305", "202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '10019投诉工单>>账单问题>>账单中显示的功能费与实际订购不符',
                          '10019投诉工单>>账单问题>>账单中显示的费用与详单不符',
                          '10019投诉工单>>账单问题>>账单中格式显示问题',
                          '10019投诉工单>>账单问题>>账单中没有显示客户使用相关业务的费用',
                          '10019投诉工单>>账单问题>>账单收不到'
                            )
                    and sheet_status not in ('8', '11')) a
                     left join dc_dim.dim_pro_city_regoin_cb b on
                a.compl_area = b.code_value
            group by b.prov_code,
                     b.prov_name) a) a
         right join (select substr(prov_id, 2, 3)          pro_id,
                            prov_name,
                            cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                            "202303", "202304", "202305", "202306")
                       and kpi_code in ('CKP_66829', '-')
                       and city_id != '-1'
                     group by prov_id,
                              prov_name) b on
            a.prov_code = b.pro_id
        and a.prov_name = b.prov_name
where b.prov_name is not null
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '政企账单投诉率'                                                            index_name,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                         "202303", "202304", "202305", "202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '10019投诉工单>>账单问题>>账单中显示的功能费与实际订购不符',
                          '10019投诉工单>>账单问题>>账单中显示的费用与详单不符',
                          '10019投诉工单>>账单问题>>账单中格式显示问题',
                          '10019投诉工单>>账单问题>>账单中没有显示客户使用相关业务的费用',
                          '10019投诉工单>>账单问题>>账单收不到'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                            "202303", "202304", "202305", "202306")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b;

-- todo 宣传和实际使用不一致投诉率 316 完成
select b.pro_id                                                                    pro_id,
       b.prov_name                                                                 pro_name,
       '00'                                                                        city_id,
       '全省'                                                                      city_name,
       '宣传和实际使用不一致投诉率'                                                index_name,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select a.prov_name,
             a.prov_code,
             if(a.n is null, 0, a.n) n
      from (select b.prov_code prov_code,
                   b.prov_name prov_name,
                   count(1)    n
            from (select sheet_id,
                         compl_area
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                         "202303", "202304", "202305", "202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>移网>>【入网】宣传>>宣传和实际使用不一致',
                          '投诉工单（2021版）>>融合>>【入网】宣传>>宣传和实际使用不一致',
                          '投诉工单（2021版）>>宽带>>【入网】宣传>>宣传和实际使用不一致'
                            )
                    and sheet_status not in ('8', '11')) a
                     left join dc_dim.dim_pro_city_regoin_cb b on
                a.compl_area = b.code_value
            group by b.prov_code,
                     b.prov_name) a) a
         right join (select substr(prov_id, 2, 3)          pro_id,
                            prov_name,
                            cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                            "202303", "202304", "202305", "202306")
                       and kpi_code in ('CKP_66829', '-')
                       and city_id != '-1'
                     group by prov_id,
                              prov_name) b on
            a.prov_code = b.pro_id
        and a.prov_name = b.prov_name
where b.prov_name is not null
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '宣传和实际使用不一致投诉率'                                                index_name,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                         "202303", "202304", "202305", "202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>移网>>【入网】宣传>>宣传和实际使用不一致',
                          '投诉工单（2021版）>>融合>>【入网】宣传>>宣传和实际使用不一致',
                          '投诉工单（2021版）>>宽带>>【入网】宣传>>宣传和实际使用不一致'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                            "202303", "202304", "202305", "202306")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b;

-- todo  营业厅-服务态度差投诉率 321 完成
select b.pro_id                                                                    pro_id,
       b.prov_name                                                                 pro_name,
       '00'                                                                        city_id,
       '全省'                                                                      city_name,
       '营业厅-服务态度差投诉率'                                                   index_name,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select a.prov_name,
             a.prov_code,
             if(a.n is null, 0, a.n) n
      from (select b.prov_code prov_code,
                   b.prov_name prov_name,
                   count(1)    n
            from (select sheet_id,
                         compl_area
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                         "202303", "202304", "202305", "202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>宽带>>【变更及服务】渠道服务>>营业厅人员态度差/时效性差',
                          '投诉工单（2021版）>>移网>>【变更及服务】渠道服务>>营业厅人员态度差/时效性差',
                          '投诉工单（2021版）>>融合>>【变更及服务】渠道服务>>营业厅人员态度差/时效性差'
                            )
                    and sheet_status not in ('8', '11')) a
                     left join dc_dim.dim_pro_city_regoin_cb b on
                a.compl_area = b.code_value
            group by b.prov_code,
                     b.prov_name) a) a
         right join (select substr(prov_id, 2, 3)          pro_id,
                            prov_name,
                            cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                            "202303", "202304", "202305", "202306")
                       and kpi_code in ('CKP_66829', '-')
                       and city_id != '-1'
                     group by prov_id,
                              prov_name) b on
            a.prov_code = b.pro_id
        and a.prov_name = b.prov_name
where b.prov_name is not null
union all
select '00'                                                                        pro_id,
       '全国'                                                                      pro_name,
       '00'                                                                        city_id,
       '全国'                                                                      city_name,
       '营业厅-服务态度差投诉率'                                                   index_name,
       if(round(a.n / (b.n / 10000), 6) is null, 0, round(a.n / (b.n / 10000), 6)) index_value,
       b.n                                                                         index_value_denominator,
       a.n                                                                         index_value_numerator
from (select if(a.n is null, 0, a.n) n
      from (select count(1) n
            from (select sheet_id
                  from dc_dwa.dwa_d_sheet_main_history_ex
                  where month_id in
                        ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                         "202303", "202304", "202305", "202306")
                    and is_delete = '0'
                    and (pro_id not in ('AC', 'S1', 'S2', 'N1', 'N2')
                      or (pro_id in ('AC', 'S1', 'S2', 'N1', 'N2')
                          and nvl(rc_sheet_code, '') = ''))
                    and serv_type_name
                      in (
                          '投诉工单（2021版）>>宽带>>【变更及服务】渠道服务>>营业厅人员态度差/时效性差',
                          '投诉工单（2021版）>>移网>>【变更及服务】渠道服务>>营业厅人员态度差/时效性差',
                          '投诉工单（2021版）>>融合>>【变更及服务】渠道服务>>营业厅人员态度差/时效性差'
                            )
                    and sheet_status not in ('8', '11')) a) a) a
         right join (select cast(sum(kpi_value) as bigint) n
                     from dc_dm.dm_m_cb_al_quality_ts
                     where month_id in
                           ("202207", "202212", "202212", "202212", "202212", "202212", "202301", "202302",
                            "202303", "202304", "202305", "202306")
                       and kpi_code in ('CKP_66829', '-')
                       and prov_id = '111') b;